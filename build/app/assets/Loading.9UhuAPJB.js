const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MultiplayerEditor.S-C3ZQur.js","assets/index.mlCxaiYE.js","assets/DocumentContext.hhTeDqBR.js","assets/PlaceholderText.UNfhMHoO.js","assets/Scene.tZk0YIWv.js","assets/LoadingIndicatorBar.mGaD64ZX.js","assets/Switch.3DOmHSIs.js","assets/PopoverDisclosure.OO70kItq.js","assets/InputSelectPermission.lb2lIKIy.js","assets/TeamLogo.qV1feKYB.js","assets/useBoolean.4JQO1FDN.js","assets/useCurrentUser.zlImhYTS.js","assets/Badge.sHfYRIgC.js","assets/Item.dGEOVRdT.js","assets/Time.rp9cc_zo.js","assets/index.esm.XsAbwjVB.js","assets/useCurrentTeam.fRZpnoZU.js","assets/usePolicy.wYF8wJNp.js","assets/SharedLayoutContext.2BBc39h7.js","assets/cloneDeep.KovzE0Sn.js","assets/OutlineIcon.Lni4fHNe.js","assets/index.njNghNAe.js","assets/useFocusedComment.Wp-Vuc-6.js","assets/Star.r69PtoVf.js","assets/PopoverButton.AWtPNgE3.js","assets/Actions.u9jjnQ1W.js","assets/DocumentViews.hDT4MR_D.js","assets/Facepile.0K3TyxgD.js","assets/revisions.HHg7AZxX.js","assets/Notice.4wB6_cwE.js","assets/Subheading.reqgXMWW.js","assets/Tabs.dkNXhqZm.js","assets/VisualElementDragControls.jrFnrF4j.js","assets/index.4lU6ZntV.js","assets/EmojiPanel.TJcM4M0j.js","assets/Emoji.r_ABO2XC.js"])))=>i.map(i=>d[i]);
import{a as e,d as t,aK as o,j as n,aJ as i,H as r,E as s,n as c,C as l,N as d,ah as u,e as p,a0 as h,o as m,u as f,T as g,aI as b,h as v,F as y,r as w,aC as C,aE as x,ea as I,an as S,cr as D,g as k,_ as T,L as P,aZ as E,eC as M,eD as A,ao as F,z as O,a7 as B,aM as V,t as R,eE as j,eF as L,eG as N,eH as $,eI as U,ef as W,eJ as H,aH as z,cD as _,ec as K,a2 as G,bo as Z,a8 as q,eK as J,cy as Y,i as X,w as Q,eL as ee,bf as te,d1 as oe,$ as ne,W as ie,b2 as ae,dh as re,bp as se,cc as ce,am as le,p as de,eM as ue,B as pe,eN as he,aj as me,bq as fe,ak as ge,X as be,aF as ve,dc as ye,eO as we,aP as Ce,bt as xe,eP as Ie,cA as Se,eQ as De,a1 as ke,ai as Te,bm as Pe,bj as Ee,eR as Me,k as Ae,eS as Fe,eT as Oe,eu as Be,bE as Ve,eU as Re,bv as je,Z as Le,ar as Ne,c$ as $e,bA as Ue,eV as We,R as He,eW as ze,ax as _e,bZ as Ke}from"./index.mlCxaiYE.js";import{c as Ge}from"./cloneDeep.KovzE0Sn.js";import{f as Ze,a as qe,az as Je,aA as Ye,V as Xe,aB as Qe,b as et,M as tt,T as ot,m as nt,A as it,aC as at,u as rt,aD as st,aE as ct,D as lt,d as dt,ay as ut,aF as pt,aG as ht,N as mt,aH as ft}from"./DocumentContext.hhTeDqBR.js";import{O as gt}from"./OutlineIcon.Lni4fHNe.js";import{L as bt}from"./LoadingIndicatorBar.mGaD64ZX.js";import{B as vt,w as yt}from"./Badge.sHfYRIgC.js";import{w as wt}from"./index.njNghNAe.js";import{u as Ct}from"./useCurrentTeam.fRZpnoZU.js";import{u as xt}from"./useCurrentUser.zlImhYTS.js";import{u as It}from"./useFocusedComment.Wp-Vuc-6.js";import{u as St}from"./usePolicy.wYF8wJNp.js";import{D as Dt,B as kt,a as Tt,S as Pt}from"./Star.r69PtoVf.js";import{P as Et}from"./PopoverButton.AWtPNgE3.js";import{u as Mt}from"./useBoolean.4JQO1FDN.js";import{A as At,S as Ft}from"./Actions.u9jjnQ1W.js";import{b as Ot,a as Bt}from"./TeamLogo.qV1feKYB.js";import{D as Vt}from"./DocumentViews.hDT4MR_D.js";import{F as Rt}from"./Facepile.0K3TyxgD.js";import{P as jt,u as Lt}from"./Switch.3DOmHSIs.js";import{u as Nt,P as $t}from"./PopoverDisclosure.OO70kItq.js";import{a as Ut}from"./Scene.tZk0YIWv.js";import{r as Wt}from"./revisions.HHg7AZxX.js";import{C as Ht}from"./InputSelectPermission.lb2lIKIy.js";import{N as zt}from"./Notice.4wB6_cwE.js";import{T as _t}from"./Time.rp9cc_zo.js";import{S as Kt}from"./Subheading.reqgXMWW.js";import{T as Gt,a as Zt}from"./Tabs.dkNXhqZm.js";const ErrorOffline=()=>{const{t:c}=e();return t(o,{children:[n(i,{title:c("Offline")}),n(r,{children:c("Offline")}),n(s,{children:c("We were unable to load the document while offline.")})]})};function Branding({href:e=p.URL}){return t(qt,{href:e,children:[n(gt,{size:20})," ",p.APP_NAME]})}const qt=c.a.withConfig({componentId:"sc-17gnqbc-0"})(["justify-content:center;padding-bottom:16px;font-weight:600;font-size:14px;text-decoration:none;border-top-right-radius:2px;color:",";display:flex;align-items:center;svg{fill:",";}",";"],l("text"),l("text"),d("tablet")`
    z-index: ${u.sidebar+1};
    background: ${l("sidebarBackground")};
    position: fixed;
    bottom: 0;
    right: 0;
    padding: 16px;

    &:hover {
      background: ${l("sidebarControlHoverBackground")};
    }
  `),Jt={code:1009,reason:"Document Too Large"},Yt={code:4401,reason:"Authentication Failed"},Xt=4403,Qt=4503,eo={code:5e3,reason:"Editor Update Required"};const to=c(h).withConfig({componentId:"sc-9uq8ky-0"})(["display:none;position:fixed;bottom:0;margin:20px;transform:translateX(-32px);",";@media print{display:none;}"],d("tablet")`
    display: block;
  `),oo=c.div.withConfig({componentId:"sc-9uq8ky-1"})(["text-align:center;"]),no=m((function ConnectionStatus(){const{ui:o}=f(),{t:i}=e(),r={[Jt.code]:{title:i("Document is too large"),body:i("This document has reached the maximum size and can no longer be edited")},[Yt.code]:{title:i("Authentication failed"),body:i("Please try logging out and back in again")},[Xt]:{title:i("Authorization failed"),body:i("You may have lost access to this document, try reloading")},[Qt]:{title:i("Too many users connected to document"),body:i("Your edits will sync once other users leave the document")}},s=o.multiplayerErrorCode?r[o.multiplayerErrorCode]:void 0;return"connecting"===o.multiplayerStatus||"disconnected"===o.multiplayerStatus?n(g,{content:t(oo,s?{children:[n("strong",{children:s.title}),n("br",{}),s.body]}:{children:[n("strong",{children:i("Server connection lost")}),n("br",{}),i("Edits you make will sync once you’re online")]}),placement:"bottom",children:n(to,{children:n(b,{children:n(v.DisconnectedIcon,{})})})}):null}));const io=c(y).withConfig({componentId:"sc-9gqp5-0"})(["position:relative;"]),getPosition=()=>({x:window.pageXOffset,y:window.pageYOffset}),ao={throttle:100};const ro=c.div.withConfig({componentId:"sc-k72mg6-0"})(["display:none;position:sticky;top:90px;max-height:calc(100vh - 90px);width:","px;padding:0 16px;overflow-y:auto;border-radius:8px;background:",";@supports (backdrop-filter:blur(20px)){backdrop-filter:blur(20px);background:",";}",";"],I.tocWidth,l("background"),(e=>S(.2,e.theme.background)),d("tablet")`
    display: block;
    z-index: ${u.toc};
  `),so=c.h3.withConfig({componentId:"sc-k72mg6-1"})(["font-size:13px;font-weight:600;color:",";letter-spacing:0.03em;margin-top:10px;"],l("textTertiary")),co=c.li.withConfig({componentId:"sc-k72mg6-2"})(["margin-left:","px;margin-bottom:8px;line-height:1.3;word-break:break-word;a{font-weight:",";color:",";}"],(e=>10*(e.level-1)),(e=>e.active?"600":"inherit"),(e=>e.active?e.theme.accent:e.theme.text)),lo=c.a.withConfig({componentId:"sc-k72mg6-3"})(["color:",";font-size:14px;&:hover{color:",";}"],l("text"),l("accent")),uo=c.ol.withConfig({componentId:"sc-k72mg6-4"})(["padding:0;list-style:none;"]),po=m((function Contents(){const[o,i]=w.useState(),r=function useWindowScrollPosition(e){const t=Object.assign({},ao,e),[o,n]=w.useState(getPosition());return w.useEffect((()=>{const e=C((()=>{n(getPosition())}),t.throttle);return window.addEventListener("scroll",e,!!x&&{passive:!0}),()=>{e.cancel(),window.removeEventListener("scroll",e)}}),[t.throttle]),o}({throttle:100}),{headings:s}=Ze();w.useEffect((()=>{let e=s.length>0?s[0].id:void 0;for(let t=0;t<s.length;t++){const o=s[t],n=window.document.getElementById(D(o.id));if(n){if(n.getBoundingClientRect().top>20)break;e=o.id}}i(e)}),[r,s]);const c=s.reduce(((e,t)=>t.level<e?t.level:e),1/0)-1,{t:l}=e();return 0===s.length?n(ro,{}):t(ro,{children:[n(so,{children:l("Contents")}),n(uo,{children:s.filter((e=>e.level<4)).map((e=>n(co,{level:e.level-c,active:o===e.id,children:n(lo,{href:`#${e.id}`,children:e.title})},e.id)))})]})})),ho=k((()=>T((()=>import("./MultiplayerEditor.S-C3ZQur.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]))));const mo=c(P).withConfig({componentId:"sc-dcg4tg-0"})(["display:inline-flex;align-items:center;"]),fo=c(Dt).withConfig({componentId:"sc-dcg4tg-1"})(["justify-content:",";margin:-12px 0 2em 0;font-size:14px;position:relative;user-select:none;z-index:1;a{color:inherit;cursor:var(--pointer);&:hover{text-decoration:underline;}}@media print{display:none;}"],(e=>e.rtl?"flex-end":"flex-start")),go=m((function TitleDocumentMeta({to:o,document:i,revision:r,...s}){const{views:c,comments:l,ui:d}=f(),{t:u}=e(),p=E(),h=qe(),m=Ct(),g=M((()=>c.inDocument(i.id))),y=g.length,C=1===y&&g[0].userId,x=w.useRef(y>0),I=St(i),S=x.current?w.Fragment:b,D=A(i),k=l.unresolvedCommentsInDocumentCount(i.id);return t(fo,{document:i,revision:r,to:o,replace:!0,...s,children:[m.getPreference(F.Commenting)&&I.comment&&t(O,{children:[" • ",t(mo,{to:{pathname:B(i),state:{sidebarContext:h}},onClick:()=>d.toggleComments(),children:[n(v.CommentIcon,{size:18}),k?u("{{ count }} comment",{count:k}):u("Comment")]})]}),y&&I.listViews&&!i.isDraft&&!i.isTemplate?t(S,{children:[" • ",t(P,{to:{pathname:p.url===D?B(i):D,state:{sidebarContext:h}},children:[u("Viewed by")," ",C?u("only you"):`${y} ${u(1===y?"person":"people")}`]})]}):null]})}));const bo=V(function(e){var t={};function a(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),i=Object.keys(n.default).reduce((function(e,t){return e.concat(n.default[t])}),[]);t.default=function(e){return-1===i.indexOf(e.key)}},function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default={modifier:["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Meta","NumLock","ScrollLock","Shift","Symbol","SymbolLock"],legacyModifier:["Hyper","Super"],whiteSpace:["Enter","Tab"],navigation:["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp"],editing:["Backspace","Clear","Copy","CrSel","Cut","Delete","EraseEof","ExSel","Insert","Paste","Redo","Undo"],ui:["Accept","Again","Attn","Cancel","ContextMenu","Escape","Execute","Find","Help","Pause","Play","Props","Select","ZoomIn","ZoomOut"],device:["BrightnessDown","BrightnessUp","Eject","LogOff","Power","PowerOff","PrintScreen","Hibernate","Standby","WakeUp"],imeCompositionKeys:["AllCandidates","Alphanumeric","CodeInput","Compose","Convert","Dead","FinalMode","GroupFirst","GroupLast","GroupNext","GroupPrevious","ModeChange","NextCandidate","NonConvert","PreviousCandidate","Process","SingleCandidate"],koreanSpecific:["HangulMode","HanjaMode","JunjaMode"],japaneseSpecific:["Eisu","Hankaku","Hiragana","HiraganaKatakana","KanaMode","KanjiMode","Katakana","Romaji","Zenkaku","ZenkakuHankaku"],commonFunction:["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Soft1","Soft2","Soft3","Soft4"],multimedia:["ChannelDown","ChannelUp","Close","MailForward","MailReply","MailSend","MediaClose","MediaFastForward","MediaPause","MediaPlay","MediaPlayPause","MediaRecord","MediaRewind","MediaStop","MediaTrackNext","MediaTrackPrevious","New","Open","Print","Save","SpellCheck"],multimediaNumpad:["Key11","Key12"],audio:["AudioBalanceLeft","AudioBalanceRight","AudioBassBoostDown","AudioBassBoostToggle","AudioBassBoostUp","AudioFaderFront","AudioFaderRear","AudioSurroundModeNext","AudioTrebleDown","AudioTrebleUp","AudioVolumeDown","AudioVolumeUp","AudioVolumeMute","MicrophoneToggle","MicrophoneVolumeDown","MicrophoneVolumeUp","MicrophoneVolumeMute"],speech:["SpeechCorrectionList","SpeechInputToggle"],application:["LaunchApplication1","LaunchApplication2","LaunchCalendar","LaunchContacts","LaunchMail","LaunchMediaPlayer","LaunchMusicPlayer","LaunchPhone","LaunchScreenSaver","LaunchSpreadsheet","LaunchWebBrowser","LaunchWebCam","LaunchWordProcessor"],browser:["BrowserBack","BrowserFavorites","BrowserForward","BrowserHome","BrowserRefresh","BrowserSearch","BrowserStop"],mobilePhone:["AppSwitch","Call","Camera","CameraFocus","EndCall","GoBack","GoHome","HeadsetHook","LastNumberRedial","Notification","MannerMode","VoiceDial"],tv:["TV","TV3DMode","TVAntennaCable","TVAudioDescription","TVAudioDescriptionMixDown","TVAudioDescriptionMixUp","TVContentsMenu","TVDataService","TVInput","TVInputComponent1","TVInputComponent2","TVInputComposite1","TVInputComposite2","TVInputHDMI1","TVInputHDMI2","TVInputHDMI3","TVInputHDMI4","TVInputVGA1","TVMediaContext","TVNetwork","TVNumberEntry","TVPower","TVRadioService","TVSatellite","TVSatelliteBS","TVSatelliteCS","TVSatelliteToggle","TVTerrestrialAnalog","TVTerrestrialDigital","TVTimer"],mediaControls:["AVRInput","AVRPower","ColorF0Red","ColorF1Green","ColorF2Yellow","ColorF3Blue","ColorF4Grey","ColorF5Brown","ClosedCaptionToggle","Dimmer","DisplaySwap","DVR","Exit","FavoriteClear0","FavoriteClear1","FavoriteClear2","FavoriteClear3","FavoriteRecall0","FavoriteRecall1","FavoriteRecall2","FavoriteRecall3","FavoriteStore0","FavoriteStore1","FavoriteStore2","FavoriteStore3","Guide","GuideNextDay","GuidePreviousDay","Info","InstantReplay","Link","ListProgram","LiveContent","Lock","MediaApps","MediaAudioTrack","MediaLast","MediaSkipBackward","MediaSkipForward","MediaStepBackward","MediaStepForward","MediaTopMenu","NavigateIn","NavigateNext","NavigateOut","NavigatePrevious","NextFavoriteChannel","NextUserProfile","OnDemand","Pairing","PinPDown","PinPMove","PinPToggle","PinPUp","PlaySpeedDown","PlaySpeedReset","PlaySpeedUp","RandomToggle","RcLowBattery","RecordSpeedNext","RfBypass","ScanChannelsToggle","ScreenModeNext","Settings","SplitScreenToggle","STBInput","STBPower","Subtitle","Teletext","VideoModeNext","Wink","ZoomToggle"]}}]).default),vo="IntersectionObserver"in window;const yo=w.forwardRef((function _ContentEditable({disabled:e,onChange:o,onInput:i,onFocus:r,onBlur:s,onKeyDown:c,value:l,children:d,className:u,maxLength:p,autoFocus:h,placeholder:m,readOnly:f,dir:g,onClick:b,...v},y){const C=w.useRef(null),[x,I]=w.useState(l),S=w.useRef(l);w.useImperativeHandle(y,(()=>({focus:()=>{C.current&&(C.current.focus(),C.current.innerText||placeCaret(C.current,!0))},focusAtStart:()=>{C.current&&(C.current.focus(),placeCaret(C.current,!0))},focusAtEnd:()=>{C.current&&(C.current.focus(),placeCaret(C.current,!1))},getComputedDirection:()=>C.current?window.getComputedStyle(C.current).direction:"ltr"})));const wrappedEvent=e=>t=>{if(f)return;const n=t.currentTarget.textContent||"";p&&bo(t)&&n.length>=p?t?.preventDefault():(n!==S.current&&(S.current=n,o?.(n)),e?.(t))},D=function useOnScreen(e){const[t,o]=w.useState(!vo);return w.useEffect((()=>{const t=e.current;let n;return vo&&(n=new IntersectionObserver((([e])=>{o(e.isIntersecting)}))),t&&n?.observe(t),()=>{t&&n?.unobserve(t)}}),[e]),t}(C);w.useEffect((()=>{h&&D&&!e&&!f&&C.current?.focus()}),[h,e,D,f,C]),w.useEffect((()=>{C.current&&l!==C.current.textContent&&I(l)}),[l,C]);const k=w.useCallback((e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");window.document.execCommand("insertText",!1,t)}),[]);return t("div",{className:u,dir:g,onClick:b,tabIndex:-1,children:[d,n(wo,{ref:C,contentEditable:!e&&!f,onInput:wrappedEvent(i),onFocus:wrappedEvent(r),onBlur:wrappedEvent(s),onKeyDown:wrappedEvent(c),onPaste:k,"data-placeholder":m,suppressContentEditableWarning:!0,role:"textbox",...v,children:x})]})}));function placeCaret(e,t){if(void 0!==window.getSelection&&void 0!==document.createRange){const o=document.createRange();o.selectNodeContents(e),o.collapse(t);const n=window.getSelection();n?.removeAllRanges(),n?.addRange(o)}}const wo=c.span.withConfig({componentId:"sc-146c620-0"})(["background:",";color:",";-webkit-text-fill-color:",";outline:none;resize:none;cursor:text;word-break:anywhere;&:empty{display:inline-block;}&:empty::before{display:inline-block;color:",";-webkit-text-fill-color:",";content:attr(data-placeholder);pointer-events:none;height:0;}"],l("background"),l("text"),l("text"),l("placeholder"),l("placeholder")),Co=w.lazy((()=>T((()=>import("./index.4lU6ZntV.js")),__vite__mapDeps([33,1,6,7,8,34,2,3,4,5,9,10,11,12,13,14,15,16,17,18,35,24])))),xo=w.forwardRef((function _DocumentTitle({documentId:e,title:t,icon:o,color:i,readOnly:r,onChangeTitle:s,onChangeIcon:c,onSave:l,onGoToNextInput:d,onBlur:u,placeholder:p},h){const m=w.useRef(null),[f,g,b]=Mt(),{editor:v}=Ze(),y=St(e),C=w.useCallback((()=>{m.current?.focus()}),[m]),x=w.useCallback((()=>{m.current?.focusAtEnd()}),[m]),I=w.useCallback((e=>{e.currentTarget.parentElement===e.relatedTarget||e.relatedTarget&&e.currentTarget.parentElement===e.relatedTarget.parentElement||u&&u(e)}),[u]),S=w.useCallback((e=>{if(!e.nativeEvent.isComposing)return"Enter"===e.key?(e.preventDefault(),R(e)?void l?.({done:!0}):void d?.(!0)):"Tab"===e.key||"ArrowDown"===e.key?(e.preventDefault(),void d?.()):"s"===e.key&&R(e)?(e.preventDefault(),void l?.({})):void 0}),[d,l]),D=w.useCallback((e=>{let t=e;/\/date\s$/.test(e)?(t=j(),m?.current?.focusAtEnd()):/\/time$/.test(e)?(t=L(),m?.current?.focusAtEnd()):/\/datetime$/.test(e)&&(t=N(),m?.current?.focusAtEnd()),s?.(t)}),[m,s]),k=w.useCallback((e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain"),o=e.clipboardData.getData("text/html"),[n,...i]=t.split("\n"),r=i.join("\n").trim();if(window.document.execCommand("insertText",!1,n.replace(/^#+\s?/,"")),v&&r){const{view:e,pasteParser:n}=v;let i;if(Je(t)){const e=n.parse(Ye(r));e&&(i=e.slice(0))}else{const n=$(e,t,o,!1,e.state.selection.$from);i=n.content.firstChild?new U(n.content.cut(n.content.firstChild.nodeSize),n.openStart,n.openEnd):n}i&&e.dispatch(e.state.tr.setSelection(W.atStart(e.state.doc)).replaceSelection(i))}}),[v]),T=w.useCallback((()=>{b(),x()}),[b,x]),P=w.useCallback(((e,t)=>{o===e&&i===t||c?.(e,t)}),[o,i,c]),E=m.current?.getComputedDirection(),M=o?n(q,{value:o,color:i,size:40}):null;return n(So,{onClick:C,onChange:D,onKeyDown:S,onPaste:k,onBlur:I,placeholder:p,value:t,$iconPickerIsOpen:f,$containsIcon:!!o,autoFocus:!t,maxLength:H.maxTitleLength,readOnly:r,dir:"auto",ref:z([m,h]),children:y.update&&!r?n(_,{dir:E,children:n(w.Suspense,{fallback:M,children:n(Io,{icon:o??null,color:i,size:40,popoverPosition:"bottom-start",onChange:P,onOpen:g,onClose:T,allowDelete:!0,borderOnHover:!0})})}):o?n(_,{dir:E,children:M}):null})})),Io=c(Co).withConfig({componentId:"sc-ebelym-0"})(["",""],K(8)),So=c(yo).withConfig({componentId:"sc-ebelym-1"})(["position:relative;line-height:",";margin-top:6vh;margin-bottom:0.5em;margin-left:",";font-size:",";font-weight:600;border:0;padding:0;cursor:",";> span{outline:none;}&::placeholder{color:",";-webkit-text-fill-color:",";opacity:1;}",";","{opacity:",";}",";@media print{color:",";-webkit-text-fill-color:",";background:none;}"],"1.25",(e=>e.$containsIcon||e.$iconPickerIsOpen?"40px":"0px"),"2.25em",(e=>e.readOnly?"default":"text"),l("placeholder"),l("placeholder"),(e=>!e.readOnly&&G(["&:focus-within,&:focus{margin-left:40px;","{opacity:1 !important;}}"],Et)),Et,(e=>e.$containsIcon?"1 !important":0),d("tablet")`
    margin-left: 0;

    &:focus-within,
    &:focus {
      margin-left: 0;
    }

    &:hover {
      ${Et} {
        opacity: 0.5;

        &:hover {
          opacity: 1;
        }
      }
    }`,Z.text,Z.text),Do=m(xo),ko=wt(J(Y));const To=m(w.forwardRef((function DocumentEditor(o,i){const r=w.useRef(null),{t:s}=e(),c=E(),l=It(),{ui:d,comments:u}=f(),p=xt({rejectOnEmpty:!1}),h=Ct({rejectOnEmpty:!1}),m=X(),g=qe(),b=Q(),{document:v,onChangeTitle:C,onChangeIcon:x,isDraft:I,shareId:S,readOnly:k,children:T,multiplayer:P,...M}=o,A=St(v),O=v.color??ee(te),V=w.useRef(null),R=w.useCallback((()=>{i.current&&i.current.focusAtStart()}),[i]);w.useEffect((()=>{if(l){const e=""===b.get("resolved");(l.isResolved&&!e||!l.isResolved&&e)&&m.replace({search:l.isResolved?"resolved=":"",pathname:location.pathname,state:{commentId:l.id,sidebarContext:g}}),d.set({commentsExpanded:!0})}}),[l,d,v.id,m,b,g]);const j=w.useCallback((()=>{setTimeout((()=>o.onSave({autosave:!0})),250)}),[o]),L=w.useCallback((e=>{if(e&&i.current){const{view:e}=i.current,{dispatch:t,state:o}=e;t(o.tr.insert(0,o.schema.nodes.paragraph.create()))}R()}),[R,i]),N=w.useCallback((e=>{m.replace({pathname:window.location.pathname.replace(/\/history$/,""),state:{commentId:e,sidebarContext:g}})}),[m,g]),$=w.useCallback(((e,t)=>{if(u.get(e)||t!==p?.id)return;const n=new oe({documentId:o.id,createdAt:new Date,createdById:t,reactions:[]},u);n.id=e,u.add(n),m.replace({pathname:window.location.pathname.replace(/\/history$/,""),state:{commentId:e,sidebarContext:g}})}),[u,p?.id,o.id,m,g]),U=w.useCallback((async e=>{const t=u.get(e);t?.isNew&&await(t?.delete())}),[u]),{setEditor:W,setEditorInitialized:H,updateState:_}=Ze(),K=w.useCallback(W,[W]),G=P?ho:Xe,Z=V.current?.offsetHeight||0,q=w.useMemo((()=>({padding:"0 32px",margin:"0 -32px",paddingBottom:`calc(50vh - ${Z}px)`})),[Z]),J=w.useCallback((()=>H(!0)),[H]),Y=w.useCallback((()=>H(!1)),[H]),ae=r.current?.getComputedDirection();return t(y,{auto:!0,column:!0,children:[n(Do,{ref:r,readOnly:k,documentId:v.id,title:!v.title&&k?v.titleWithDefault:v.title,icon:v.icon,color:O,onChangeTitle:C,onChangeIcon:x,onGoToNextInput:L,onBlur:j,placeholder:s("Untitled")}),!S&&n(go,{document:v,to:{pathname:c.path===ne?B(v):ie(v),state:{sidebarContext:g}},rtl:"rtl"===ae}),n(G,{ref:z([i,K]),autoFocus:!!v.title&&!o.defaultValue,placeholder:s("Type '/' to insert, or start writing…"),scrollTo:D(window.location.hash),readOnly:k,shareId:S,userId:p?.id,focusedCommentId:l?.id,onClickCommentMark:N,onCreateCommentMark:h?.getPreference(F.Commenting)&&A.comment?$:void 0,onDeleteCommentMark:h?.getPreference(F.Commenting)&&A.comment?U:void 0,onInit:J,onDestroy:Y,onChange:_,extensions:ko,editorStyle:q,...M}),n("div",{ref:V,children:T})]})})));const Po=m((function Collaborators(o){const{limit:i=6}=o,{t:r}=e(),s=xt(),c=s?.id,[l,d]=w.useState([]),{users:u,presence:p,ui:m}=f(),{document:g}=o,b=p.get(g.id),v=b?Array.from(b.values()):[],y=v.map((e=>e.userId)),C=v.filter((e=>e.isEditing)).map((e=>e.userId)),x=w.useMemo((()=>ae(re(u.all,(e=>(y.includes(e.id)||g.collaboratorIds.includes(e.id))&&!e.isSuspended)),[e=>y.includes(e.id),"id"],["asc","asc"])),[g.collaboratorIds,u.all,y]);w.useEffect((()=>{const e=se([...g.collaboratorIds,...y]).filter((e=>!u.get(e))).sort();!ce(l,e)&&e.length>0&&(d(e),u.fetchPage({ids:e,limit:100}))}),[g,u,y,g.collaboratorIds,l]);const I=Nt({gutter:0,placement:"bottom-end"}),S=w.useCallback((({model:e,...t})=>{const o=y.includes(e.id),n=C.includes(e.id),i=m.observingUserId===e.id,r=e.id!==c;return w.createElement(Ot,{...t,key:e.id,user:e,isPresent:o,isEditing:n,isObserving:i,isCurrentUser:c===e.id,onClick:r?t=>{o&&(t.preventDefault(),t.stopPropagation(),m.setObservingUser(i?void 0:e.id))}:void 0})}),[y,m,c,C]);return t(O,{children:[n($t,{...I,children:e=>n(h,{width:Math.min(x.length,i)*Bt.Large,height:Bt.Large,...e,children:n(Rt,{size:Bt.Large,limit:i,overflow:Math.max(0,x.length-i),users:x,renderAvatar:S})})}),n(jt,{...I,width:300,"aria-label":r("Viewers"),tabIndex:0,children:n(Vt,{document:g,isOpen:I.visible})})]})})),Eo=["click","mousemove","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","focus"];function useEditingFocus(){const{editor:e}=Ze();return Qe(3e3,Eo)&&!!e?.view.hasFocus()}const Mo=m((function NewChildDocumentMenu({document:o,label:i}){const r=et({modal:!0}),{t:s}=e(),c=St(o.collectionId),{collections:l}=f(),d=[];if(c.createDocument){const e=o.collectionId?l.get(o.collectionId):void 0,t=e?e.name:s("collection");d.push({type:"route",title:n("span",{children:n(le,{defaults:"New document in <em>{{ collectionName }}</em>",values:{collectionName:t},components:{em:n("strong",{})}})}),to:de(o.collectionId)})}return d.push({type:"route",title:n("span",{children:n(le,{defaults:"New document in <em>{{ collectionName }}</em>",values:{collectionName:o.title},components:{em:n("strong",{})}})}),to:ue(o.id)}),t(O,{children:[n(tt,{...r,children:i}),n(Ht,{...r,"aria-label":s("New child document"),children:n(ot,{...r,items:d})})]})}));const Ao=c.div.withConfig({componentId:"sc-14wwf3k-0"})(["max-width:100%;white-space:normal;overflow-wrap:anywhere;"]),Fo=m((function TableOfContentsMenu(){const{headings:o}=Ze(),i=et({modal:!0,unstable_preventOverflow:!0,unstable_fixed:!0,unstable_flip:!0}),{t:r}=e(),s=o.reduce(((e,t)=>t.level<e?t.level:e),1/0),c=w.useMemo((()=>{const e=[{type:"heading",title:r("Contents")},...o.map((e=>({type:"link",href:`#${e.id}`,title:n(Ao,{children:r(e.title)}),level:e.level-s})))];return 1===e.length&&e.push({type:"link",href:"#",title:n(Ao,{children:r("Headings you add to the document will appear here")}),disabled:!0}),e}),[r,o,s]);return t(O,{children:[n(tt,{...i,children:e=>n(pe,{...e,icon:n(v.TableOfContentsIcon,{}),borderOnHover:!0,neutral:!0})}),n(Ht,{...i,"aria-label":r("Table of contents"),children:n(ot,{...i,items:c})})]})}));const Oo=m((function TemplatesMenu({isCompact:o,onSelectTemplate:i,document:r}){const s=et({modal:!0}),c=xt(),{documents:l}=f(),{t:d}=e(),u=w.useCallback((e=>({type:"button",title:he.replaceTemplateVariables(e.titleWithDefault,c),icon:e.icon?n(q,{value:e.icon,color:e.color??void 0}):n(v.DocumentIcon,{}),onClick:()=>i(e)})),[c,i]),p=l.templates.filter((e=>e.publishedAt)),h=p.filter((e=>!e.isWorkspaceTemplate&&e.collectionId===r.collectionId)).map(u),m=p.filter((e=>e.isWorkspaceTemplate)).map(u),g=w.useMemo((()=>m.length?[{type:"heading",title:d("Workspace")},...m]:[]),[d,m]),b=h?g.length?[...h,{type:"separator"},...g]:h:g;return b.length?t(O,{children:[n(tt,{...s,children:e=>n(pe,{...e,icon:o?n(v.ShapesIcon,{}):void 0,disclosure:!o,neutral:!0,children:o?void 0:d("Templates")})}),n(Ht,{...s,"aria-label":d("Templates"),children:n(ot,{...s,items:b})})]}):null})),Bo={type:"spring",stiffness:500,damping:30};const Vo=c.div.withConfig({componentId:"sc-39l6xu-0"})(["position:fixed;top:0;left:50%;transform:translateX(-50%);"]),Ro=c(nt.div).withConfig({componentId:"sc-39l6xu-1"})(["padding:6px 6px 1px;font-size:13px;font-weight:500;z-index:",";color:",";background:",";border-bottom-left-radius:4px;border-bottom-right-radius:4px;",""],u.header+1,(e=>e.theme.white),(e=>e.$color),me()),jo=m((function ObservingBanner(){const{ui:t,users:o}=f(),{t:i}=e(),r=t.observingUserId?o.get(t.observingUserId):void 0;return n(Vo,{children:n(it,{children:r&&n(Ro,{$color:r.color,transition:Bo,initial:{opacity:0,y:-20},animate:{opacity:1,y:-5},exit:{opacity:0,y:-30},children:i("Observing {{ userName }}",{userName:r.name})})})})}));const PublicBreadcrumb=({documentId:e,shareId:t,sharedTree:o,children:i})=>{const r=w.useMemo((()=>function pathToDocument(e,t){let o=[];const traveler=(e,n)=>{e.forEach((e=>{const i=[...n,e];if(e.id!==t)return traveler(e.children,i);o=i}))};return e&&traveler([e],[]),o}(o,e).slice(0,-1).map((e=>({...e,icon:e.icon?n(q,{value:e.icon,color:e.color}):void 0,title:e.title,type:"route",to:fe(t,e.url)})))),[o,t,e]);return n(kt,{items:r,children:i})};const Lo=m((function ShareButton({document:o}){const{t:i}=e(),{shares:r}=f(),s=r.getByDocumentId(o.id),c=r.getByDocumentParents(o.id),l=s?.domain||c?.domain,d=Nt({gutter:0,placement:"bottom-end",unstable_fixed:!0});if(ge())return null;const u=o.isPubliclyShared?n(v.GlobeIcon,{}):void 0;return t(O,{children:[n($t,{...d,children:e=>t(pe,{icon:u,neutral:!0,...e,children:[i("Share")," ",l&&t(O,{children:["· ",l]})]})}),n(jt,{...d,"aria-label":i("Share"),width:400,scrollable:!1,children:n(at,{document:o,onRequestClose:d.hide,visible:d.visible})})]})}));const No=c(Ut).withConfig({componentId:"sc-yxvzzt-0"})(["transition:opacity 500ms ease-in-out;",""],(e=>e.$hidden&&"opacity: 0;")),$o=c(At).withConfig({componentId:"sc-yxvzzt-1"})(["padding-left:0;padding-right:4px;color:",";"],(e=>e.theme.slate)),Uo=m((function DocumentHeader({document:o,revision:i,shareId:r,isEditing:s,isDraft:c,isPublishing:l,isSaving:d,savingIsDisabled:u,publishingIsDisabled:p,sharedTree:h,onSelectTemplate:m,onSave:b}){const{t:C}=e(),{ui:x}=f(),I=be(),S=Ct({rejectOnEmpty:!1}),D=xt({rejectOnEmpty:!1}),{resolvedTheme:k}=x,T=ge(),E=!!i,M=useEditingFocus(),{hasHeadings:A,editor:F}=Ze(),B=qe(),V=w.useRef(null),R=ve(V),j=T||R.width<700,L=!!r,[N]=w.useState(o.isPersistedOnce),$=w.useCallback((()=>{b({done:!0})}),[b]),U=w.useCallback((()=>{L&&void 0===x.tocVisible?x.set({tocVisible:!1}):x.set({tocVisible:!x.tocVisible})}),[x,L]),W=rt({activeDocumentId:o?.id}),H=St(o),{isDeleted:z,isTemplate:_}=o,K=H.update&&_,G=S?.documentEmbeds,Z=!0===x.tocVisible&&!o.isTemplate||L&&!1!==x.tocVisible,J=n(g,{content:Z?C("Hide contents"):A?C("Show contents"):`${C("Show contents")} (${C("available when headings are added")})`,shortcut:`Ctrl+${ye}+h`,placement:"bottom",children:n(pe,{onClick:U,icon:n(v.TableOfContentsIcon,{}),borderOnHover:!0,neutral:!0})}),Y=n(At,{children:n(g,{content:C("Edit {{noun}}",{noun:o.noun}),shortcut:"e",placement:"bottom",children:n(pe,{as:P,icon:n(v.EditIcon,{}),to:{pathname:we(o),state:{sidebarContext:B}},neutral:!0,children:j?null:C("Edit")})})}),X=n(At,{children:n(g,{content:C("light"===k?"Switch to dark":"Switch to light"),placement:"bottom",children:n(pe,{icon:n("light"===k?v.SunIcon:v.MoonIcon,{}),onClick:()=>x.setTheme("light"===k?Ce.Dark:Ce.Light),neutral:!0,borderOnHover:!0})})});return Lt((e=>e.ctrlKey&&e.altKey&&"˙"===e.key),U,{allowInInput:!0}),r?n(No,{ref:V,$hidden:M,title:t(y,{gap:4,children:[o.icon&&n(q,{value:o.icon,color:o.color??void 0}),o.title]}),hasSidebar:h&&h.children?.length>0,left:j?A?n(Fo,{}):null:n(PublicBreadcrumb,{documentId:o.id,shareId:r,sharedTree:h,children:A?J:null}),actions:t(O,{children:[X,H.update&&!s?Y:n("div",{})]})}):n(O,{children:n(No,{ref:V,$hidden:M,hasSidebar:!0,left:j?n(Fo,{}):n(Tt,{document:o,children:o.isTemplate?null:t(O,{children:[J," ",n(Pt,{document:o,color:I.textSecondary})]})}),title:t(y,{gap:4,align:"center",children:[o.icon&&n(q,{value:o.icon,color:o.color??void 0}),o.title,o.isArchived&&n(vt,{children:C("Archived")})]}),actions:({isCompact:e})=>t(O,{children:[n(jo,{}),!l&&d&&D?.separateEditMode&&t($o,{children:[C("Saving"),"…"]}),!z&&!E&&H.listViews&&n(Po,{document:o,limit:e?3:void 0}),(s||!D?.separateEditMode)&&!_&&N&&H.update&&n(At,{children:n(Oo,{isCompact:e,document:o,onSelectTemplate:m})}),!s&&!E&&!_&&H.update&&n(At,{children:n(Lo,{document:o})}),(s||K)&&n(At,{children:n(g,{content:C("Save"),shortcut:`${xe}+enter`,placement:"bottom",children:n(pe,{context:W,action:_?st:void 0,onClick:_?void 0:$,disabled:u,neutral:c,hideIcon:!0,children:C(c?"Save draft":"Done editing")})})}),H.update&&!s&&D?.separateEditMode&&!E&&Y,H.update&&H.createChildDocument&&!E&&!e&&!j&&n(At,{children:n(Mo,{document:o,label:e=>n(g,{content:C("New document"),shortcut:"n",placement:"bottom",children:n(pe,{icon:n(v.PlusIcon,{}),...e,neutral:!0,children:C("New doc")})})})}),i&&i.createdAt!==o.updatedAt&&n(At,{children:n(g,{content:C("Restore version"),placement:"bottom",children:n(pe,{action:Wt,context:W,neutral:!0,hideOnActionDisabled:!0,children:C("Restore")})})}),H.publish&&n(At,{children:n(pe,{action:ct,context:W,disabled:p,hideOnActionDisabled:!0,hideIcon:!0,children:o.collectionId||o.isWorkspaceTemplate?C("Publish"):`${C("Publish")}…`})}),!z&&n(Ft,{}),n(At,{children:n(lt,{document:o,isRevision:E,label:e=>n(pe,{icon:n(v.MoreIcon,{}),...e,borderOnHover:!0,neutral:!0}),onFindAndReplace:F?.commands.openFindAndReplace,showToggleEmbeds:G,showDisplayOptions:!0})})]})})})}));const Wo=c(h).withConfig({componentId:"sc-1h4xary-0"})(["display:none;position:fixed;bottom:0;margin:20px;transition:opacity 500ms ease-in-out;"," ",";@media print{display:none;}"],(e=>e.$hidden&&"opacity: 0;"),d("tablet")`
    display: block;
  `),Ho=m((function KeyboardShortcutsButton(){const{t:t}=e(),{dialogs:o}=f(),i=useEditingFocus();return n(g,{content:t("Keyboard shortcuts"),shortcut:"?",children:n(Wo,{onClick:()=>{o.openGuide({title:t("Keyboard shortcuts"),content:n(Ie,{})})},$hidden:i,children:n(v.KeyboardIcon,{})})})})),MeasuredContainer=({as:e,name:t,children:o,...i})=>{const r=w.useRef(null),s=ve(r.current);return n(e,{...i,ref:r,style:{[`--${t}-width`]:`${s.width}px`,[`--${t}-height`]:`${s.height}px`},children:o})};function Days(t){const{t:o}=e(),i=De(new Date(t.dateTime),new Date);return n(O,{children:o("{{ count }} days",{count:i})})}function Notices({document:o,readOnly:i}){const{t:r}=e();return t(Se,{children:[o.isTemplate&&!i&&n(zt,{icon:n(v.ShapesIcon,{}),description:t(le,{children:["Highlight some text and use the ",n(zo,{})," control to add placeholders that can be filled out when creating new documents"]}),children:r("You’re editing a template")}),o.archivedAt&&!o.deletedAt&&t(zt,{icon:n(v.ArchiveIcon,{}),children:[r("Archived by {{userName}}",{userName:o.updatedBy?.name??r("Unknown")})," ",n(_t,{dateTime:o.updatedAt,addSuffix:!0})]}),o.deletedAt&&t(zt,{icon:n(v.TrashIcon,{}),description:function permanentlyDeletedDescription(){if(!o.permanentlyDeletedAt)return;const e=new Date(o.permanentlyDeletedAt)<new Date?(new Date).toISOString():o.permanentlyDeletedAt;return o.template?t(le,{children:["This template will be permanently deleted in"," ",n(Days,{dateTime:e})," unless restored."]}):t(le,{children:["This document will be permanently deleted in"," ",n(Days,{dateTime:e})," unless restored."]})}(),children:[r("Deleted by {{userName}}",{userName:o.updatedBy?.name??r("Unknown")})," ",n(_t,{dateTime:o.deletedAt,addSuffix:!0})]})]})}const zo=c(v.InputIcon).withConfig({componentId:"sc-13nk7e4-0"})(["position:relative;top:6px;margin-top:-6px;"]),_o=c(P).withConfig({componentId:"sc-1hh6a0t-0"})(["display:block;margin:2px -8px;padding:6px 8px;border-radius:8px;max-height:50vh;min-width:100%;overflow:hidden;position:relative;cursor:var(--pointer);&:",",&:active,&:focus{background:",";}"],ke,l("listItemHoverBackground")),Ko=c(y).withConfig({componentId:"sc-1hh6a0t-1"})(["color:",";margin-left:-4px;"],l("textSecondary")),Go=c.div.withConfig({componentId:"sc-1hh6a0t-2"})([""," font-size:14px;font-weight:500;line-height:1.25;padding-top:3px;color:",";font-family:",";"],Te(),l("text"),l("fontFamily"));const Zo=m((function ReferenceListItem({document:e,showCollection:o,anchor:i,shareId:r,sidebarContext:s,...c}){const{icon:l,color:d}=e,u=Pe(l)===Ee.Emoji,p=e instanceof Me?e.titleWithDefault:e.title;return n(_o,{to:{pathname:r?fe(r,e.url):e.url,hash:i?`d-${i}`:void 0,state:{title:e.title,sidebarContext:s}},...c,children:t(Ko,{gap:4,dir:"auto",children:[l?n(q,{value:l,color:d??void 0}):n(v.DocumentIcon,{}),n(Go,{children:u?p.replace(l,""):p})]})})}));const qo=m((function PublicReferences(o){const{t:i}=e(),{shareId:r,documentId:s,sharedTree:c}=o,l=w.useMemo((()=>{let e;return function findChildren(t){if(t)return t.id===s?e=t.children:t.children.forEach((t=>{e||findChildren(t)})),e}(c)||[]}),[s,c]);return l.length?t(O,{children:[n(Kt,{children:i("Documents")}),l.map((e=>n(Zo,{document:e,shareId:r},e.id)))]}):null}));const Jo=c.div.withConfig({componentId:"sc-e21yai-0"})(["position:relative;"]),Yo=c.div.withConfig({componentId:"sc-e21yai-1"})(["visibility:",";position:absolute;top:0;left:0;right:0;"],(({$active:e})=>e?"visible":"hidden")),Xo=m((function References({document:e}){const{collections:o,documents:i}=f(),r=xt(),s=Ae(),c=qe();w.useEffect((()=>{i.fetchBacklinks(e.id)}),[i,e.id]);const l=i.getBacklinkedDocuments(e.id),d=e.collectionId?o.get(e.collectionId):void 0,u=d?d.getChildrenForDocument(e.id):[],p=!!l.length,h=!!u.length,m=w.useRef(!p&&!h),g="#backlinks"===s.hash||!h,v=40*Math.max(l.length,u.length),y=m.current?b:w.Fragment;return p||h?t(y,{children:[t(Gt,{children:[h&&n(Zt,{to:{hash:"#children",state:{sidebarContext:c}},isActive:()=>!g,children:n(le,{children:"Documents"})}),p&&n(Zt,{to:{hash:"#backlinks",state:{sidebarContext:c}},isActive:()=>g,children:n(le,{children:"Backlinks"})})]}),t(Jo,{style:{height:v},children:[p&&n(Yo,{$active:g,children:l.map((t=>n(Zo,{anchor:e.urlId,document:t,showCollection:t.collectionId!==e.collectionId,sidebarContext:dt({document:t,user:r,currentContext:c})},t.id)))}),h&&n(Yo,{$active:!g,children:u.map((e=>{const t=i.get(e.id);return n(Zo,{document:t||e,showCollection:!1,sidebarContext:c},e.id)}))})]})]}):null}));const Qo=m((function RevisionViewer(e){const{document:o,children:i,revision:r}=e;return t(y,{auto:!0,column:!0,children:[n(Do,{documentId:r.documentId,title:r.title,icon:r.icon,color:r.color??te[0],readOnly:!0}),n(fo,{document:o,revision:r,to:B(o),rtl:r.rtl}),n(ut,{dangerouslySetInnerHTML:{__html:r.html},dir:r.dir,rtl:r.rtl}),i]})}));var en=Object.defineProperty,tn=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,o,n)=>{for(var i,r=n>1?void 0:n?tn(t,o):t,s=e.length-1;s>=0;s--)(i=e[s])&&(r=(n?i(t,o,r):i(r))||r);return n&&r&&en(t,o,r),r};let on=class extends w.Component{constructor(){super(...arguments),this.editor=w.createRef(),this.isUploading=!1,this.isSaving=!1,this.isPublishing=!1,this.isEditorDirty=!1,this.isEmpty=!0,this.title=this.props.document.title,this.replaceDocument=e=>{const t=this.editor.current;if(!t)return;const{view:o,schema:n}=t,i=Be.fromJSON(n,Ve.replaceTemplateVariables(e.data,this.props.auth.user));if(i&&o.dispatch(o.state.tr.setSelection(new Re(o.state.doc)).replaceSelectionWith(i)),this.isEditorDirty=!0,e instanceof Me&&(this.props.document.templateId=e.id,this.props.document.fullWidth=e.fullWidth),!this.title){const t=he.replaceTemplateVariables(e.title,this.props.auth.user);this.title=t,this.props.document.title=t}return e.icon&&(this.props.document.icon=e.icon),e.color&&(this.props.document.color=e.color),this.props.document.data=Ge(e.data),this.updateIsDirty(),this.onSave({autosave:!0,publish:!1,done:!1})},this.onSynced=async()=>{const{history:e,location:t,t:o}=this.props,n=t.state?.restore,i=t.state?.revisionId;if(!this.editor.current||!n)return;const r=await je.post("/revisions.info",{id:i});r&&(await this.replaceDocument(r.data),Le.success(o("Document restored")),e.replace(this.props.document.url,e.location.state))},this.onUndoRedo=e=>{R(e)&&(e.preventDefault(),e.shiftKey?this.props.readOnly||this.editor.current?.commands.redo():this.props.readOnly||this.editor.current?.commands.undo())},this.onMove=e=>{e.preventDefault();const{document:t,dialogs:o,t:i,abilities:r}=this.props;r.move&&o.openModal({title:i("Move document"),content:n(pt,{document:t})})},this.goToEdit=e=>{if(this.props.readOnly){e.preventDefault();const{document:t,abilities:o}=this.props;o.update&&this.props.history.push({pathname:we(t),state:{sidebarContext:this.props.location.state?.sidebarContext}})}else this.editor.current?.isBlurred&&(e.preventDefault(),this.editor.current?.focus())},this.goToHistory=e=>{if(!this.props.readOnly)return;if(e.ctrlKey)return;e.preventDefault();const{document:t,location:o}=this.props;o.pathname.endsWith("history")?this.props.history.push({pathname:t.url,state:{sidebarContext:this.props.location.state?.sidebarContext}}):this.props.history.push({pathname:ie(t),state:{sidebarContext:this.props.location.state?.sidebarContext}})},this.onPublish=e=>{e.preventDefault(),e.stopPropagation();const{document:t,dialogs:o,t:i}=this.props;t.publishedAt||(t?.collectionId?this.onSave({publish:!0,done:!0}):o.openModal({title:i("Publish document"),content:n(ht,{document:t})}))},this.onSave=async(e={})=>{const{document:t}=this.props;if(t.isSaving)return;const o=this.editor.current?.view.state.doc;if(o&&(!Ve.isEmpty(o)||""!==t.title.trim())&&(t.data=o.toJSON(),t.tasks=Ve.getTasksSummary(o),!e.autosave||this.isEditorDirty||t.isDirty())){this.isSaving=!0,this.isPublishing=!!e.publish;try{const o=await t.save(void 0,e);this.isEditorDirty=!1,e.done?(this.props.history.push({pathname:o.url,state:{sidebarContext:this.props.location.state?.sidebarContext}}),this.props.ui.setActiveDocument(o)):t.isNew&&(this.props.history.push({pathname:we(o),state:{sidebarContext:this.props.location.state?.sidebarContext}}),this.props.ui.setActiveDocument(o))}catch(n){Le.error(n.message)}finally{this.isSaving=!1,this.isPublishing=!1}}},this.autosave=Ne((()=>this.onSave({done:!1,autosave:!0})),3e3),this.updateIsDirty=$e((()=>{const{document:e}=this.props,t=this.editor.current?.view.state.doc;this.isEditorDirty=!ce(t?.toJSON(),e.data),this.isEmpty=(!t||Ve.isEmpty(t))&&!this.title})),this.updateIsDirtyDebounced=Ne(this.updateIsDirty,500),this.onFileUploadStart=$e((()=>{this.isUploading=!0})),this.onFileUploadStop=$e((()=>{this.isUploading=!1})),this.handleChangeTitle=$e((e=>{this.title=e,this.props.document.title=e,this.updateIsDirty(),this.autosave()})),this.handleChangeIcon=$e(((e,t)=>{this.props.document.icon=e,this.props.document.color=t,this.onSave()})),this.goBack=()=>{this.props.readOnly||this.props.history.push({pathname:this.props.document.url,state:{sidebarContext:this.props.location.state?.sidebarContext}})}}componentDidMount(){this.updateIsDirty()}componentDidUpdate(e){e.readOnly&&!this.props.readOnly&&this.updateIsDirty()}componentWillUnmount(){this.isEmpty&&this.props.document.createdBy?.id===this.props.auth.user?.id&&this.props.document.isDraft&&this.props.document.isActive&&this.props.document.hasEmptyTitle&&this.props.document.isPersistedOnce?this.props.document.delete():this.props.document.isDirty()&&this.props.document.save(void 0,{autosave:!0})}render(){const{document:e,revision:o,readOnly:r,abilities:s,auth:c,ui:l,shareId:d,tocPosition:u,t:p}=this.props,{team:h,user:m}=c,f=!!d,g=h&&!1===h.documentEmbeds||e.embedsDisabled,b=u??(h?.getPreference(F.TocPosition)||Ue.Left),v=b&&(f?!1!==l.tocVisible:!e.isTemplate&&!0===l.tocVisible),y=!(e.isArchived||e.isDeleted||o||f),C=d?this.props.match.url:We(this.props.match.url,e),x=Pe(e.icon)===Ee.Emoji,I=x?e.titleWithDefault.replace(e.icon,""):e.titleWithDefault,S=x?function emojiToUrl(e){return`data:image/svg+xml;data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${e}</text></svg>`}(e.icon):void 0;return t(Se,{showTitle:!0,children:[this.props.location.pathname!==C&&n(He,{to:{pathname:C,state:this.props.location.state,hash:this.props.location.hash}}),n(mt,{trigger:"m",handler:this.onMove}),n(mt,{trigger:"z",handler:this.onUndoRedo}),n(mt,{trigger:"e",handler:this.goToEdit}),n(mt,{trigger:"Escape",handler:this.goBack}),n(mt,{trigger:"h",handler:this.goToHistory}),n(mt,{trigger:"p",options:{allowInInput:!0},handler:e=>{R(e)&&e.shiftKey&&this.onPublish(e)}}),t(MeasuredContainer,{as:dn,name:"container",column:!0,auto:!0,children:[n(i,{title:I,favicon:S}),(this.isUploading||this.isSaving)&&n(bt,{}),t(io,{column:!0,children:[!r&&n(ze,{when:this.isUploading&&!this.isEditorDirty,message:p("Images are still uploading.\nAre you sure you want to discard them?")}),n(Uo,{document:e,revision:o,shareId:d,isDraft:e.isDraft,isEditing:!r&&!!m?.separateEditMode,isSaving:this.isSaving,isPublishing:this.isPublishing,publishingIsDisabled:e.isSaving||this.isPublishing||this.isEmpty,savingIsDisabled:e.isSaving||this.isEmpty,sharedTree:this.props.sharedTree,onSelectTemplate:this.replaceDocument,onSave:this.onSave}),n(nn,{fullWidth:e.fullWidth,tocPosition:b,children:n(w.Suspense,{fallback:n(sn,{docFullWidth:e.fullWidth,showContents:v,tocPosition:b,children:n(ft,{})}),children:o?n(cn,{docFullWidth:e.fullWidth,children:n(Qo,{document:e,revision:o,id:o.id})}):t(O,{children:[t(MeasuredContainer,{name:"document",as:sn,docFullWidth:e.fullWidth,showContents:v,tocPosition:b,children:[n(Notices,{document:e,readOnly:r}),v&&n(rn,{children:n(po,{})}),n(To,{id:e.id,ref:this.editor,multiplayer:y,shareId:d,isDraft:e.isDraft,template:e.isTemplate,document:e,value:r?e.data:void 0,defaultValue:e.data,embedsDisabled:g,onSynced:this.onSynced,onFileUploadStart:this.onFileUploadStart,onFileUploadStop:this.onFileUploadStop,onCreateLink:this.props.onCreateLink,onChangeTitle:this.handleChangeTitle,onChangeIcon:this.handleChangeIcon,onSave:this.onSave,onPublish:this.onPublish,onCancel:this.goBack,readOnly:r,canUpdate:s.update,canComment:s.comment,autoFocus:e.createdAt===e.updatedAt,children:d?n(un,{children:n(qo,{shareId:d,documentId:e.id,sharedTree:this.props.sharedTree})}):o?null:n(un,{children:n(Xo,{document:e})})},g?"disabled":"enabled")]}),v&&n(an,{docFullWidth:e.fullWidth,position:b,children:n(po,{})})]})})}),f&&!_e(window.location.origin).custom&&!c.user&&n(Branding,{href:"//www.getoutline.com?ref=sharelink"})]}),!f&&t(ln,{children:[n(Ho,{}),n(no,{})]})]},o?o.id:e.id)]})}};__decorateClass([Ke],on.prototype,"editor",2),__decorateClass([Ke],on.prototype,"isUploading",2),__decorateClass([Ke],on.prototype,"isSaving",2),__decorateClass([Ke],on.prototype,"isPublishing",2),__decorateClass([Ke],on.prototype,"isEditorDirty",2),__decorateClass([Ke],on.prototype,"isEmpty",2),__decorateClass([Ke],on.prototype,"title",2),on=__decorateClass([m],on);const nn=c.div.withConfig({componentId:"sc-1gec90z-0"})(["margin-top:4px;",";",";"],d("tablet")`
    display: grid;
    grid-template-columns: ${({fullWidth:e,tocPosition:t})=>e?t===Ue.Left?`${I.tocWidth}px minmax(0, 1fr)`:`minmax(0, 1fr) ${I.tocWidth}px`:"1fr minmax(0, calc(46em + 88px)) 1fr"};
  `,d("desktopLarge")`
    grid-template-columns: ${({fullWidth:e,tocPosition:t})=>e?t===Ue.Left?`${I.tocWidth}px minmax(0, 1fr)`:`minmax(0, 1fr) ${I.tocWidth}px`:"1fr minmax(0, calc(52em + 88px)) 1fr"};
  `),an=c.div.withConfig({componentId:"sc-1gec90z-1"})(["",";@media print{display:none;}"],d("tablet")`
    margin-top: calc(44px + 6vh);

    grid-row: 1;
    grid-column: ${({docFullWidth:e,position:t})=>t===Ue.Left?1:e?2:3};
    justify-self: ${({position:e})=>e===Ue.Left?"end":"start"};
  `),rn=c.div.withConfig({componentId:"sc-1gec90z-2"})(["display:none;margin:0 -12px;@media print{display:block;}"]),sn=c.div.withConfig({componentId:"sc-1gec90z-3"})(["padding:0 44px;",";"],d("tablet")`
    grid-row: 1;

    // Decides the editor column position & span
    grid-column: ${({docFullWidth:e,showContents:t,tocPosition:o})=>e?t?o===Ue.Left?2:1:"1 / -1":2};
  `),cn=c.div.withConfig({componentId:"sc-1gec90z-4"})(["padding:0 40px;",""],d("tablet")`
    grid-row: 1;
    grid-column: ${({docFullWidth:e})=>e?"1 / -1":2};
  `),ln=c.div.withConfig({componentId:"sc-1gec90z-5"})(["position:absolute;width:100%;text-align:right;display:flex;justify-content:flex-end;"]),dn=c(io).withConfig({componentId:"sc-1gec90z-6"})(["position:relative;background:",";"],l("background")),un=c.div.withConfig({componentId:"sc-1gec90z-7"})(["margin-top:16px;@media print{display:none;}"]),pn=Fe()(yt(Oe(on)));function Loading({location:e}){return t(io,{column:!0,auto:!0,children:[e.state?.title&&n(i,{title:e.state.title}),n(o,{children:n(ft,{})})]})}export{Yt as A,pn as D,ErrorOffline as E,Loading as L,Jt as a,eo as b};
