import{u as e,r as t,ab as o,cS as n,bZ as a,Q as i,cT as s,P as c,j as r,h as d,e as l,Z as m,V as p,bs as u,bv as h,M as g,Y as f,n as b,F as I,C as x,ai as y,a2 as w,X as v,d as C,z as D,A as j,cU as T,cV as B,a8 as E,a7 as S,p as A,o as k,a as N,ah as M,N as R}from"./index.mlCxaiYE.js";import{Y as z,Z as O,_ as P,$ as L,a0 as V,a1 as F,a2 as K,a3 as $,a4 as U,a5 as W,a6 as Q,a7 as H,a8 as Z,a9 as _,aa as X}from"./DocumentContext.hhTeDqBR.js";import{u as Y}from"./useCommandBarActions.tFGIorji.js";import{a as q}from"./revisions.HHg7AZxX.js";import{r as G,k as J,u as ee}from"./authenticated.03alztlO.js";import"./PlaceholderText.UNfhMHoO.js";import"./Scene.tZk0YIWv.js";import"./LoadingIndicatorBar.mGaD64ZX.js";import"./Switch.3DOmHSIs.js";import"./PopoverDisclosure.OO70kItq.js";import"./InputSelectPermission.lb2lIKIy.js";import"./TeamLogo.qV1feKYB.js";import"./useBoolean.4JQO1FDN.js";import"./useCurrentUser.zlImhYTS.js";import"./Badge.sHfYRIgC.js";import"./Item.dGEOVRdT.js";import"./Time.rp9cc_zo.js";import"./index.esm.XsAbwjVB.js";import"./useCurrentTeam.fRZpnoZU.js";import"./usePolicy.wYF8wJNp.js";import"./SharedLayoutContext.2BBc39h7.js";import"./urls.doI9odX4.js";import"./Notice.4wB6_cwE.js";import"./ButtonLink.tgoiIjKJ.js";import"./routeHelpers.MPg4vHxP.js";function SearchActions(){const{searches:n}=e();t.useEffect((()=>{n.isLoaded||n.isFetching||n.fetchPage({source:"app"})}),[n]);const{searchQuery:a}=o.useKBar((e=>({searchQuery:e.searchQuery})));return Y(a?[z(a)]:[],[a]),Y(n.recent.map(O)),null}var te=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,ne=(e=>(e.newCollectionSharing="newCollectionSharing",e))(ne||{});const ae={newCollectionSharing:!0},ie=class _FeatureFlags{static isEnabled(e){if(!1===this.initalized){this.cache=new Set;for(const e of Object.values(ne)){!0===n.get(e)&&this.cache.add(e)}this.initalized=!0}return!!this.cache.has(e)||(ae[e]??!1)}static enable(e){this.cache.add(e),n.set(e,!0)}static disable(e){this.cache.delete(e),n.set(e,!1)}};ie.cache=new Set,ie.initalized=!1;let se=ie;((e,t,o,n)=>{for(var a,i=n>1?void 0:n?oe(t,o):t,s=e.length-1;s>=0;s--)(a=e[s])&&(i=(n?a(t,o,i):a(i))||i);n&&i&&te(t,o,i)})([a],se,"cache",2);const ce=c({name:({t:e})=>e("Copy ID"),icon:r(d.CopyIcon,{}),keywords:"uuid",section:L,children:({currentTeamId:e,currentUserId:t,activeCollectionId:o,activeDocumentId:n})=>{function copyAndToast(e){e&&(f(e),m.success("Copied to clipboard"))}return[c({name:"Copy User ID",section:L,icon:r(d.CopyIcon,{}),visible:()=>!!t,perform:()=>copyAndToast(t)}),c({name:"Copy Team ID",section:L,icon:r(d.CopyIcon,{}),visible:()=>!!e,perform:()=>copyAndToast(e)}),c({name:"Copy Collection ID",icon:r(d.CopyIcon,{}),section:L,visible:()=>!!o,perform:()=>copyAndToast(o)}),c({name:"Copy Document ID",icon:r(d.CopyIcon,{}),section:L,visible:()=>!!n,perform:()=>copyAndToast(n)}),c({name:"Copy Team ID",icon:r(d.CopyIcon,{}),section:L,visible:()=>!!e,perform:()=>copyAndToast(e)}),c({name:"Copy Release ID",icon:r(d.CopyIcon,{}),section:L,visible:()=>!!l.VERSION,perform:()=>copyAndToast(l.VERSION)})]}});const re=c({name:"Start automatic typing",icon:r(d.EditIcon,{}),section:L,visible:({activeDocumentId:e})=>!!e&&"development"===l.ENVIRONMENT,perform:()=>{const e=setInterval((()=>{const e=function generateRandomText(){const e="abcdefghijklmno pqrstuvwxyzABCDEFGHIJKL MNOPQRSTUVWXYZ 0123456789\n";let t="";for(let o=0;o<Math.floor(10*Math.random())+1;o++)t+=e.charAt(Math.floor(66*Math.random()));return t}();document.execCommand("insertText",!1,e)}),250);window.addEventListener("keydown",(t=>{"Escape"===t.key&&e&&clearInterval(e)})),m.info("Automatic typing started, press Escape to stop")}}),de=c({name:({t:e})=>e("Clear IndexedDB cache"),icon:r(d.TrashIcon,{}),keywords:"cache clear database",section:L,perform:async({t:e})=>{p.push(u()),await async function deleteAllDatabases(){if("databases"in window.indexedDB){const e=await window.indexedDB.databases();for(const t of e)t.name&&window.indexedDB.deleteDatabase(t.name)}else await Promise.all(i.collections.orderedData.map((async e=>s(e.documents?.map(P)).map((async e=>{window.indexedDB.deleteDatabase(`document.${e.id}`)})))))}(),m.success(e("IndexedDB cache cleared"))}}),le=c({name:"Create 10 test users",icon:r(d.UserIcon,{}),section:L,visible:()=>"development"===l.ENVIRONMENT,perform:async()=>{await h.post("/developer.create_test_users",{count:10}),m.message("10 test users created")}}),me=c({name:"Create toast",section:L,visible:()=>"development"===l.ENVIRONMENT,perform:()=>{m.message("Hello world",{duration:3e4})}}),pe=c({name:({t:e})=>e("Toggle debug logging"),icon:r(d.ToolsIcon,{}),section:L,perform:({t:e})=>{g.debugLoggingEnabled=!g.debugLoggingEnabled,m.message(g.debugLoggingEnabled?e("Debug logging enabled"):e("Debug logging disabled"))}}),ue=c({name:"Toggle feature flag",icon:r(d.BeakerIcon,{}),section:L,visible:()=>"development"===l.ENVIRONMENT,children:Object.values(ne).map((e=>c({id:`flag-${e}`,name:e,selected:()=>se.isEnabled(e),section:L,perform:()=>{se.isEnabled(e)?(se.disable(e),m.success(`Disabled feature flag: ${e}`)):(se.enable(e),m.success(`Enabled feature flag: ${e}`))}})))}),he=[...V,...F,...G,...K,...$,...q,...U,...[c({name:({t:e})=>e("Development"),keywords:"debug",icon:r(d.ToolsIcon,{}),iconInContextMenu:!1,section:L,children:[ce,pe,ue,me,le,de,re]})],...J];const ge=b.div.withConfig({componentId:"sc-1ub0g51-0"})(["display:grid;grid-auto-flow:column;gap:4px;"]),fe=b(I).withConfig({componentId:"sc-1ub0g51-1"})(["align-items:center;justify-content:center;width:24px;height:24px;color:",";flex-shrink:0;"],x("textSecondary")),be=b.span.withConfig({componentId:"sc-1ub0g51-2"})(["color:",";"],x("textSecondary")),Ie=b(I).withConfig({componentId:"sc-1ub0g51-3"})([""," flex-shrink:1;"],y()),xe=b.div.withConfig({componentId:"sc-1ub0g51-4"})(["font-size:14px;padding:9px 12px;margin:0 8px;border-radius:4px;background:",";display:flex;align-items:center;justify-content:space-between;cursor:var(--pointer);"," user-select:none;min-width:0;",""],(e=>e.active?e.theme.menuItemSelected:"none"),y(),(e=>e.active&&w(["","{color:",";}"],fe,e.theme.text))),ye=b(d.BackIcon).withConfig({componentId:"sc-1ub0g51-5"})(["transform:rotate(180deg);flex-shrink:0;"]),we=t.forwardRef((function CommandBarItem({action:e,active:o,currentRootActionId:n},a){const i=v(),s=t.useMemo((()=>{if(!n)return e.ancestors;const t=e.ancestors.findIndex((e=>e.id===n));return e.ancestors.slice(t+1)}),[e.ancestors,n]);return C(xe,{active:o,ref:a,children:[C(Ie,{align:"center",gap:8,children:[r(fe,{children:e.icon?t.cloneElement(e.icon,{size:22}):r(d.ArrowIcon,{})}),s.map((e=>C(t.Fragment,{children:[r(be,{children:e.name}),r(ye,{color:i.textSecondary,size:22})]},e.id))),e.name,e.children?.length?"…":""]}),e.shortcut?.length?r(ge,{children:e.shortcut.map(((e,o)=>C(t.Fragment,{children:[o>0?C(D,{children:[" ",r(j,{size:"xsmall",type:"secondary",children:"then"})," "]}):"",e.split("+").map((e=>r(T,{children:B(e)},e)))]},e)))}):null]})}));function CommandBarResults(){const{results:e,rootActionId:t}=o.useMatches();return 0===e.length?null:r(ve,{children:r(o.KBarResults,{items:e,maxHeight:400,onRender:({item:e,active:o})=>"string"==typeof e?r(Ce,{type:"tertiary",size:"xsmall",ellipsis:!0,children:e}):r(we,{action:e,active:o,currentRootActionId:t})})})}const ve=b.div.withConfig({componentId:"sc-1jbe4rz-0"})(["> div{padding-bottom:8px;}"]),Ce=b(j).attrs({as:"h3"}).withConfig({componentId:"sc-1jbe4rz-1"})(["letter-spacing:0.03em;margin:0;padding:16px 0 4px 20px;height:36px;cursor:default;"]);const KBarPortal=({children:e})=>{const{showing:t}=o.useKBar((e=>({showing:"hidden"!==e.visualState})));return t?r(X,{children:e}):null},De=b(o.KBarPositioner).withConfig({componentId:"sc-13tjr2u-0"})(["z-index:",";"],M.commandBar),je=b(o.KBarSearch).withConfig({componentId:"sc-13tjr2u-1"})(["position:relative;padding:16px 12px;margin:0 8px;width:calc(100% - 16px);outline:none;border:none;background:",";color:",";&:not(:last-child){border-bottom:1px solid ",";}&:disabled,&::placeholder{color:",";opacity:1;}"],x("menuBackground"),x("text"),x("inputBorder"),x("placeholder")),Te=b(o.KBarAnimator).withConfig({componentId:"sc-13tjr2u-2"})(["max-width:600px;max-height:75vh;width:90vw;background:",";color:",";border-radius:8px;overflow:hidden;box-shadow:rgb(0 0 0 / 40%) 0px 16px 60px;transition:max-width 0.2s ease-in-out;",";@media print{display:none;}"],x("menuBackground"),x("text"),R("desktopLarge")`
    max-width: 740px;
  `),Be=k((function CommandBar(){const{t:o}=N(),n=((o=6)=>{const{documents:n,ui:a}=e();return t.useMemo((()=>n.recentlyViewed.filter((e=>e.id!==a.activeDocumentId)).slice(0,o).map((e=>c({name:e.titleWithDefault,analyticsName:"Recently viewed document",section:W,icon:e.icon?r(E,{value:e.icon,color:e.color??void 0}):r(d.DocumentIcon,{}),perform:()=>p.push(S(e))})))),[o,a.activeDocumentId,n.recentlyViewed])})(),a=(()=>{const e=ee(),o=t.useMemo((()=>e.map((e=>{const t=e.icon;return{id:e.path,name:e.name,icon:r(t,{}),section:Q,perform:()=>p.push(e.path)}}))),[e]);return t.useMemo((()=>c({id:"settings",name:({t:e})=>e("Settings"),section:Q,shortcut:["g","s"],icon:r(d.SettingsIcon,{}),children:()=>o})),[o])})(),i=(()=>{const{documents:o}=e();t.useEffect((()=>{o.fetchAllTemplates()}),[o]);const n=t.useMemo((()=>o.templatesAlphabetical.map((e=>c({name:e.titleWithDefault,analyticsName:"New document",section:e.isWorkspaceTemplate?H:Z,icon:e.icon?r(E,{value:e.icon,color:e.color??void 0}):r(d.NewDocumentIcon,{}),keywords:"create",visible:({currentTeamId:t,activeCollectionId:o,stores:n})=>o?n.policies.abilities(o).createDocument&&(e.collectionId===o||e.isWorkspaceTemplate):!!t&&n.policies.abilities(t).createDocument&&e.isWorkspaceTemplate,perform:({activeCollectionId:t,sidebarContext:o})=>p.push(A(e.collectionId??t,{templateId:e.id}),{sidebarContext:o})})))),[o.templatesAlphabetical]);return t.useMemo((()=>c({id:"templates",name:({t:e})=>e("New from template"),placeholder:({t:e})=>e("Choose a template"),section:_,icon:r(d.ShapesIcon,{}),visible:({currentTeamId:e,activeCollectionId:t,stores:o})=>t?o.policies.abilities(t).createDocument:!!e&&o.policies.abilities(e).createDocument,children:()=>n})),[n])})(),s=t.useMemo((()=>[...n,...he,i,a]),[n,a,i]);return Y(s),r(D,{children:r(KBarPortal,{children:r(De,{children:C(Te,{children:[r(SearchActions,{}),r(je,{defaultPlaceholder:`${o("Type a command or search")}…`}),r(CommandBarResults,{})]})})})})}));export{Be as default};
