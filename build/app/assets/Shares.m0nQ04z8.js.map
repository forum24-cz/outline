{"version":3,"file":"Shares.m0nQ04z8.js","sources":["../../../app/menus/ShareMenu.tsx","../../../app/scenes/Settings/components/SharesTable.tsx","../../../app/scenes/Settings/Shares.tsx"],"sourcesContent":["import { observer } from \"mobx-react\";\nimport { ArrowIcon, CopyIcon, TrashIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\nimport { useMenuState } from \"reakit/Menu\";\nimport { toast } from \"sonner\";\nimport Share from \"~/models/Share\";\nimport ContextMenu from \"~/components/ContextMenu\";\nimport MenuItem from \"~/components/ContextMenu/MenuItem\";\nimport OverflowMenuButton from \"~/components/ContextMenu/OverflowMenuButton\";\nimport CopyToClipboard from \"~/components/CopyToClipboard\";\nimport usePolicy from \"~/hooks/usePolicy\";\nimport useStores from \"~/hooks/useStores\";\n\ntype Props = {\n  share: Share;\n};\n\nfunction ShareMenu({ share }: Props) {\n  const menu = useMenuState({\n    modal: true,\n  });\n  const { shares } = useStores();\n  const { t } = useTranslation();\n  const history = useHistory();\n  const can = usePolicy(share);\n\n  const handleGoToDocument = React.useCallback(\n    (ev: React.SyntheticEvent) => {\n      ev.preventDefault();\n      history.push(share.documentUrl);\n    },\n    [history, share]\n  );\n\n  const handleRevoke = React.useCallback(\n    async (ev: React.SyntheticEvent) => {\n      ev.preventDefault();\n\n      try {\n        await shares.revoke(share);\n        toast.message(t(\"Share link revoked\"));\n      } catch (err) {\n        toast.error(err.message);\n      }\n    },\n    [t, shares, share]\n  );\n\n  const handleCopy = React.useCallback(() => {\n    toast.success(t(\"Share link copied\"));\n  }, [t]);\n\n  return (\n    <>\n      <OverflowMenuButton aria-label={t(\"Show menu\")} {...menu} />\n      <ContextMenu {...menu} aria-label={t(\"Share options\")}>\n        <CopyToClipboard text={share.url} onCopy={handleCopy}>\n          <MenuItem {...menu} icon={<CopyIcon />}>\n            {t(\"Copy link\")}\n          </MenuItem>\n        </CopyToClipboard>\n        <MenuItem {...menu} onClick={handleGoToDocument} icon={<ArrowIcon />}>\n          {t(\"Go to document\")}\n        </MenuItem>\n        {can.revoke && (\n          <>\n            <hr />\n            <MenuItem\n              {...menu}\n              onClick={handleRevoke}\n              icon={<TrashIcon />}\n              dangerous\n            >\n              {t(\"Revoke link\")}\n            </MenuItem>\n          </>\n        )}\n      </ContextMenu>\n    </>\n  );\n}\n\nexport default observer(ShareMenu);\n","import compact from \"lodash/compact\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { unicodeCLDRtoBCP47 } from \"@shared/utils/date\";\nimport Share from \"~/models/Share\";\nimport { Avatar, AvatarSize } from \"~/components/Avatar\";\nimport Flex from \"~/components/Flex\";\nimport { HEADER_HEIGHT } from \"~/components/Header\";\nimport {\n  type Props as TableProps,\n  SortableTable,\n} from \"~/components/SortableTable\";\nimport { type Column as TableColumn } from \"~/components/Table\";\nimport Time from \"~/components/Time\";\nimport useUserLocale from \"~/hooks/useUserLocale\";\nimport ShareMenu from \"~/menus/ShareMenu\";\nimport { formatNumber } from \"~/utils/language\";\n\nconst ROW_HEIGHT = 50;\n\ntype Props = Omit<TableProps<Share>, \"columns\" | \"rowHeight\"> & {\n  canManage: boolean;\n};\n\nexport function SharesTable({ data, canManage, ...rest }: Props) {\n  const { t } = useTranslation();\n  const language = useUserLocale();\n  const hasDomain = data.some((share) => share.domain);\n\n  const columns = React.useMemo<TableColumn<Share>[]>(\n    () =>\n      compact<TableColumn<Share>>([\n        {\n          type: \"data\",\n          id: \"title\",\n          header: t(\"Document\"),\n          accessor: (share) => share.documentTitle || t(\"Untitled\"),\n          sortable: false,\n          component: (share) => <>{share.documentTitle || t(\"Untitled\")}</>,\n          width: \"4fr\",\n        },\n        {\n          type: \"data\",\n          id: \"createdBy\",\n          header: t(\"Shared by\"),\n          accessor: (share) => share.createdBy,\n          sortable: false,\n          component: (share) => (\n            <Flex align=\"center\" gap={8}>\n              {share.createdBy && (\n                <>\n                  <Avatar model={share.createdBy} size={AvatarSize.Small} />\n                  {share.createdBy.name}\n                </>\n              )}\n            </Flex>\n          ),\n          width: \"2fr\",\n        },\n        {\n          type: \"data\",\n          id: \"createdAt\",\n          header: t(\"Date shared\"),\n          accessor: (share) => share.createdAt,\n          component: (share) =>\n            share.createdAt ? (\n              <Time dateTime={share.createdAt} addSuffix />\n            ) : null,\n          width: \"2fr\",\n        },\n        {\n          type: \"data\",\n          id: \"lastAccessedAt\",\n          header: t(\"Last accessed\"),\n          accessor: (share) => share.lastAccessedAt,\n          component: (share) =>\n            share.lastAccessedAt ? (\n              <Time dateTime={share.lastAccessedAt} addSuffix />\n            ) : null,\n          width: \"2fr\",\n        },\n        hasDomain\n          ? {\n              type: \"data\",\n              id: \"domain\",\n              header: t(\"Domain\"),\n              accessor: (share) => share.domain,\n              sortable: false,\n              component: (share) => <>{share.domain}</>,\n              width: \"1.5fr\",\n            }\n          : undefined,\n        {\n          type: \"data\",\n          id: \"views\",\n          header: t(\"Views\"),\n          accessor: (share) => share.views,\n          component: (share) => (\n            <>\n              {language\n                ? formatNumber(share.views, unicodeCLDRtoBCP47(language))\n                : share.views}\n            </>\n          ),\n          width: \"150px\",\n        },\n        canManage\n          ? {\n              type: \"action\",\n              id: \"action\",\n              component: (share) => (\n                <Flex align=\"center\">\n                  <ShareMenu share={share} />\n                </Flex>\n              ),\n              width: \"50px\",\n            }\n          : undefined,\n      ]),\n    [t, language, hasDomain, canManage]\n  );\n\n  return (\n    <SortableTable\n      data={data}\n      columns={columns}\n      rowHeight={ROW_HEIGHT}\n      stickyOffset={HEADER_HEIGHT}\n      {...rest}\n    />\n  );\n}\n","import { ColumnSort } from \"@tanstack/react-table\";\nimport { observer } from \"mobx-react\";\nimport { GlobeIcon, WarningIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport { Link, useHistory, useLocation } from \"react-router-dom\";\nimport { toast } from \"sonner\";\nimport { ConditionalFade } from \"~/components/Fade\";\nimport Heading from \"~/components/Heading\";\nimport InputSearch from \"~/components/InputSearch\";\nimport Notice from \"~/components/Notice\";\nimport Scene from \"~/components/Scene\";\nimport Text from \"~/components/Text\";\nimport useCurrentTeam from \"~/hooks/useCurrentTeam\";\nimport usePolicy from \"~/hooks/usePolicy\";\nimport useQuery from \"~/hooks/useQuery\";\nimport useStores from \"~/hooks/useStores\";\nimport { useTableRequest } from \"~/hooks/useTableRequest\";\nimport { SharesTable } from \"./components/SharesTable\";\nimport { StickyFilters } from \"./components/StickyFilters\";\n\nfunction Shares() {\n  const team = useCurrentTeam();\n  const { t } = useTranslation();\n  const location = useLocation();\n  const history = useHistory();\n  const { shares, auth } = useStores();\n  const canShareDocuments = auth.team && auth.team.sharing;\n  const can = usePolicy(team);\n  const params = useQuery();\n  const [query, setQuery] = React.useState(\"\");\n\n  const reqParams = React.useMemo(\n    () => ({\n      query: params.get(\"query\") || undefined,\n      sort: params.get(\"sort\") || \"createdAt\",\n      direction: (params.get(\"direction\") || \"desc\").toUpperCase() as\n        | \"ASC\"\n        | \"DESC\",\n    }),\n    [params]\n  );\n\n  const sort: ColumnSort = React.useMemo(\n    () => ({\n      id: reqParams.sort,\n      desc: reqParams.direction === \"DESC\",\n    }),\n    [reqParams.sort, reqParams.direction]\n  );\n\n  const { data, error, loading, next } = useTableRequest({\n    data: shares.findByQuery(reqParams.query ?? \"\"),\n    sort,\n    reqFn: shares.fetchPage,\n    reqParams,\n  });\n\n  const updateParams = React.useCallback(\n    (name: string, value: string) => {\n      if (value) {\n        params.set(name, value);\n      } else {\n        params.delete(name);\n      }\n\n      history.replace({\n        pathname: location.pathname,\n        search: params.toString(),\n      });\n    },\n    [params, history, location.pathname]\n  );\n\n  const handleSearch = React.useCallback((event) => {\n    const { value } = event.target;\n    setQuery(value);\n  }, []);\n\n  React.useEffect(() => {\n    if (error) {\n      toast.error(t(\"Could not load shares\"));\n    }\n  }, [t, error]);\n\n  React.useEffect(() => {\n    const timeout = setTimeout(() => updateParams(\"query\", query), 250);\n    return () => clearTimeout(timeout);\n  }, [query, updateParams]);\n\n  return (\n    <Scene title={t(\"Shared Links\")} icon={<GlobeIcon />} wide>\n      <Heading>{t(\"Shared Links\")}</Heading>\n\n      {can.update && !canShareDocuments && (\n        <>\n          <Notice icon={<WarningIcon />}>\n            {t(\"Sharing is currently disabled.\")}{\" \"}\n            <Trans\n              defaults=\"You can globally enable and disable public document sharing in the <em>security settings</em>.\"\n              components={{\n                em: <Link to=\"/settings/security\" />,\n              }}\n            />\n          </Notice>\n          <br />\n        </>\n      )}\n\n      <Text as=\"p\" type=\"secondary\">\n        <Trans>\n          Documents that have been shared are listed below. Anyone that has the\n          public link can access a read-only version of the document until the\n          link has been revoked.\n        </Trans>\n      </Text>\n\n      <StickyFilters gap={8}>\n        <InputSearch\n          short\n          value={query}\n          placeholder={`${t(\"Filter\")}…`}\n          onChange={handleSearch}\n        />\n      </StickyFilters>\n      <ConditionalFade animate={!data}>\n        <SharesTable\n          data={data ?? []}\n          sort={sort}\n          canManage={can.update}\n          loading={loading}\n          page={{\n            hasNext: !!next,\n            fetchNext: next,\n          }}\n        />\n      </ConditionalFade>\n    </Scene>\n  );\n}\n\nexport default observer(Shares);\n"],"names":["observer","ShareMenu","share","menu","useMenuState","modal","shares","useStores","t","useTranslation","history","useHistory","can","usePolicy","handleGoToDocument","React","ev","preventDefault","push","documentUrl","handleRevoke","async","revoke","message","err","error","handleCopy","success","jsxs","Fragment","children","jsx","OverflowMenuButton","ContextMenu","CopyToClipboard","text","url","onCopy","MenuItem","icon","CopyIcon","onClick","ArrowIcon","TrashIcon","dangerous","SharesTable","data","canManage","rest","language","useUserLocale","hasDomain","some","domain","columns","compact","type","id","header","accessor","documentTitle","sortable","component","width","createdBy","Flex","align","gap","Avatar","model","size","AvatarSize","Small","name","createdAt","Time","dateTime","addSuffix","lastAccessedAt","undefined","views","formatNumber","unicodeCLDRtoBCP47","SortableTable","rowHeight","stickyOffset","HEADER_HEIGHT","Shares","team","useCurrentTeam","location","useLocation","auth","canShareDocuments","sharing","params","useQuery","query","setQuery","reqParams","get","sort","direction","toUpperCase","desc","loading","next","useTableRequest","findByQuery","reqFn","fetchPage","updateParams","value","set","delete","replace","pathname","search","toString","handleSearch","event","target","timeout","setTimeout","clearTimeout","Scene","title","GlobeIcon","wide","Heading","update","Notice","WarningIcon","Trans","defaults","components","em","Link","to","Text","as","StickyFilters","InputSearch","short","placeholder","onChange","ConditionalFade","animate","page","hasNext","fetchNext"],"mappings":"qjCAoFA,MAAeA,EAAAA,GAjEf,SAASC,WAAUC,MAAEA,IACnB,MAAMC,EAAOC,EAAa,CACxBC,OAAO,KAEHC,OAAEA,GAAWC,KACbC,EAAEA,GAAMC,IACRC,EAAUC,IACVC,EAAMC,EAAUX,GAEhBY,EAAqBC,eACxBC,IACCA,EAAGC,iBACKC,EAAAA,KAAKhB,EAAMiB,YAAW,GAEhC,CAACT,EAASR,IAGNkB,EAAeL,eACnBM,MAAOL,IACLA,EAAGC,iBAEC,UACIX,EAAOgB,OAAOpB,GACdqB,EAAAA,QAAQf,EAAE,6BACTgB,GACDC,EAAAA,MAAMD,EAAID,QAClB,IAEF,CAACf,EAAGF,EAAQJ,IAGRwB,EAAaX,EAAAA,aAAkB,KAC7BY,EAAAA,QAAQnB,EAAE,qBAAoB,GACnC,CAACA,IAIA,OAAAoB,EAAAC,EAAA,CAAAC,SAAA,CAAAC,EAACC,GAAmB,aAAYxB,EAAE,gBAAkBL,MACnD8B,EAAY,IAAI9B,EAAM,aAAYK,EAAE,iBACnCsB,SAAA,CAAAC,EAACG,GAAgBC,KAAMjC,EAAMkC,IAAKC,OAAQX,EACxCI,SAACC,EAAAO,EAAA,IAAanC,EAAMoC,KAAOC,EAAAA,EAAAA,SAAA,IACxBhC,SAAEA,EAAA,mBAGN8B,EAAA,IAAanC,EAAMsC,QAAS3B,EAAoByB,KAAMR,EAACW,gBACrDlC,SAAEA,EAAA,oBAEJI,EAAIU,QAEDM,EAAAC,EAAA,CAAAC,SAAA,CAAAC,EAAC,KAAE,IACFA,EAAAO,EAAA,IACKnC,EACJsC,QAASrB,EACTmB,KAAOI,EAAAA,EAAAA,UAAA,CAAS,GAChBC,WAAS,EAERpC,SAAAA,EAAE,yBAOjB,IC1DO,SAASqC,aAAYC,KAAEA,EAAAA,UAAMC,KAAcC,IAC1C,MAAAxC,EAAEA,GAAMC,IACRwC,EAAWC,IACXC,EAAYL,EAAKM,MAAMlD,GAAUA,EAAMmD,SAEvCC,EAAUvC,EAAAA,SACd,IACEwC,EAA4B,CAC1B,CACEC,KAAM,OACNC,GAAI,QACJC,OAAQlD,EAAE,YACVmD,SAAWzD,GAAUA,EAAM0D,eAAiBpD,EAAE,YAC9CqD,UAAU,EACVC,UAAsB5D,GAAA6B,EAAAF,EAAA,CAAG3B,WAAM0D,eAAiBpD,EAAE,cAClDuD,MAAO,OAET,CACEP,KAAM,OACNC,GAAI,YACJC,OAAQlD,EAAE,aACVmD,YAAqBzD,EAAM8D,UAC3BH,UAAU,EACVC,UACE5D,GAAC6B,EAAAkC,EAAK,CAAAC,MAAM,SAASC,IAAK,EACvBjE,SAAM8D,EAAAA,WAEHpC,EAAAC,EAAA,CAAAC,SAAA,CAAAC,EAACqC,GAAOC,MAAOnE,EAAM8D,UAAWM,KAAMC,EAAWC,QAChDtE,EAAM8D,UAAUS,UAKzBV,MAAO,OAET,CACEP,KAAM,OACNC,GAAI,YACJC,OAAQlD,EAAE,eACVmD,YAAqBzD,EAAMwE,UAC3BZ,UACE5D,GAAAA,EAAMwE,UACH3C,EAAA4C,EAAK,CAAAC,SAAU1E,EAAMwE,UAAWG,WAAS,IACxC,KACNd,MAAO,OAET,CACEP,KAAM,OACNC,GAAI,iBACJC,OAAQlD,EAAE,iBACVmD,YAAqBzD,EAAM4E,eAC3BhB,UACE5D,GAAAA,EAAM4E,eACH/C,EAAA4C,EAAK,CAAAC,SAAU1E,EAAM4E,eAAgBD,WAAS,IAC7C,KACNd,MAAO,OAETZ,EACI,CACEK,KAAM,OACNC,GAAI,SACJC,OAAQlD,EAAE,UACVmD,YAAqBzD,EAAMmD,OAC3BQ,UAAU,EACVC,UAAY5D,GAAaA,EAAAA,EAAAA,CAAAA,SAAAA,EAAMmD,SAC/BU,MAAO,cAETgB,EACJ,CACEvB,KAAM,OACNC,GAAI,QACJC,OAAQlD,EAAE,SACVmD,YAAqBzD,EAAM8E,MAC3BlB,UAAY5D,GAEP+C,EAAAA,EAAAA,CAAAA,SAAAA,EACGgC,EAAa/E,EAAM8E,MAAOE,EAAmBjC,IAC7C/C,EAAM8E,QAGdjB,MAAO,SAEThB,EACI,CACES,KAAM,SACNC,GAAI,SACJK,aACG/B,EAAAkC,EAAA,CAAKC,MAAM,SACVpC,WAAC7B,EAAU,CAAAC,YAGf6D,MAAO,aAETgB,KAER,CAACvE,EAAGyC,EAAUE,EAAWJ,IAIzB,OAAAhB,EAACoD,GACCrC,OACAQ,UACA8B,UA5Ga,GA6GbC,aAAcC,KACVtC,GAGV,CCUA,MAAehD,EAAAA,GAxHf,SAASuF,SACP,MAAMC,EAAOC,KACPjF,EAAEA,GAAMC,IACRiF,EAAWC,IACXjF,EAAUC,KACVL,OAAEA,EAAAA,KAAQsF,GAASrF,IACnBsF,EAAoBD,EAAKJ,MAAQI,EAAKJ,KAAKM,QAC3ClF,EAAMC,EAAU2E,GAChBO,EAASC,KACRC,EAAOC,GAAYnF,WAAe,IAEnCoF,EAAYpF,EAAAA,SAChB,KAAO,CACLkF,MAAOF,EAAOK,IAAI,eAAYrB,EAC9BsB,KAAMN,EAAOK,IAAI,SAAW,YAC5BE,WAAYP,EAAOK,IAAI,cAAgB,QAAQG,iBAIjD,CAACR,IAGGM,EAAmBtF,EAAAA,SACvB,KAAO,CACL0C,GAAI0C,EAAUE,KACdG,KAA8B,SAAxBL,EAAUG,aAElB,CAACH,EAAUE,KAAMF,EAAUG,aAGvBxD,KAAEA,EAAAA,MAAMrB,EAAAA,QAAOgF,EAAAA,KAASC,GAASC,EAAgB,CACrD7D,KAAMxC,EAAOsG,YAAYT,EAAUF,OAAS,IAC5CI,OACAQ,MAAOvG,EAAOwG,UACdX,cAGIY,EAAehG,EAAAA,aACnB,CAAC0D,EAAcuC,KACTA,EACKC,EAAAA,IAAIxC,EAAMuC,GAEjBjB,EAAOmB,OAAOzC,GAGhB/D,EAAQyG,QAAQ,CACdC,SAAU1B,EAAS0B,SACnBC,OAAQtB,EAAOuB,YAChB,GAEH,CAACvB,EAAQrF,EAASgF,EAAS0B,WAGvBG,EAAexG,eAA6ByG,IAC1C,MAAAR,MAAEA,GAAUQ,EAAMC,OACxBvB,EAASc,EAAK,GACb,IAcD,OAZFjG,EAAAA,WAAgB,KACVU,GACIA,EAAAA,MAAMjB,EAAE,yBAChB,GACC,CAACA,EAAGiB,IAEPV,EAAAA,WAAgB,KACd,MAAM2G,EAAUC,YAAW,IAAMZ,EAAa,QAASd,IAAQ,KACxD,MAAA,IAAM2B,aAAaF,EAAO,GAChC,CAACzB,EAAOc,MAGRc,EAAM,CAAAC,MAAOtH,EAAE,gBAAiB+B,KAAOwF,EAAAA,EAAAA,UAAA,CAAY,GAAEC,MAAI,EACxDlG,SAAA,GAACmG,EAAA,CAASzH,SAAEA,EAAA,kBAEXI,EAAIsH,SAAWrC,GAEZjE,EAAAC,EAAA,CAAAC,SAAA,CAAAF,EAACuG,EAAO,CAAA5F,KAAOR,EAAAqG,cAAA,CAAA,GACZ5H,SAAAA,CAAAA,EAAE,kCAAmC,IACrCuB,EAAAsG,EAAA,CACCC,SAAS,iGACTC,WAAY,CACVC,GAAKzG,EAAA0G,EAAK,CAAAC,GAAG,+BAIlB,KAAE,OAIN3G,EAAA4G,GAAKC,GAAG,IAAIpF,KAAK,YAChB1B,SAAAC,EAACsG,EAAK,CAAAvG,SAAA,0KAOP+G,EAAc,CAAA1E,IAAK,EAClBrC,SAACC,EAAA+G,EAAA,CACCC,OAAK,EACL/B,MAAOf,EACP+C,YAAa,GAAGxI,EAAE,aAClByI,SAAU1B,QAGb2B,EAAgB,CAAAC,SAAUrG,EACzBhB,SAACC,EAAAc,YACC,CAAAC,KAAMA,GAAQ,GACduD,OACAtD,UAAWnC,EAAIsH,OACfzB,UACA2C,KAAM,CACJC,UAAW3C,EACX4C,UAAW5C,SAMvB"}