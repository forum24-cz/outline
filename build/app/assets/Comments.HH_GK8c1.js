const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmojiPanel.TJcM4M0j.js","assets/index.mlCxaiYE.js","assets/DocumentContext.hhTeDqBR.js","assets/PlaceholderText.UNfhMHoO.js","assets/Scene.tZk0YIWv.js","assets/LoadingIndicatorBar.mGaD64ZX.js","assets/Switch.3DOmHSIs.js","assets/PopoverDisclosure.OO70kItq.js","assets/InputSelectPermission.lb2lIKIy.js","assets/TeamLogo.qV1feKYB.js","assets/useBoolean.4JQO1FDN.js","assets/useCurrentUser.zlImhYTS.js","assets/Badge.sHfYRIgC.js","assets/Item.dGEOVRdT.js","assets/Time.rp9cc_zo.js","assets/index.esm.XsAbwjVB.js","assets/useCurrentTeam.fRZpnoZU.js","assets/usePolicy.wYF8wJNp.js","assets/SharedLayoutContext.2BBc39h7.js","assets/Emoji.r_ABO2XC.js"])))=>i.map(i=>d[i]);
import{b as e,cW as t,n,a0 as o,C as a,a1 as r,a2 as i,an as s,A as c,o as d,j as l,d as m,F as u,T as p,z as h,a as g,u as f,a5 as b,M as y,_ as v,bl as x,ak as C,h as w,a6 as k,am as I,Z as S,r as j,P as R,Q as T,V as D,Y as $,cX as O,cY as A,aX as E,cZ as z,c_ as B,N,c$ as P,G as M,d0 as U,X as F,d1 as L,bR as H,d2 as _,c2 as V,d3 as q,d4 as Q,k as Y,i as X,w as W,aQ as Z,d5 as G,q as J,bk as K,bE as ee,d6 as te,aI as ne,aZ as oe,al as ae,E as re}from"./index.mlCxaiYE.js";import{ab as ie,e as se,a9 as ce,b as de,u as le,O as me,T as ue,ac as pe,ad as he,ae as ge,f as fe,m as be,a as ye,A as ve}from"./DocumentContext.hhTeDqBR.js";import{u as xe}from"./useBoolean.4JQO1FDN.js";import{u as Ce}from"./useCurrentUser.zlImhYTS.js";import{u as we}from"./useFocusedComment.Wp-Vuc-6.js";import{P as ke,u as Ie}from"./Switch.3DOmHSIs.js";import{u as Se}from"./usePolicy.wYF8wJNp.js";import{a as je,A as Re}from"./TeamLogo.qV1feKYB.js";import{a as Te,C as De}from"./InputSelectPermission.lb2lIKIy.js";import{E as $e,a as Oe,b as Ae,u as Ee}from"./Emoji.r_ABO2XC.js";import{P as ze}from"./PlaceholderText.UNfhMHoO.js";import{u as Be,P as Ne}from"./PopoverDisclosure.OO70kItq.js";import{T as Pe}from"./Time.rp9cc_zo.js";import{C as Me,e as Ue}from"./Item.dGEOVRdT.js";import{I as Fe}from"./InputSelectNew.MYEDp3D-.js";import{F as Le}from"./Facepile.0K3TyxgD.js";import{S as He}from"./SidebarLayout.Ev8iLcgK.js";import"./Scene.tZk0YIWv.js";import"./LoadingIndicatorBar.mGaD64ZX.js";import"./Badge.sHfYRIgC.js";import"./index.esm.XsAbwjVB.js";import"./useCurrentTeam.fRZpnoZU.js";import"./SharedLayoutContext.2BBc39h7.js";const _e=n(o).withConfig({componentId:"sc-vnwntk-0"})(["width:auto;height:28px;padding:6px;border-radius:12px;background:",";pointer-events:",";&:","{background:",";}",""],a("backgroundTertiary"),(({disabled:e})=>e&&"none"),r,a("backgroundQuaternary"),(e=>e.$active&&i(["background:",";&:","{background:",";}"],s(.7,e.theme.accent),r,s(.5,e.theme.accent)))),Ve=n(c).withConfig({componentId:"sc-vnwntk-1"})(["font-size:11px;color:",";padding-right:1px;font-variant-numeric:tabular-nums;"],a("buttonNeutralText")),qe=d((({reaction:t,reactedUsers:n,disabled:o,onAddReaction:a,onRemoveReaction:r})=>{const i=Ce(),s=t.userIds.includes(i.id),c=(({reactedUsers:e,currUser:t,emoji:n,active:o})=>{const{t:a}=g();if(!e.length)return;const r=`:${ie(n)}:`;switch(e.length){case 1:return a("{{ username }} reacted with {{ emoji }}",{username:o?a("You"):e[0].name,emoji:r});case 2:{const n=o?a("You"):e[0].name;return a("{{ firstUsername }} and {{ secondUsername }} reacted with {{ emoji }}",{firstUsername:n,secondUsername:o?e.find((e=>e.id!==t.id))?.name:e[1].name,emoji:r})}default:{const t=o?a("You"):e[0].name;return a("{{ firstUsername }} and {{ count }} others reacted with {{ emoji }}",{firstUsername:t,count:e.length-1,emoji:r})}}})({reactedUsers:n,currUser:i,emoji:t.emoji,active:s}),d=e.useCallback((e=>{e.stopPropagation(),s?r(t.emoji):a(t.emoji)}),[t,s,a,r]),f=e.useMemo((()=>l(_e,{disabled:o,$active:s,onClick:d,children:m(u,{gap:6,justify:"center",align:"center",children:[l($e,{size:15,children:t.emoji}),l(Ve,{weight:"xbold",children:t.userIds.length})]})})),[t.emoji,t.userIds,o,s,d]);return c?l(p,{content:c,placement:"bottom",children:f}):l(h,{children:f})})),Qe=d((({model:n,onAddReaction:o,onRemoveReaction:a,className:r,picker:i})=>{const{users:s}=f(),c=e.useRef(null),d=(({ref:n,duration:o})=>{const[a,r]=e.useState(!1),i=e.useRef(),s=e.useCallback((()=>{i.current&&clearTimeout(i.current),i.current=window.setTimeout((()=>r(!0)),o)}),[o]),c=e.useCallback((()=>{i.current&&clearTimeout(i.current)}),[]);return t((()=>{i.current&&clearTimeout(i.current)})),e.useEffect((()=>{n.current&&(n.current.onmouseenter=s,n.current.onmouseleave=c)}),[n,s,c]),a})({ref:c,duration:250});e.useEffect((()=>{d&&(async()=>{try{await n.loadReactedUsersData()}catch(e){y.warn("Could not prefetch reaction data")}})()}),[d,n]);const p=!!n.reactions.length,h=e.useMemo((()=>{if(p)return{minHeight:28}}),[p]);return l(se,{style:h,children:m(u,{ref:c,className:r,align:"center",gap:6,wrap:!0,children:[n.reactions.map((e=>{const t=b(e.userIds.map((e=>s.get(e))));return l(qe,{reaction:e,reactedUsers:t,disabled:n.isResolved,onAddReaction:o,onRemoveReaction:a},e.emoji)})),i]})})})),Ye=e.lazy((()=>v((()=>import("./EmojiPanel.TJcM4M0j.js").then((e=>e.a))),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19])))),ReactionPicker=({onSelect:t,onOpen:n,onClose:a,className:r,size:i})=>{const{t:s}=g(),c=Be({modal:!0,unstable_offset:[0,0],placement:"bottom-end"}),{width:d}=x(),u=C(),[f,b]=e.useState(""),y=e.useRef(null),v=u?d:300,I=u?d-16:v,{toggle:S,hide:j}=c,R=e.useCallback((e=>{e.stopPropagation(),S()}),[S]),T=e.useCallback((e=>{j(),t(e)}),[j,t]);return e.useEffect((()=>{c.visible?n?.():a?.()}),[c.visible,n,a]),Te(y,(e=>{c.visible&&!c.unstable_disclosureRef.current?.contains(e.target)&&(e.stopPropagation(),e.preventDefault(),c.hide())}),{capture:!0}),m(h,{children:[l(Ne,{...c,children:e=>l(p,{content:s("Add reaction"),placement:"top",hideOnClick:!0,children:l(o,{...e,"aria-label":s("Reaction picker"),className:r,onClick:R,size:i,children:l(w.ReactionIcon,{size:22})})})}),l(ke,{...c,ref:y,width:v,shrink:!0,"aria-label":s("Reaction picker"),onClick:e=>e.stopPropagation(),hideOnClickOutside:!1,children:c.visible&&l(e.Suspense,{fallback:l(Xe,{}),children:l(k,{children:l(Ye,{height:300,panelWidth:I,query:f,onEmojiChange:T,onQueryChange:b,panelActive:!0})})})})]})},Xe=e.memo((()=>m(u,{column:!0,gap:6,style:{height:"300px",padding:"6px 12px"},children:[m(u,{gap:8,children:[l(ze,{height:32,minWidth:90}),l(ze,{height:32,width:32})]}),l(ze,{height:24,width:120})]})),(()=>!0));Xe.displayName="ReactionPickerPlaceholder";const We=d((function CommentDeleteDialog({comment:e,onSubmit:t}){const{comments:n}=f(),{t:o}=g(),a=n.inThread(e.id).length>1;return l(Me,{onSubmit:async()=>{try{await e.delete(),t?.()}catch(n){S.error(n.message)}},submitText:o("I’m sure – Delete"),savingText:`${o("Deleting")}…`,danger:!0,children:l(c,{as:"p",type:"secondary",children:l(I,a?{children:"Are you sure you want to permanently delete this entire comment thread?"}:{children:"Are you sure you want to permanently delete this comment?"})})})})),Ze=e.memo((()=>m(h,{children:[m(Ge,{gap:8,style:{paddingBottom:"10px"},children:[l(ze,{width:40,height:32}),l(ze,{width:40,height:32})]}),m(et,{align:"center",gap:12,children:[l(ze,{width:je.Medium,height:je.Medium}),l(ze,{height:34})]}),m(et,{align:"center",gap:12,children:[l(ze,{width:je.Medium,height:je.Medium}),l(ze,{height:34})]})]})),(()=>!0));Ze.displayName="ViewReactionsPlaceholder";const Ge=n(u).withConfig({componentId:"sc-1iax82q-0"})(["border-bottom:1px solid ",";"],a("inputBorder")),Je=n(Oe).withConfig({componentId:"sc-1iax82q-1"})(["position:relative;font-weight:500;font-size:14px;cursor:var(--pointer);background:none;border:0;border-radius:4px 4px 0 0;padding:8px 12px 10px;user-select:none;transition:background-color 100ms ease;&:","{background-color:",";}",""],r,a("listItemHoverBackground"),(({$active:e})=>e&&i(['&:after{content:"";position:absolute;bottom:0;left:0;right:0;height:1px;background:',";}"],a("textSecondary")))),Ke=n(Ae).withConfig({componentId:"sc-1iax82q-2"})(["height:300px;padding:5px 0;overflow-y:auto;"]),et=n(u).withConfig({componentId:"sc-1iax82q-3"})(["padding:10px 8px;"]),tt=d((({model:t})=>{const{t:n}=g(),{users:o}=f(),a=Ee(),{reactedUsersLoaded:r}=t;return e.useEffect((()=>{(async()=>{try{await t.loadReactedUsersData()}catch(e){S.error(n("Could not load reactions"))}})()}),[n,t]),r?m(h,{children:[l(Ge,{children:t.reactions.map((e=>j.createElement(Je,{...a,key:e.emoji,id:e.emoji,"aria-label":n("Reaction"),$active:a.selectedId===e.emoji},l($e,{size:16,children:e.emoji}))))}),t.reactions.map((e=>{const t=b(e.userIds.map((e=>o.get(e))));return j.createElement(Ke,{...a,key:e.emoji},t.map((e=>m(et,{align:"center",gap:8,children:[l(Re,{model:e,size:je.Medium}),l(c,{size:"medium",children:e.name})]},e.name))))}))]}):l(Ze,{})})),deleteCommentFactory=({comment:e,onDelete:t})=>R({name:({t:e})=>`${e("Delete")}…`,analyticsName:"Delete comment",section:ce,icon:l(w.TrashIcon,{}),keywords:"trash",dangerous:!0,visible:()=>T.policies.abilities(e.id).delete,perform:({t:n,event:o})=>{o?.preventDefault(),o?.stopPropagation(),T.dialogs.openModal({title:n("Delete comment"),content:l(We,{comment:e,onSubmit:t})})}}),resolveCommentFactory=({comment:e,onResolve:t})=>R({name:({t:e})=>e("Mark as resolved"),analyticsName:"Resolve thread",section:ce,icon:l(w.DoneIcon,{outline:!0}),visible:()=>T.policies.abilities(e.id).resolve&&T.policies.abilities(e.documentId).update,perform:async({t:n})=>{await e.resolve();const o=D.location.state;D.replace({...D.location,state:{sidebarContext:o.sidebarContext,commentId:void 0}}),t(),S.success(n("Thread resolved"))}}),unresolveCommentFactory=({comment:e,onUnresolve:t})=>R({name:({t:e})=>e("Mark as unresolved"),analyticsName:"Unresolve thread",section:ce,icon:l(w.DoneIcon,{outline:!0}),visible:()=>T.policies.abilities(e.id).unresolve&&T.policies.abilities(e.documentId).update,perform:async()=>{await e.unresolve();const n=D.location.state;D.replace({...D.location,state:{sidebarContext:n.sidebarContext,commentId:void 0}}),t()}}),viewCommentReactionsFactory=({comment:e})=>R({name:({t:e})=>`${e("View reactions")}`,analyticsName:"View comment reactions",section:ce,icon:l(w.SmileyIcon,{}),visible:()=>T.policies.abilities(e.id).read&&e.reactions.length>0,perform:({t:t,event:n})=>{n?.preventDefault(),n?.stopPropagation(),T.dialogs.openModal({title:t("Reactions"),content:l(tt,{model:e})})}});const nt=d((function CommentMenu({comment:e,onEdit:t,onDelete:n,onUpdate:o,className:a}){const r=de({modal:!0}),{documents:i}=f(),{t:s}=g(),c=Se(e),d=le({isContextMenu:!0}),u=i.get(e.documentId),p=j.useCallback((()=>{u&&($(O(A(u,e))),S.message(s("Link copied")))}),[s,u,e]);return m(h,{children:[l(k,{children:l(me,{"aria-label":s("Show menu"),className:a,...r})}),r.visible&&l(De,{...r,"aria-label":s("Comment options"),children:l(ue,{...r,items:[{type:"button",title:`${s("Edit")}…`,icon:l(w.EditIcon,{}),onClick:t,visible:c.update&&!e.isResolved},E(resolveCommentFactory({comment:e,onResolve:()=>o({resolved:!0})}),d),E(unresolveCommentFactory({comment:e,onUnresolve:()=>o({resolved:!1})}),d),E(viewCommentReactionsFactory({comment:e}),d),{type:"button",icon:l(w.CopyIcon,{}),title:s("Copy link"),onClick:p},{type:"separator"},E(deleteCommentFactory({comment:e,onDelete:n}),d)]})})]})})),ot=n(c).withConfig({componentId:"sc-grcnni-0"})(["position:relative;color:",";font-size:14px;padding:0 8px;margin:4px 0;display:inline-block;",' &:after{content:"";width:2px;position:absolute;left:0;top:2px;bottom:2px;background:',";border-radius:2px;}"],a("textSecondary"),z(3),a("commentMarkBackground"));const ResolveButton=({comment:e,onUpdate:t})=>{const n=le(),{t:a}=g();return l(p,{content:a("Mark as resolved"),placement:"top",hideOnClick:!0,children:l(st,{as:o,context:n,action:resolveCommentFactory({comment:e,onResolve:()=>t({resolved:!0})}),$rounded:!0,children:l(w.DoneIcon,{size:22,outline:!0})})})},at=n(pe).withConfig({componentId:"sc-138zkg8-0"})([""," .mention{background:",";}"],(e=>!e.readOnly&&i(["box-shadow:0 0 0 2px ",";border-radius:2px;padding:2px;margin:2px;margin-bottom:8px;"],e.theme.accent)),(e=>B(.05,e.theme.mentionBackground))),rt=n(u).withConfig({componentId:"sc-138zkg8-1"})(["width:24px;height:24px;margin-top:4px;align-items:flex-end;justify-content:flex-end;flex-shrink:0;flex-direction:column;"]),it=n.form.withConfig({componentId:"sc-138zkg8-2"})(["border-radius:2px;"]),st=n.span.withConfig({componentId:"sc-138zkg8-3"})(["color:",";"," svg{fill:currentColor;opacity:0.5;}&:",',&[aria-expanded= "true"]{background:',";svg{opacity:0.75;}}"],a("textSecondary"),(e=>e.$rounded&&i(["border-radius:50%;"])),r,a("backgroundQuaternary")),ct=n(u).withConfig({componentId:"sc-138zkg8-4"})(["position:absolute;left:",";right:",";top:4px;opacity:0;transition:opacity 100ms ease-in-out;background:",";padding-left:4px;&:has(",'[aria-expanded="true"]){opacity:1;}'],(e=>"rtl"!==e.dir?"auto":"4px"),(e=>"rtl"===e.dir?"auto":"4px"),a("backgroundSecondary"),st),dt=n(u).withConfig({componentId:"sc-138zkg8-5"})(["margin-top:6px;"]),lt=n(c).withConfig({componentId:"sc-138zkg8-6"})(["margin-bottom:2px;em{font-weight:600;font-style:normal;}"]),mt=n(u).withConfig({componentId:"sc-138zkg8-7"})(["position:relative;flex-grow:1;font-size:16px;color:",";background:",";min-width:2em;margin-bottom:1px;padding:8px 12px;transition:color 100ms ease-out,background 100ms ease-out;",";",";margin-left:","px;margin-right:","px;p:last-child{margin-bottom:0;}&:"," ","{opacity:1;}",""],a("text"),a("backgroundSecondary"),(({$lastOfThread:e,$canReply:t})=>e&&!t&&"border-bottom-left-radius: 8px; border-bottom-right-radius: 8px"),(({$firstOfThread:e})=>e&&"border-top-left-radius: 8px; border-top-right-radius: 8px"),(e=>e.$firstOfAuthor||"rtl"===e.$dir?0:32),(e=>e.$firstOfAuthor||"rtl"!==e.$dir?0:32),r,ct,N("tablet")`
    font-size: 15px;
  `),ut=d((function CommentThreadItem({comment:e,firstOfAuthor:t,firstOfThread:n,lastOfThread:o,dir:a,previousCommentCreatedAt:r,canReply:i,onDelete:s,onUpdate:c,highlightedText:d,enableScroll:p,disableScroll:f}){const{t:b}=g(),y=Ce(),[v,x]=j.useState(e.data),C=t,w=function useShowTime(e,t){if(!e)return!1;const n=t?M(Date.parse(t)):void 0,o=M(Date.parse(e)),a=t?U(Date.parse(e),Date.parse(t)):0;return!a||a>15*ge.ms&&n!==o}(e.createdAt,r),I=e.updatedAt&&e.updatedAt!==e.createdAt&&!e.isResolved,[R,T,D]=xe(),$=j.useRef(null),O=j.useCallback((async t=>{await e.addReaction({emoji:t,user:y})}),[e,y]),A=j.useCallback((async t=>{await e.removeReaction({emoji:t,user:y})}),[e,y]),E=j.useCallback((t=>{c?.(e.id,t)}),[e.id,c]),z=j.useCallback((()=>{s?.(e.id)}),[e.id,s]),B=j.useCallback((e=>{x(e(!1))}),[]),N=j.useCallback((()=>{$.current?.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}),[]),F=P((async t=>{t.preventDefault();try{D(),e.data=v,await e.save()}catch(n){T(),S.error(b("Error updating comment"))}}));return m(u,{gap:8,align:"flex-start",reverse:"rtl"===a,children:[t&&l(rt,{children:l(Re,{model:e.createdBy,size:24})}),m(mt,{$firstOfThread:n,$firstOfAuthor:t,$lastOfThread:o,$dir:a,$canReply:i,column:!0,children:[(C||w)&&m(lt,{size:"xsmall",type:"secondary",dir:a,children:[C&&l("em",{children:e.createdBy.name}),C&&w&&l(h,{children:" · "}),w&&l(Pe,{dateTime:e.createdAt,addSuffix:!0,shorten:!0}),I&&m(h,{children:[" ","(",l(Pe,{dateTime:e.updatedAt,children:b("edited")}),")"]})]}),d&&l(ot,{children:d}),m(it,{ref:$,onSubmit:F,children:[l(at,{readOnly:!R,value:e.data,defaultValue:v,onChange:B,onSave:N,autoFocus:!0},String(R)),R&&m(u,{align:"flex-end",gap:8,children:[l(he,{type:"submit",borderOnHover:!0,children:b("Save")}),l(he,{onClick:()=>{x(e.data),D()},neutral:!0,borderOnHover:!0,children:b("Cancel")})]}),!!e.reactions.length&&l(dt,{gap:6,align:"center",children:l(Qe,{model:e,onAddReaction:O,onRemoveReaction:A,picker:e.isResolved?void 0:l(st,{as:ReactionPicker,onSelect:O,onOpen:f,onClose:p,size:28,$rounded:!0})})})]}),l(k,{children:!R&&m(ct,{gap:4,dir:a,children:[!e.isResolved&&m(h,{children:[n&&l(ResolveButton,{onUpdate:E,comment:e}),l(st,{as:ReactionPicker,onSelect:O,onOpen:f,onClose:p,$rounded:!0})]}),l(st,{as:nt,comment:e,onEdit:T,onDelete:z,onUpdate:E})]})})]})]})}));const pt=d((function CommentForm({documentId:e,thread:t,draft:n,onSubmit:a,onSaveDraft:r,onFocus:i,onBlur:s,autoFocus:c,standalone:d,placeholder:h,animatePresence:b,highlightedText:y,dir:v,...x}){const{editor:C}=fe(),k=j.useRef(null),I=j.useRef(null),[R,T]=j.useState(0),[D,$]=j.useState(c),O=j.useRef(null),A=F(),{t:E}=g(),{comments:z}=f(),B=Ce(),N=j.useCallback((async()=>{(I.current?.isEmpty()??!0)&&t?.isNew&&(t.id&&C?.removeComment(t.id),await t.delete())}),[C,t]);Te(k,N);const M=P((async o=>{o.preventDefault(),r(void 0),T((e=>++e)),$(!1);const i=t??new L({createdAt:(new Date).toISOString(),documentId:e,data:n,reactions:[]},z);i.save({documentId:e,data:n}).then((()=>a?.())).catch((()=>{i.isNew=!0,S.error(E("Error creating comment"))})),i.isNew=!1,i.createdById=B.id,i.createdBy=B})),U=P((async o=>{if(o.preventDefault(),!n)return;r(void 0),T((e=>++e));const i=new L({createdAt:(new Date).toISOString(),parentCommentId:t?.id,documentId:e,data:n,reactions:[]},z);i.id=H(),z.add(i),i.save().then((()=>a?.())).catch((()=>{z.remove(i.id),i.isNew=!0,S.error(E("Error creating comment"))})),i.isNew=!1,i.createdById=B.id,i.createdBy=B,setTimeout((()=>{I.current?.focusAtStart()}),0)}));j.useEffect((()=>{setTimeout((()=>{c&&I.current?.focusAtStart()}),0)}),[c]);const Y=b?{initial:{opacity:0,marginBottom:-100},animate:{opacity:1,marginBottom:0,transition:{type:"spring",bounce:.1}},exit:{opacity:0,marginBottom:-100,scale:.98}}:{};return m(be.form,{ref:k,onSubmit:t?.isNew?M:U,...Y,...x,children:[l(_,{children:l("input",{ref:O,type:"file",onChange:e=>{e.stopPropagation(),e.preventDefault();const t=Q(e);if(t.length)return I.current?.insertFiles(e,t)},accept:V.imageContentTypes.join(", "),tabIndex:-1})}),m(u,{gap:8,align:"flex-start",reverse:"rtl"===v,children:[l(Re,{model:B,size:24,style:{marginTop:8}}),m(mt,{gap:10,onClick:()=>{I.current?.isBlurred&&I.current?.focusAtStart()},$lastOfThread:!0,$firstOfAuthor:!0,$firstOfThread:d,column:!0,children:[y&&l(ot,{children:y}),l(pe,{ref:I,defaultValue:n,onChange:e=>{const t=e(!0,!0);r(t?e(!1,!0):void 0)},onSave:()=>{k.current?.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},onFocus:()=>{i?.(),$(!0)},onBlur:()=>{s?.()},maxLength:q.maxLength,placeholder:h||(t?.isNew?`${E("Add a comment")}…`:`${E("Add a reply")}…`)},`${R}`),(D||n)&&m(u,{justify:"space-between",reverse:"rtl"===v,gap:8,children:[m(u,{gap:8,children:[l(he,{type:"submit",borderOnHover:!0,children:t&&!t.isNew?E("Reply"):E("Post")}),l(he,{onClick:async()=>{r(void 0),T((e=>++e)),$(!1),await N()},neutral:!0,borderOnHover:!0,children:E("Cancel")})]}),l(p,{content:E("Upload image"),placement:"top",children:l(o,{onClick:e=>{e.stopPropagation(),e.preventDefault(),O.current?.click()},children:l(w.ImageIcon,{color:A.textTertiary})})})]})]})]})]})})),CommentSortMenu=()=>{const{t:t}=g(),n=Y(),o=ye(),a=X(),r=Ce(),i=W(),s=r.getPreference(Z.SortCommentsByOrderInDocument)?G.OrderInDocument:G.MostRecent,c=""===i.get("resolved")?"resolved":s,d=e.useCallback((e=>{if("resolved"===e)return void a.push({search:J.stringify({...J.parse(n.search),resolved:""}),pathname:n.pathname,state:{sidebarContext:o}});const t=e;t!==s&&(r.setPreference(Z.SortCommentsByOrderInDocument,t===G.OrderInDocument),r.save()),a.push({search:J.stringify({...J.parse(n.search),resolved:void 0}),pathname:n.pathname,state:{sidebarContext:o}})}),[a,n,o,r,s]),m=e.useMemo((()=>[{type:"item",label:t("Most recent"),value:G.MostRecent},{type:"item",label:t("Order in doc"),value:G.OrderInDocument},{type:"separator"},{type:"item",label:t("Resolved"),value:"resolved"}]),[t]);return l(ht,{options:m,value:c,onChange:d,ariaLabel:t("Sort comments"),label:t("Sort comments"),hideLabel:!0,borderOnHover:!0})},ht=n(Fe).withConfig({componentId:"sc-1nz3f5u-0"})(["color:",";"],a("textSecondary"));const gt=n.button.withConfig({componentId:"sc-19ya7gg-0"})(["border:0;padding:8px;margin:0;background:none;color:",";font-size:14px;-webkit-appearance:none;cursor:var(--pointer);transition:opacity 100ms ease-out;position:absolute;text-align:left;width:100%;bottom:-30px;left:32px;",""],a("textTertiary"),N("tablet")`
    opacity: 0;
  `),ft=n.div.withConfig({componentId:"sc-19ya7gg-1"})(["display:flex;justify-content:space-between;align-items:center;margin-bottom:1px;margin-left:","px;margin-right:","px;padding:8px 12px;color:",";background:",";cursor:var(--pointer);font-size:13px;&:","{color:",";background:",";}*{border-color:",";}"],(e=>"rtl"===e.$dir?0:32),(e=>"rtl"!==e.$dir?0:32),a("textTertiary"),(e=>B(.015,e.theme.backgroundSecondary)),r,a("textSecondary"),a("backgroundTertiary"),(e=>B(.015,e.theme.backgroundSecondary))),bt=n.div.withConfig({componentId:"sc-19ya7gg-2"})(["margin:12px 12px 32px;margin-right:",";margin-left:",";position:relative;transition:opacity 100ms ease-out;&:","{","{opacity:1;}}",""],(e=>"rtl"!==e.$dir?"18px":"12px"),(e=>"rtl"===e.$dir?"18px":"12px"),r,gt,(e=>e.$recessed&&i(["opacity:0.35;cursor:default;"]))),yt=d((function CommentThread({comment:e,document:t,recessed:n,focused:o,enableScroll:a,disableScroll:r,collapseThreshold:i=5,collapseNumDisplayed:s=3}){const[c]=j.useState(o&&!window.location.hash),{editor:d}=fe(),{comments:u}=f(),p=j.useRef(null),h=j.useRef(null),{t:b}=g(),y=X(),v=Y(),x=ye(),[C,w]=j.useState(e.isNew),k=Se(t),[I,S]=K(`draft-${t.id}-${e.id}`,void 0),R=k.comment&&!e.isResolved,T=ee.getAnchorTextForComment(d?.getComments()??[],e.id),D=u.inThread(e.id).filter((e=>!e.isNew)),[$,O]=j.useState((()=>D.length-1>=i?{begin:1,final:D.length-s-1}:null));Te(p,(e=>{o&&!e.target.classList.contains("comment")&&!1===e.defaultPrevented&&y.replace({search:v.search,pathname:v.pathname,state:{commentId:void 0,sidebarContext:x}})}));const A=j.useCallback((()=>{d?.updateComment(e.id,{draft:!1})}),[d,e.id]),handleClickExpand=e=>{e.stopPropagation(),O(null)};return j.useEffect((()=>{!o&&C&&w(!1)}),[o,C]),j.useEffect((()=>{if(o){c?setTimeout((()=>{p.current&&Ue(p.current,{scrollMode:"if-needed",behavior:"auto",block:"nearest",boundary:e=>"comments"!==e.id})}),te):setTimeout((()=>{h.current&&Ue(h.current,{scrollMode:"if-needed",behavior:"smooth",block:"center",boundary:e=>"comments"!==e.id})}),0);const getCommentMarkElement=()=>window.document?.getElementById(`comment-${e.id}`),t=!!getCommentMarkElement();setTimeout((()=>{getCommentMarkElement()?.scrollIntoView({behavior:"smooth",block:"center"})}),t?0:te)}}),[o,c,e.id]),m(bt,{ref:p,$focused:o,$recessed:n,$dir:t.dir,onClick:()=>{y.replace({search:e.isResolved?"resolved=":"",pathname:v.pathname.replace(/\/history$/,""),state:{commentId:e.id,sidebarContext:x}})},children:[D.map(((e,n)=>{if(null!==$){if(n===$.begin)return(e=>{const t=e.final-e.begin+1,n=D.slice(e.begin,e.final+1).map((e=>e.createdBy)),o=Array.from(new Set(n)),a=o.length-3;return m(ft,{onClick:handleClickExpand,children:[b("Show {{ count }} reply",{count:t}),l(Le,{users:o,limit:3,overflow:a,size:je.Medium})]},"show-more")})($);if(n>$.begin&&n<=$.final)return null}const i=0===n||$&&n===$.final+1||e.createdById!==D[n-1].createdById,s=n===D.length-1||e.createdById!==D[n+1].createdById;return l(ut,{highlightedText:0===n?T:void 0,comment:e,onDelete:d?.removeComment,onUpdate:d?.updateComment,firstOfThread:0===n,lastOfThread:n===D.length-1&&!I,canReply:o&&k.comment,firstOfAuthor:i,lastOfAuthor:s,previousCommentCreatedAt:D[n-1]?.createdAt,dir:t.dir,enableScroll:a,disableScroll:r},e.id)})),l(se,{hideOverflow:!1,ref:h,children:(o||I||0===D.length)&&R&&l(ne,{timing:100,children:l(pt,{onSubmit:A,onSaveDraft:S,draft:I,documentId:t.id,thread:e,standalone:0===D.length,dir:t.dir,autoFocus:C,highlightedText:0===D.length?T:void 0})})}),!o&&!n&&!I&&R&&m(gt,{onClick:()=>w(!0),children:[b("Reply"),"…"]})]})}));const vt=n(re).withConfig({componentId:"sc-1s2rtjn-0"})(["position:absolute;top:calc(50vh - 30px);transform:translateY(-50%);"]),xt=n(u).withConfig({componentId:"sc-1s2rtjn-1"})(["padding-bottom:65px;height:100%;"]),Ct=n.div.withConfig({componentId:"sc-1s2rtjn-2"})(["height:",";"],(e=>e.$hasComments?"auto":"100%")),wt=n(he).withConfig({componentId:"sc-1s2rtjn-3"})(["position:sticky;bottom:12px;left:50%;transform:translateX(-50%);opacity:0.8;border-radius:12px;padding:0 4px;&:hover{opacity:1;}"]),kt=n(w.ArrowIcon).withConfig({componentId:"sc-1s2rtjn-4"})(["transform:rotate(90deg);"]),It=n(pt).withConfig({componentId:"sc-1s2rtjn-5"})(["padding:12px;padding-right:",";padding-left:",";"],(e=>"rtl"!==e.dir?"18px":"12px"),(e=>"rtl"===e.dir?"18px":"12px")),St=d((function Comments(){const{ui:e,comments:t,documents:n}=f(),o=Ce(),{editor:a,isEditorInitialized:r}=fe(),{t:i}=g(),s=oe(),c=W(),[d,p,h]=xe(!0),b=n.getByUrl(s.params.documentSlug),y=we(),v=Se(b),x=j.useRef(null),C=j.useRef(0),w=j.useRef(!0),[k,I]=j.useState(!1);Ie("Escape",(()=>b&&e.set({commentsExpanded:!1})));const[S,R]=K(`draft-${b?.id}-new`,void 0),T=o.getPreference(Z.SortCommentsByOrderInDocument)?{type:G.OrderInDocument,referencedCommentIds:a?.getComments().map((e=>e.id))??[]}:{type:G.MostRecent},D=""===c.get("resolved"),$=b?D?t.resolvedThreadsInDocument(b.id,T):t.unresolvedThreadsInDocument(b.id,T):[],O=$.length>0,scrollToBottom=()=>{x.current&&x.current.scrollTo({top:x.current.scrollHeight})};return j.useEffect((()=>{Boolean(b&&r)&&T.type===G.MostRecent&&!D&&scrollToBottom()}),[T.type,b,r,D]),j.useEffect((()=>{if(I(!1),T.type===G.MostRecent&&!D){$.length>C.current&&(w.current?scrollToBottom():I(!0))}C.current=$.length}),[T.type,$.length,D]),b&&r?m(He,{title:m(u,{align:"center",justify:"space-between",auto:!0,children:[l("span",{children:i("Comments")}),l(CommentSortMenu,{})]}),onClose:()=>e.set({commentsExpanded:!1}),scrollable:!1,children:[l(ae,{id:"comments",bottomShadow:!y,hiddenScrollbars:!0,topShadow:!0,overflow:d?"auto":"hidden",style:{overflowX:"hidden"},ref:x,onScroll:()=>{if(x.current){const e=x.current.scrollHeight,t=x.current.scrollTop,n=x.current.clientHeight;w.current=Math.abs(e-(t+n))<=50,w.current&&I(!1)}},children:m(Ct,{$hasComments:O,children:[O?$.map((e=>l(yt,{comment:e,document:b,recessed:!!y&&y.id!==e.id,focused:y?.id===e.id,enableScroll:p,disableScroll:h},e.id))):l(xt,{align:"center",justify:"center",auto:!0,children:l(vt,{children:i(D?"No resolved comments":"No comments yet")})}),k&&l(ne,{children:l(wt,{onClick:scrollToBottom,children:m(u,{align:"center",children:[i("New comments")," ",l(kt,{size:20})]})})})]})}),l(ve,{initial:!1,children:!y&&v.comment&&!D&&l(It,{draft:S,onSaveDraft:R,documentId:b.id,placeholder:`${i("Add a comment")}…`,autoFocus:!1,dir:b.dir,animatePresence:!0,standalone:!0})})]}):null}));export{St as default};
