import{a as e,j as t,T as r,h as o,r as n,cq as a,n as i,a0 as c,C as s,a1 as l,L as u,d,v as p,o as h,u as m,z as f,b5 as g,F as y,X as x,w,k as S,i as b,aZ as I,cr as v,bR as C,b9 as k,aI as j,A as T,e as F,N as q,cs as D,q as E}from"./index.mlCxaiYE.js";import{A as R,W as A}from"./Badge.sHfYRIgC.js";import{D as L}from"./DocumentListItem.b25IHz8z.js";import{L as z}from"./LoadingIndicatorBar.mGaD64ZX.js";import{N as P}from"./DocumentContext.hhTeDqBR.js";import{S as B}from"./Scene.tZk0YIWv.js";import{S as N}from"./Switch.3DOmHSIs.js";import{h as M}from"./authenticated.03alztlO.js";import{C as K,D as O}from"./DateFilter.aGYKA58Z.js";import{S as Q,F as U}from"./FilterOptions.-kirZheg.js";import{u as V,a as $}from"./Item.dGEOVRdT.js";import{A as H,a as J}from"./TeamLogo.qV1feKYB.js";import"./PlaceholderText.UNfhMHoO.js";import"./Star.r69PtoVf.js";import"./InputSelectPermission.lb2lIKIy.js";import"./PopoverDisclosure.OO70kItq.js";import"./usePolicy.wYF8wJNp.js";import"./useCurrentUser.zlImhYTS.js";import"./Time.rp9cc_zo.js";import"./Highlight.XZk1WX3z.js";import"./useBoolean.4JQO1FDN.js";import"./index.esm.XsAbwjVB.js";import"./useCurrentTeam.fRZpnoZU.js";import"./SharedLayoutContext.2BBc39h7.js";import"./urls.doI9odX4.js";import"./Notice.4wB6_cwE.js";import"./ButtonLink.tgoiIjKJ.js";import"./routeHelpers.MPg4vHxP.js";function DocumentFilter(n){const{t:a}=e();return t("div",{children:t(r,{content:a("Remove document filter"),children:t(Q,{onClick:n.onClick,icon:t(o.CloseIcon,{}),neutral:!0,children:n.document.titleWithDefault})})})}const DocumentTypeFilter=({statusFilter:r,onSelect:o})=>{const{t:i}=e(),c=n.useMemo((()=>[{key:a.Published,label:i("Published")},{key:a.Archived,label:i("Archived")},{key:a.Draft,label:i("Drafts")}]),[i]);return t(U,{options:c,selectedKeys:r,onSelect:e=>{let t;t=r.includes(e)?r.filter((t=>t!==e)):[...r,e],o({statusFilter:t})},defaultLabel:i("Any status")})};function RecentSearchListItem({searchQuery:a}){const{t:i}=e(),c=n.useRef(null),{focused:s,...l}=V(c,!1);return $(s,c),d(G,{to:p({query:a.query}),ref:c,...l,children:[a.query,t(r,{content:i("Remove search"),children:t(W,{"aria-label":i("Remove search"),onClick:async e=>{e.preventDefault(),await a.delete()},children:t(o.CloseIcon,{})})})]})}const W=i(c).withConfig({componentId:"sc-283q9b-0"})(["opacity:0;color:",";&:focus,&:","{opacity:1;color:",";}"],s("textTertiary"),l,s("text")),G=i(u).withConfig({componentId:"sc-283q9b-1"})(["display:flex;justify-content:space-between;color:",";cursor:var(--pointer);padding:1px 8px;border-radius:4px;line-height:24px;font-size:14px;margin:0 -8px;&:focus-visible{outline:none;}&:focus,&:","{color:",";background:",";","{opacity:1;}}"],s("textSecondary"),l,s("text"),s("backgroundSecondary"),W);const X=i.h2.withConfig({componentId:"sc-dkxd24-0"})(["font-weight:500;font-size:14px;line-height:1.5;color:",";margin:12px 0 0;"],s("textSecondary")),Y=i(R).withConfig({componentId:"sc-dkxd24-1"})(["padding:0;margin-top:8px;"]),Z=h(n.forwardRef((function RecentSearches({onEscape:r},o){const{searches:a}=m(),{t:i}=e();n.useEffect((()=>{a.fetchPage({source:"app"})}),[a]);const c=a.recent.length?d(f,{children:[t(X,{children:i("Recent searches")}),t(Y,{ref:o,onEscape:r,"aria-label":i("Recent searches"),items:a.recent,children:()=>a.recent.map((e=>t(RecentSearchListItem,{searchQuery:e},e.id)))})]}):null;return t(g,{animate:!a.recent.length,children:c})})));const _=i(y).withConfig({componentId:"sc-1assgme-0"})(["position:relative;margin-bottom:8px;"]),ee=i.input.withConfig({componentId:"sc-1assgme-1"})(["width:100%;padding:10px 10px 10px 60px;font-size:30px;font-weight:400;outline:none;border:0;background:",";border-radius:4px;color:",";::-webkit-search-cancel-button{-webkit-appearance:none;}::-webkit-input-placeholder{color:",";}:-moz-placeholder{color:",";}::-moz-placeholder{color:",";}:-ms-input-placeholder{color:",";}"],s("sidebarBackground"),s("text"),s("placeholder"),s("placeholder"),s("placeholder"),s("placeholder")),te=i(o.SearchIcon).withConfig({componentId:"sc-1assgme-2"})(["position:absolute;left:8px;opacity:0.7;"]),re=n.forwardRef((function SearchInput({defaultValue:e,...r},o){const a=x(),i=n.useCallback((()=>{o.current?.focus()}),[o]);return n.useEffect((()=>{const t=(e||"").length;o.current?.setSelectionRange(t,t);const r=setTimeout((()=>{i()}),100);return()=>{clearTimeout(r)}}),[o,e,i]),d(_,{align:"center",children:[t(te,{size:46,color:a.placeholder,onClick:i}),t(ee,{...r,defaultValue:e,ref:o,spellCheck:"false",type:"search",autoFocus:!0})]})})),oe={sort:"name",direction:"ASC"};const ne=i(H).withConfig({componentId:"sc-9t438l-0"})(["margin:2px;"]),ae=h((function UserFilter(r){const{onSelect:a,userId:i}=r,{t:c}=e(),{users:s}=m(),l=n.useMemo((()=>{const e=s.all.map((e=>({key:e.id,label:e.name,icon:t(ne,{model:e,size:J.Small})})));return[{key:"",label:c("Any author"),icon:t(o.UserIcon,{size:20})},...e]}),[s.all,c]);return t(U,{options:l,selectedKeys:[i],onSelect:a,defaultLabel:c("Any author"),fetchQuery:s.fetchPage,fetchQueryOptions:oe,showFilter:!0})}));const ie=i(y).withConfig({componentId:"sc-axhrfq-0"})(["text-align:center;margin:30vh auto 0;max-width:380px;transform:translateY(-50%);"]),ce=i(y).withConfig({componentId:"sc-axhrfq-1"})(["",";"],q("tablet")`
    margin-top: 40px;
  `),se=i(y).withConfig({componentId:"sc-axhrfq-2"})(["margin-bottom:150px;"]),le=i(R).withConfig({componentId:"sc-axhrfq-3"})(["display:flex;flex-direction:column;flex:1;"]),ue=i(y).withConfig({componentId:"sc-axhrfq-4"})(["margin-bottom:12px;transition:opacity 100ms ease-in-out;overflow-y:hidden;overflow-x:auto;padding:8px 0;height:28px;gap:8px;"," ",";"],D(),q("tablet")`
    padding: 0;
  `),de=i(N).withConfig({componentId:"sc-axhrfq-5"})(["white-space:nowrap;margin-left:8px;margin-top:4px;font-size:14px;font-weight:400;"]),pe=h((function Search(){const{t:r}=e(),{documents:o,searches:i}=m(),c=w(),s=S(),l=b(),u=I(),h=n.useRef(null),g=n.useRef(null),y=n.useRef(null),x=v(u.params.query??c.get("q")??c.get("query")??"").trim(),q=""!==x?x:void 0,D=c.get("collectionId")??"",R=c.get("userId")??"",N=c.get("documentId")??void 0,Q=c.get("dateFilter")??"",U=c.getAll("statusFilter")?.length?c.getAll("statusFilter"):[a.Published,a.Draft],V="true"===c.get("titleFilter"),$=!!(q||D||R),H=N?o.get(N):void 0,J={document:!!H,collection:!H,user:!H||!(!H||!q),documentType:$,date:$,title:!!q&&!H},W=n.useMemo((()=>({query:q,statusFilter:U,collectionId:D,userId:R,dateFilter:Q,titleFilter:V,documentId:N})),[q,JSON.stringify(U),D,R,Q,V,N]),G=n.useMemo((()=>(q&&i.add({id:C(),query:q,createdAt:(new Date).toISOString()}),$?async()=>V?await o.searchTitles(W):await o.search(W):()=>Promise.resolve([]))),[q,V,W,i,o,$]),{data:X,next:Y,end:_,error:ee,loading:te}=M(G,{limit:k.defaultLimit}),handleFilterChange=e=>{l.replace({pathname:s.pathname,search:E.stringify({...E.parse(s.search),...e},{skipEmptyString:!0})})},handleEscape=()=>h.current?.focus(),oe=!te&&q&&0===X?.length;return d(B,{textTitle:q?`${q} – ${r("Search")}`:r("Search"),children:[t(P,{trigger:"Escape",handler:l.goBack}),te&&t(z,{}),d(ce,{column:!0,auto:!0,children:[d("form",{method:"GET",action:p(),onSubmit:e=>e.preventDefault(),children:[t(re,{name:"query",ref:h,placeholder:`${r(N?"Search in document":D?"Search in collection":"Search")}…`,onKeyDown:e=>{if("Enter"===e.key)return t=e.currentTarget.value,void l.replace({pathname:s.pathname,search:E.stringify({...E.parse(s.search),q:t},{skipEmptyString:!0})});var t;if("Escape"===e.key)return e.preventDefault(),l.goBack();if("ArrowUp"===e.key&&e.currentTarget.value){const t=e.currentTarget.value.length;0===(e.currentTarget.selectionEnd||0)&&(e.currentTarget.selectionStart=0,e.currentTarget.selectionEnd=t,e.preventDefault())}if("ArrowDown"===e.key&&!e.shiftKey){if(e.preventDefault(),e.currentTarget.value){const t=e.currentTarget.value.length;if((e.currentTarget.selectionStart||0)<t)return e.currentTarget.selectionStart=t,void(e.currentTarget.selectionEnd=t)}const t=g.current?.firstElementChild??y.current?.firstElementChild;t?.focus()}},defaultValue:q??""},q?"search":"recent"),d(ue,{children:[J.document&&t(DocumentFilter,{document:H,onClick:()=>{handleFilterChange({documentId:void 0})}}),J.collection&&t(K,{collectionId:D,onSelect:e=>handleFilterChange({collectionId:e})}),J.user&&t(ae,{userId:R,onSelect:e=>handleFilterChange({userId:e})}),J.documentType&&t(DocumentTypeFilter,{statusFilter:U,onSelect:({statusFilter:e})=>handleFilterChange({statusFilter:e})}),J.date&&t(O,{dateFilter:Q,onSelect:e=>handleFilterChange({dateFilter:e})}),J.title&&t(de,{width:26,height:14,label:r("Search titles only"),onChange:e=>{handleFilterChange({titleFilter:e.target.checked})},checked:V})]})]}),$?d(f,{children:[ee?t(j,{children:d(ie,{column:!0,children:[t(T,{as:"h1",children:r("Something went wrong")}),d(T,{as:"p",type:"secondary",children:[r("Please try again or contact support if the problem persists"),"."]})]})}):oe?t(j,{children:t(ie,{column:!0,children:t(T,{as:"p",type:"secondary",children:r("No documents found for your search filters.")})})}):null,d(se,{column:!0,children:[t(le,{ref:g,onEscape:handleEscape,"aria-label":r("Search Results"),items:X??[],children:()=>X?.length&&!ee?X.map((e=>t(L,{document:e.document,highlight:q,context:e.context,showCollection:!0,showTemplate:!0},e.document.id))):null}),t(A,{onEnter:_||te?void 0:Y,debug:"development"===F.ENVIRONMENT},X?.length)]})]}):N?null:t(Z,{ref:y,onEscape:handleEscape})]})]})}));export{pe as default};
