import{au as t,q as e,b6 as s,a,u as o,b as i,bB as r,Z as n,d as c,F as l,j as p,A as u,B as m,o as d,i as g,k as h,w as b,b7 as f,aA as N,K as I,aY as y,bC as U}from"./index.mlCxaiYE.js";import{u as k}from"./useCurrentTeam.fRZpnoZU.js";import{s as v}from"./routeHelpers.MPg4vHxP.js";import{I as C}from"./InputSelectPermission.lb2lIKIy.js";import{u as S}from"./useBoolean.4JQO1FDN.js";import"./PopoverDisclosure.OO70kItq.js";const $={id:"notion",name:"Notion",description:"Adds a Notion integration for importing data."},_=class _NotionUtils{static parseState(t){return JSON.parse(t)}static successUrl(s){const a={success:"",service:t.Notion,integrationId:s};return`${this.settingsUrl}?${e.stringify(a)}`}static errorUrl(s){const a={error:s,service:t.Notion};return`${this.settingsUrl}?${e.stringify(a)}`}static callbackUrl({baseUrl:t,params:e}={baseUrl:`${s.URL}`,params:void 0}){return e?`${t}/api/notion.callback?${e}`:`${t}/api/notion.callback`}static authUrl({state:t}){const a={client_id:s.NOTION_CLIENT_ID,redirect_uri:this.callbackUrl(),state:JSON.stringify(t),response_type:"code",owner:"user"};return`${this.authBaseUrl}?${e.stringify(a)}`}};_.tokenUrl="https://api.notion.com/v1/oauth/token",_.authBaseUrl="https://api.notion.com/v1/oauth/authorize",_.settingsUrl=v("import");let w=_;function ImportDialog({integrationId:e,onSubmit:s}){const{t:d}=a(),{imports:g}=o(),[h,b,f]=S(),[N,I]=i.useState(),y=i.useCallback((t=>{I(t===r?void 0:t)}),[]),U=i.useCallback((async()=>{b();const a=[{permission:N}];try{await g.create({service:t.Notion},{integrationId:e,input:a}),n.success(d("Your import is being processed, you can safely leave this page")),s()}catch(o){n.error(o.message),f()}}),[N,s]);return c(l,{column:!0,gap:12,children:[c("div",{children:[p(C,{value:N,onChange:y}),c(u,{as:"span",type:"secondary",children:[d("Set the default permission level for collections created from the import"),"."]})]}),p(l,{justify:"flex-end",children:p(m,{onClick:U,disabled:h,children:d("Start import")})})]})}const j=d((()=>{const{t:e}=a(),{dialogs:r}=o(),l=k(),u=g(),d=h(),N=b(),I=s.APP_NAME,y=w.authUrl({state:{teamId:l.id}}),U=N.get("service"),v=""===N.get("success"),C=N.get("error"),S=N.get("integrationId"),$=i.useCallback((()=>{u.replace({pathname:d.pathname,search:""})}),[u,d]),_=i.useCallback((()=>{r.closeAllModals(),$()}),[r,$]);return i.useEffect((()=>{S&&v&&U===t.Notion&&r.openModal({title:e("Import data"),content:p(ImportDialog,{integrationId:S,onSubmit:_}),onClose:$})}),[e,r,v,U,$]),i.useEffect((()=>{C&&("access_denied"===C?n.error(e("Whoops, you need to accept the permissions in Notion to connect {{ appName }} to your workspace. Try again?",{appName:I})):n.error(e("Something went wrong while authenticating your request. Please try logging in again.")))}),[e,I,C]),c(m,{type:"submit",onClick:()=>f(y),disabled:!s.NOTION_CLIENT_ID,neutral:!0,children:[e("Import"),"â€¦"]})}));N.add([{...$,type:I.Imports,value:{title:"Notion",subtitle:y("Import pages from Notion"),icon:p("img",{src:U("/images/notion.png"),width:28}),action:p(j,{})}}]);
