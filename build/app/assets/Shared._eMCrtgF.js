import{n as e,L as t,N as n,a1 as o,C as i,a2 as a,ai as r,o as s,r as c,j as d,bq as l,d as u,E as m,b4 as h,O as p,a as f,u as g,ar as b,z as v,ah as I,a8 as w,al as x,F as j,br as D,V as C,bs as k,T as y,bt as S,h as T,k as E,aU as N,e as P,bu as z,bv as R,bw as L,bx as A,aq as M,av as q,by as O,bz as $,bA as H,A as _}from"./index.mlCxaiYE.js";import{i as B,g as U,S as W,h as F,j as V,k as K,l as X,E as J,n as Y,L as Z,o as G,f as Q}from"./DocumentContext.hhTeDqBR.js";import{E as ee,L as te,D as ne}from"./Loading.9UhuAPJB.js";import{a as oe,P as ie,i as ae}from"./Badge.sHfYRIgC.js";import{u as re,P as se}from"./Switch.3DOmHSIs.js";import{u as ce,a as de}from"./Item.dGEOVRdT.js";import{H as le,M as ue}from"./Highlight.XZk1WX3z.js";import{u as me,P as he}from"./PopoverDisclosure.OO70kItq.js";import{u as pe}from"./useCurrentUser.zlImhYTS.js";import{T as fe,a as ge}from"./TeamLogo.qV1feKYB.js";import{c as be,d as ve}from"./language.6NyDJHi_.js";import Ie from"./index.8zLTxZbM.js";import"./PlaceholderText.UNfhMHoO.js";import"./Scene.tZk0YIWv.js";import"./LoadingIndicatorBar.mGaD64ZX.js";import"./InputSelectPermission.lb2lIKIy.js";import"./Time.rp9cc_zo.js";import"./index.esm.XsAbwjVB.js";import"./useBoolean.4JQO1FDN.js";import"./useCurrentTeam.fRZpnoZU.js";import"./usePolicy.wYF8wJNp.js";import"./SharedLayoutContext.2BBc39h7.js";import"./cloneDeep.KovzE0Sn.js";import"./OutlineIcon.Lni4fHNe.js";import"./index.njNghNAe.js";import"./useFocusedComment.Wp-Vuc-6.js";import"./Star.r69PtoVf.js";import"./PopoverButton.AWtPNgE3.js";import"./Actions.u9jjnQ1W.js";import"./DocumentViews.hDT4MR_D.js";import"./Facepile.0K3TyxgD.js";import"./revisions.HHg7AZxX.js";import"./Notice.4wB6_cwE.js";import"./Subheading.reqgXMWW.js";import"./Tabs.dkNXhqZm.js";import"./VisualElementDragControls.jrFnrF4j.js";import"./urls.doI9odX4.js";import"./PluginIcon.pb6swma8.js";const we=/<b\b[^>]*>(.*?)<\/b>/gi;function replaceResultMarks(e){return e.replace(/<b\b[^>]*>(.*?)<\/b>/gi,"$1")}const xe=e.div.withConfig({componentId:"sc-1b8j8to-0"})(["flex-grow:1;flex-shrink:1;min-width:0;"]),je=e(t).withConfig({componentId:"sc-1b8j8to-1"})(["display:flex;align-items:center;padding:6px 12px;max-height:50vh;cursor:var(--pointer);&:not(:last-child){margin-bottom:4px;}&:focus-visible{outline:none;}",";&:",",&:active,&:focus,&:focus-within{background:",";}",""],n("tablet")`
    width: auto;
  `,o,i("listItemHoverBackground"),(e=>e.$menuOpen&&a(["background:",";"],i("listItemHoverBackground")))),De=e.h4.withConfig({componentId:"sc-1b8j8to-2"})(["display:flex;justify-content:",";align-items:center;height:22px;margin-top:0;margin-bottom:0.25em;overflow:hidden;white-space:nowrap;color:",";"],(e=>e.rtl?"flex-end":"flex-start"),i("text")),Ce=e(le).withConfig({componentId:"sc-1b8j8to-3"})(["max-width:90%;"," ","{padding:0;}"],r(),ue),ke=e(le).withConfig({componentId:"sc-1b8j8to-4"})(["display:block;color:",";font-size:14px;margin-top:-0.25em;margin-bottom:0;"," ","{padding:0;}"],i("textTertiary"),r(),ue),ye=s(c.forwardRef((function DocumentListItem(e,t){const{document:n,highlight:o,context:i,shareId:a,...r}=e;let s=c.useRef(null);t&&(s=t);const{focused:m,...h}=ce(s,!1);return de(m,s),d(je,{ref:s,dir:n.dir,to:{pathname:a?l(a,n.url):n.url,state:{title:n.titleWithDefault}},...r,...h,onClick:e=>{r.onClick&&r.onClick(e),h.onClick(e)},children:u(xe,{children:[d(De,{dir:n.dir,children:d(Ce,{text:n.titleWithDefault,highlight:o,dir:n.dir})}),d(ke,{text:i,highlight:o?we:void 0,processResult:replaceResultMarks})]})})})));const Se=e(m).withConfig({componentId:"sc-1rzmu2p-0"})(["padding:0 12px;margin:6px 0;"]),Te=e(oe).withConfig({componentId:"sc-1rzmu2p-1"})(["padding:6px 12px;"]),Ee=e(h).withConfig({componentId:"sc-1rzmu2p-2"})(["","{border-radius:16px;}"],p),Ne=s((function SearchPopover({shareId:e,className:t}){const{t:n}=f(),{documents:o}=g(),i=c.useRef(null),a=me({placement:"bottom-start",unstable_offset:[-24,0],modal:!0}),[r,s]=c.useState(""),{show:l,hide:m}=a,[h,p]=c.useState(),[w,x]=c.useState(r),[j,D]=c.useState(h);c.useEffect((()=>{h&&(x(r),D(h),l())}),[h,r,l]);const C=c.useCallback((async({query:t,...n})=>{if(t?.length>0){const i=await o.search({query:t,shareId:e,...n});return i.length&&p(i),i}}),[o,e]),k=c.useMemo((()=>b((async e=>{const{value:t}=e.target;s(t.trim()),t===w&&a.show(),t.length||a.hide()}),300)),[a,w]),y=a.unstable_referenceRef,S=c.useRef(null),T=c.useCallback((()=>y?.current?.focus()),[y]),E=c.useCallback((()=>{i.current=y.current}),[y]),N=c.useCallback((e=>{e.nativeEvent.isComposing||("Enter"===e.key&&h&&a.show(),"ArrowDown"!==e.key||e.shiftKey||e.currentTarget.value.length&&(e.currentTarget.value.length===e.currentTarget.selectionStart&&a.show(),S.current?.focus()),"ArrowUp"===e.key&&(a.visible&&(a.hide(),e.shiftKey||e.preventDefault()),e.currentTarget.value&&0===e.currentTarget.selectionEnd&&(e.currentTarget.selectionStart=0,e.currentTarget.selectionEnd=e.currentTarget.value.length,e.preventDefault())),"Escape"===e.key&&a.visible&&(a.hide(),e.preventDefault()))}),[a,h]),P=c.useCallback((()=>{m(),y.current&&(y.current.value="",i.current=document.getElementById(B))}),[y,m]);return re("/",(e=>{y.current&&y.current!==document.activeElement&&(y.current.focus(),e.preventDefault())})),u(v,{children:[d(he,{...a,children:e=>d(Ee,{"aria-controls":e["aria-controls"],"aria-expanded":e["aria-expanded"],"aria-haspopup":e["aria-haspopup"],ref:e.ref,onChange:k,onFocus:E,onKeyDown:N,className:t})}),d(se,{...a,"aria-label":n("Results"),unstable_autoFocusOnShow:!1,unstable_finalFocusRef:i,style:{zIndex:I.sidebar+1},shrink:!0,children:d(ie,{options:{query:r,snippetMinWords:10,snippetMaxWords:11},items:j,fetch:C,onEscape:T,empty:d(Se,{children:n("No results for {{query}}",{query:r})}),loading:d(Te,{count:3,header:{height:20}}),renderItem:(t,n)=>d(ye,{shareId:e,ref:0===n?S:void 0,document:t.document,context:t.context,highlight:w,onClick:P},t.document.id)})})]})}));const Pe=s(c.forwardRef((function DocumentLink({node:e,collection:t,activeDocument:n,activeDocumentId:o,prefetchDocument:i,isDraft:a,depth:r,shareId:s},m){const{documents:h}=g(),{t:p}=f(),b=o===e.id,I=!!e.children.length||n?.parentDocumentId===e.id,x=h.get(e.id),j=c.useMemo((()=>!(!I||!(o&&ae(U(e).map((e=>e.id)),o)||b||r<=1))),[I,o,b,r,e]),[D,C]=c.useState(j);c.useEffect((()=>{j&&C(j)}),[j]);const k=c.useCallback((e=>{e.preventDefault(),e.stopPropagation(),C(!D)}),[D]),y=c.useMemo((()=>n?.isDraft&&n?.isActive&&n?.parentDocumentId===e.id?[n?.asNavigationNode,...e.children]:e.children),[n?.isActive,n?.isDraft,n?.parentDocumentId,n?.asNavigationNode,e]),S=c.useCallback((()=>{i?.(e.id)}),[i,e]),T=(n?.id===e.id?n.title:e.title)||p("Untitled"),E=e.icon??e.emoji;return u(v,{children:[d(W,{to:{pathname:l(s,e.url),state:{title:e.title}},expanded:I&&0!==r?D:void 0,onDisclosureClick:k,onClickIntent:S,icon:E&&d(w,{value:E,color:e.color}),label:T,depth:r,exact:!1,scrollIntoViewIfNeeded:!x?.isStarred,isDraft:a,ref:m,isActive:()=>!!b}),D&&y.map(((a,c)=>d(Pe,{shareId:s,collection:t,node:a,activeDocumentId:o,activeDocument:n,prefetchDocument:i,isDraft:a.isDraft,depth:r+1,index:c,parentId:e.id},a.id)))]})})));const ToggleSidebar=()=>{const{t:e}=f(),{ui:t}=g();return d(y,{content:e("Toggle sidebar"),shortcut:`${S}+.`,children:d(X,{position:"bottom",image:d(T.SidebarIcon,{}),onClick:()=>{t.toggleCollapsedSidebar(),document.activeElement?.blur()}})})},ze=e(x).withConfig({componentId:"sc-bd3hmz-0"})(["padding-bottom:16px;"]),Re=e(j).withConfig({componentId:"sc-bd3hmz-1"})(["padding:8px;flex-shrink:0;"]),Le=e.div.withConfig({componentId:"sc-bd3hmz-2"})(["width:100%;"]),Ae=e(Ne).withConfig({componentId:"sc-bd3hmz-3"})(["width:100%;transition:width 100ms ease-out;margin:8px 0;"]),Me=e.div.withConfig({componentId:"sc-bd3hmz-4"})(["position:absolute;right:0;opacity:0;transform:translateX(10px);transition:opacity 100ms ease-out,transform 100ms ease-out;"]),qe=e(F).withConfig({componentId:"sc-bd3hmz-5"})(["",""],(({$hoverTransition:e})=>e&&`\n      &: ${o} {\n        ${Ae} {\n          width: 85%;\n        }\n\n        ${Me} {\n          opacity: 1;\n          transform: translateX(0);\n        }\n      }\n    `)),Oe=s((function SharedSidebar({rootNode:e,shareId:t}){const n=D(),o=pe({rejectOnEmpty:!1}),{ui:i,documents:a}=g(),{t:r}=f(),s=!!n?.name;return u(qe,{$hoverTransition:!s,children:[s&&d(V,{title:n.name,image:d(fe,{model:n,size:ge.XLarge,alt:r("Logo")}),onClick:()=>C.push(o?k():l(t,e.url)),children:d(ToggleSidebar,{})}),u(ze,{topShadow:!0,flex:!0,children:[u(Re,{children:[d(Le,{children:d(Ae,{shareId:t})}),!s&&d(Me,{children:d(ToggleSidebar,{})})]}),d(K,{children:d(Pe,{index:0,depth:0,shareId:t,node:e,prefetchDocument:a.prefetchDocument,activeDocumentId:i.activeDocumentId,activeDocument:a.active})})]})]})})),$e={},He=document.querySelector("link[rel=canonical]")?.getAttribute("href"),_e=He?new URL(He).origin:window.location.origin;const Be=s((({shareId:e,response:t})=>{const{hasHeadings:n,setDocument:o}=Q();if(!t.document)return null;const i=!!n&&(t.team?.tocPosition??H.Left);return o(t.document),d(ne,{abilities:$e,document:t.document,sharedTree:t.sharedTree,shareId:e,tocPosition:i,readOnly:!0})})),Ue=e(_).withConfig({componentId:"sc-1c1luk4-0"})(["color:",";text-align:center;margin-top:-8px;"],i("textSecondary")),We=s((function SharedDocumentScene(e){const{ui:t}=g(),n=E(),o=pe({rejectOnEmpty:!1}),i=c.useMemo((()=>new URLSearchParams(n.search)),[n.search]),{t:a,i18n:r}=f(),[s,l]=c.useState(),[m,h]=c.useState(),{documents:p}=g(),[,b]=N(),{shareId:I=P.ROOT_SHARE_ID,documentSlug:w}=e.match.params,x=function useDocumentId(e,t){let n;return t?.sharedTree&&function findInTree(t){if(t.url.endsWith(e))return n=t.id,!0;if(t.children)for(const e of t.children)if(findInTree(e))return!0;return!1}(t.sharedTree),n}(w,s),j=["dark","light"].includes(i.get("theme")||"")?i.get("theme"):void 0,D=z(s?.team?.customTheme,j);return c.useEffect((()=>(I&&R.setShareId(I),()=>{R.setShareId(void 0)})),[I]),c.useEffect((()=>{o||be(ve(),r)}),[o,r]),c.useEffect((()=>{window.document.body.style.background=D.background}),[D]),c.useEffect((()=>{x&&t.setActiveDocument(x)}),[t,x]),c.useEffect((()=>{!async function fetchData(){try{l((e=>({...e,document:void 0})));const e=await p.fetchWithSharedTree(w,{shareId:I});l(e)}catch(e){h(e)}}()}),[p,w,I,t]),m?m instanceof L?d(ee,{}):m instanceof A?(b(e.location.pathname),d(Ie,{children:e=>e?.name&&M?d(Ue,{children:a("{{ teamName }} is using {{ appName }} to share documents, please login to continue.",{teamName:e.name,appName:P.APP_NAME})}):null})):d(J,{}):void 0===s?.sharedTree?d(te,{location:e.location}):u(v,{children:[d(q,{children:d("link",{rel:"canonical",href:_e+n.pathname.replace(/\/$/,"")})}),d(O.Provider,{value:s.team,children:d($,{theme:D,children:u(Y,{children:[d(Z,{title:s.document?.title,sidebar:s.sharedTree?.children.length?d(Oe,{rootNode:s.sharedTree,shareId:I}):void 0,children:d(Be,{shareId:I,response:s})}),d(G,{minHeight:"20vh"})]})})})]})}));export{We as default};
