import{o as e,u as a,a as t,i as s,r,Z as o,d as n,z as i,j as c,h as d,a5 as l,F as m,y as h,k as u,w as p,H as f,am as y,L as g,A as b,b4 as S,b5 as j}from"./index.mlCxaiYE.js";import{N as k}from"./Notice.4wB6_cwE.js";import{H as w,S as C}from"./Scene.tZk0YIWv.js";import{u as v}from"./useCurrentTeam.fRZpnoZU.js";import{u as A}from"./usePolicy.wYF8wJNp.js";import{S as x,u as T,a as D}from"./StickyFilters.abAWg0uL.js";import{A as B,a as I}from"./TeamLogo.qV1feKYB.js";import{T as L}from"./Time.rp9cc_zo.js";import{u as q}from"./useUserLocale.0OnEZJRN.js";import{C as M,M as P}from"./InputSelectPermission.lb2lIKIy.js";import{b as U,O as E,C as F}from"./DocumentContext.hhTeDqBR.js";import{f as N}from"./language.6NyDJHi_.js";import"./useCurrentUser.zlImhYTS.js";import"./useBoolean.4JQO1FDN.js";import"./PopoverDisclosure.OO70kItq.js";import"./PlaceholderText.UNfhMHoO.js";import"./LoadingIndicatorBar.mGaD64ZX.js";import"./Switch.3DOmHSIs.js";import"./Badge.sHfYRIgC.js";import"./Item.dGEOVRdT.js";import"./index.esm.XsAbwjVB.js";import"./SharedLayoutContext.2BBc39h7.js";const z=e((function ShareMenu({share:e}){const l=U({modal:!0}),{shares:m}=a(),{t:h}=t(),u=s(),p=A(e),f=r.useCallback((a=>{a.preventDefault(),u.push(e.documentUrl)}),[u,e]),y=r.useCallback((async a=>{a.preventDefault();try{await m.revoke(e),o.message(h("Share link revoked"))}catch(t){o.error(t.message)}}),[h,m,e]),g=r.useCallback((()=>{o.success(h("Share link copied"))}),[h]);return n(i,{children:[c(E,{"aria-label":h("Show menu"),...l}),n(M,{...l,"aria-label":h("Share options"),children:[c(F,{text:e.url,onCopy:g,children:c(P,{...l,icon:c(d.CopyIcon,{}),children:h("Copy link")})}),c(P,{...l,onClick:f,icon:c(d.ArrowIcon,{}),children:h("Go to document")}),p.revoke&&n(i,{children:[c("hr",{}),c(P,{...l,onClick:y,icon:c(d.TrashIcon,{}),dangerous:!0,children:h("Revoke link")})]})]})]})}));function SharesTable({data:e,canManage:a,...s}){const{t:o}=t(),d=q(),u=e.some((e=>e.domain)),p=r.useMemo((()=>l([{type:"data",id:"title",header:o("Document"),accessor:e=>e.documentTitle||o("Untitled"),sortable:!1,component:e=>c(i,{children:e.documentTitle||o("Untitled")}),width:"4fr"},{type:"data",id:"createdBy",header:o("Shared by"),accessor:e=>e.createdBy,sortable:!1,component:e=>c(m,{align:"center",gap:8,children:e.createdBy&&n(i,{children:[c(B,{model:e.createdBy,size:I.Small}),e.createdBy.name]})}),width:"2fr"},{type:"data",id:"createdAt",header:o("Date shared"),accessor:e=>e.createdAt,component:e=>e.createdAt?c(L,{dateTime:e.createdAt,addSuffix:!0}):null,width:"2fr"},{type:"data",id:"lastAccessedAt",header:o("Last accessed"),accessor:e=>e.lastAccessedAt,component:e=>e.lastAccessedAt?c(L,{dateTime:e.lastAccessedAt,addSuffix:!0}):null,width:"2fr"},u?{type:"data",id:"domain",header:o("Domain"),accessor:e=>e.domain,sortable:!1,component:e=>c(i,{children:e.domain}),width:"1.5fr"}:void 0,{type:"data",id:"views",header:o("Views"),accessor:e=>e.views,component:e=>c(i,{children:d?N(e.views,h(d)):e.views}),width:"150px"},a?{type:"action",id:"action",component:e=>c(m,{align:"center",children:c(z,{share:e})}),width:"50px"}:void 0])),[o,d,u,a]);return c(x,{data:e,columns:p,rowHeight:50,stickyOffset:w,...s})}const H=e((function Shares(){const e=v(),{t:l}=t(),m=u(),h=s(),{shares:w,auth:x}=a(),B=x.team&&x.team.sharing,I=A(e),L=p(),[q,M]=r.useState(""),P=r.useMemo((()=>({query:L.get("query")||void 0,sort:L.get("sort")||"createdAt",direction:(L.get("direction")||"desc").toUpperCase()})),[L]),U=r.useMemo((()=>({id:P.sort,desc:"DESC"===P.direction})),[P.sort,P.direction]),{data:E,error:F,loading:N,next:z}=T({data:w.findByQuery(P.query??""),sort:U,reqFn:w.fetchPage,reqParams:P}),H=r.useCallback(((e,a)=>{a?L.set(e,a):L.delete(e),h.replace({pathname:m.pathname,search:L.toString()})}),[L,h,m.pathname]),G=r.useCallback((e=>{const{value:a}=e.target;M(a)}),[]);return r.useEffect((()=>{F&&o.error(l("Could not load shares"))}),[l,F]),r.useEffect((()=>{const e=setTimeout((()=>H("query",q)),250);return()=>clearTimeout(e)}),[q,H]),n(C,{title:l("Shared Links"),icon:c(d.GlobeIcon,{}),wide:!0,children:[c(f,{children:l("Shared Links")}),I.update&&!B&&n(i,{children:[n(k,{icon:c(d.WarningIcon,{}),children:[l("Sharing is currently disabled.")," ",c(y,{defaults:"You can globally enable and disable public document sharing in the <em>security settings</em>.",components:{em:c(g,{to:"/settings/security"})}})]}),c("br",{})]}),c(b,{as:"p",type:"secondary",children:c(y,{children:"Documents that have been shared are listed below. Anyone that has the public link can access a read-only version of the document until the link has been revoked."})}),c(D,{gap:8,children:c(S,{short:!0,value:q,placeholder:`${l("Filter")}â€¦`,onChange:G})}),c(j,{animate:!E,children:c(SharesTable,{data:E??[],sort:U,canManage:I.update,loading:N,page:{hasNext:!!z,fetchNext:z}})})]})}));export{H as default};
