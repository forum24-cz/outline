import{n as e,h as t,C as o,o as r,a as i,u as a,r as n,cd as s,Z as c,d as l,F as d,j as p,A as m,ce as u,bB as h,B as f,b$ as g,c0 as b,cf as y,cg as I,X as C,z as x,e as w,am as k,b1 as S,ch as j,aq as v,b as M,ci as D,b9 as P,a$ as A,b2 as N,cj as O,H as z,aA as T,K as E,bC as L}from"./index.mlCxaiYE.js";import{b as $,O as B,T as H,B as J}from"./DocumentContext.hhTeDqBR.js";import{O as F}from"./OutlineIcon.Lni4fHNe.js";import{C as Y,L as R}from"./Item.dGEOVRdT.js";import{P as _}from"./Badge.sHfYRIgC.js";import{S as q}from"./Scene.tZk0YIWv.js";import{S as W,F as Z}from"./FileOperationListItem.vfDyquNl.js";import{f as Q}from"./authenticated.03alztlO.js";import{I as K,C as U}from"./InputSelectPermission.lb2lIKIy.js";import{L as V}from"./LoadingIndicatorBar.mGaD64ZX.js";import{D as X}from"./PopoverDisclosure.OO70kItq.js";import{A as G}from"./Actions.u9jjnQ1W.js";import{T as ee}from"./Time.rp9cc_zo.js";import{u as te}from"./useCurrentUser.zlImhYTS.js";import{u as oe}from"./usePolicy.wYF8wJNp.js";import"./PlaceholderText.UNfhMHoO.js";import"./Switch.3DOmHSIs.js";import"./TeamLogo.qV1feKYB.js";import"./useBoolean.4JQO1FDN.js";import"./index.esm.XsAbwjVB.js";import"./useCurrentTeam.fRZpnoZU.js";import"./SharedLayoutContext.2BBc39h7.js";import"./urls.doI9odX4.js";import"./Notice.4wB6_cwE.js";import"./ButtonLink.tgoiIjKJ.js";import"./routeHelpers.MPg4vHxP.js";const re=e(t.NewDocumentIcon).withConfig({componentId:"sc-z2iu50-0"})(["padding:4px;border-radius:50%;background:",";color:white;"],(e=>e.theme.brand.blue)),ie=e.div.withConfig({componentId:"sc-z2iu50-1"})(["background:",";border-radius:8px;border:1px dashed ",";padding:52px;text-align:center;font-size:15px;cursor:var(--pointer);opacity:",";&:hover{background:",";}"],(e=>e.$isDragActive?e.theme.backgroundSecondary:e.theme.background),o("divider"),(e=>e.$disabled?.5:1),o("backgroundSecondary")),ae=r((function DropToImport({disabled:e,onSubmit:t,children:o,format:r}){const{t:y}=i(),{collections:I}=a(),[C,x]=n.useState(null),[w,k]=n.useState(!1),[S,j]=n.useState(s.ReadWrite),v=n.useCallback((()=>{c.error(y("File not supported – please upload a valid ZIP file"))}),[y]);return e?o:l(d,{gap:8,column:!0,children:[w&&p(V,{}),p(m,{as:"p",type:"secondary",children:p(Q,{accept:"application/zip, application/x-zip-compressed",onDropAccepted:e=>{e.length>1?c.error(y("Please choose a single file to import")):x(e[0])},onDropRejected:v,disabled:w,children:({getRootProps:e,getInputProps:t,isDragActive:r})=>l(ie,{...e(),$disabled:w,$isDragActive:r,tabIndex:-1,children:[p("input",{...t()}),l(d,{align:"center",gap:4,column:!0,children:[p(re,{size:32,color:"#fff"}),C?y(`${C.name} (${u(C.size)})`):o]})]})})}),l("div",{children:[p(K,{value:S,onChange:e=>{j(e===h?null:e)}}),l(m,{as:"span",type:"secondary",children:[y("Set the default permission level for collections created from the import"),"."]})]}),p(d,{justify:"flex-end",children:p(f,{disabled:!C,onClick:async()=>{if(C){k(!0);try{const e=await b(C,{name:C.name,preset:g.WorkspaceImport});await I.import(e.id,{format:r,permission:S}),t(),c.message(C.name,{description:y("Your import is being processed, you can safely leave this page")})}catch(e){c.error(e.message)}finally{k(!1)}}},children:y("Start import")})})]})})),HelpDisclosure=({title:e,children:o})=>{const r=I({animated:!0}),i=C();return l(x,{children:[p(X,{...r,children:o=>p(ne,{icon:p(t.QuestionMarkIcon,{color:i.textSecondary}),neutral:!0,"aria-label":e,borderOnHover:!0,...o})}),p(se,{...r,children:p(m,{as:"p",type:"secondary",children:o})})]})},ne=e(f).withConfig({componentId:"sc-191ma9r-0"})(["position:absolute;top:20px;right:50px;"]),se=e(y).withConfig({componentId:"sc-191ma9r-1"})(["transition:opacity 250ms ease-in-out;opacity:0;&[data-enter]{opacity:1;}"]);function ImportJSONDialog(){const{dialogs:e}=a(),t=w.APP_NAME;return l(x,{children:[p(HelpDisclosure,{title:p(k,{children:"How does this work?"}),children:p(k,{defaults:"You can import a zip file that was previously exported from the JSON option in another instance. In {{ appName }}, open <em>Export</em> in the Settings sidebar and click on <em>Export Data</em>.",values:{appName:t},components:{em:p("strong",{})}})}),p(ae,{onSubmit:e.closeAllModals,format:S.JSON,children:l(k,{children:["Drag and drop the zip file from the JSON export option in"," ",{appName:t},", or click to upload"]})})]})}const ce=r((({importModel:e,onCancel:o,onDelete:r})=>{const{t:a}=i(),s=oe(e),c=$({modal:!0}),d=n.useMemo((()=>[{type:"button",title:a("Cancel"),visible:s.cancel,icon:p(t.CrossIcon,{}),dangerous:!0,onClick:o},{type:"button",title:a("Delete"),visible:s.delete,icon:p(t.TrashIcon,{}),dangerous:!0,onClick:r}]),[a,s.delete,s.cancel,o,r]);return l(x,{children:[p(B,{"aria-label":a("Show menu"),...c}),p(U,{...c,"aria-label":a("Import menu options"),children:p(H,{...c,items:d})})]})})),le=r((({importModel:e})=>{const{t:o}=i(),{dialogs:r}=a(),n=te(),s=C(),d=e.state!==j.Canceled&&e.state!==j.Errored,m=!v&&e.state===j.Errored&&!!e.error,u=M.useMemo((()=>({[j.Created]:o("Processing"),[j.InProgress]:o("Processing"),[j.Processed]:o("Processing"),[j.Completed]:o("Completed"),[j.Errored]:o("Failed"),[j.Canceled]:o("Canceled")})),[o]),h=M.useMemo((()=>({[j.Created]:p(W,{}),[j.InProgress]:p(W,{}),[j.Processed]:p(W,{}),[j.Completed]:p(t.DoneIcon,{color:s.accent}),[j.Errored]:p(t.WarningIcon,{color:s.danger}),[j.Canceled]:p(t.CrossIcon,{color:s.textTertiary})})),[s]),f=M.useCallback((async()=>{r.openModal({title:o("Are you sure you want to cancel this import?"),content:p(Y,{onSubmit:async()=>{try{await e.cancel(),c.success(o("Import canceled"))}catch(t){c.error(t.message)}},submitText:o("Cancel"),savingText:`${o("Canceling")}…`,danger:!0,children:o("Canceling this import will discard any progress made. This cannot be undone.")})})}),[o,r,e]),g=M.useCallback((async()=>{r.openModal({title:o("Are you sure you want to delete this import?"),content:p(Y,{onSubmit:async()=>{try{await e.delete(),c.success(o("Import deleted"))}catch(t){c.error(t.message)}},savingText:`${o("Deleting")}…`,danger:!0,children:o("Deleting this import will also delete all collections and documents that were created from it. This cannot be undone.")})})}),[o,r,e]);return p(R,{title:e.name,image:h[e.state],subtitle:l(x,{children:[u[e.state]," • ",m&&l(x,{children:[e.error,`. ${o("Check server logs for more details.")}`," • "]}),o("{{userName}} requested",{userName:n.id===e.createdBy.id?o("You"):e.createdBy.name})," ",p(ee,{dateTime:e.createdAt,addSuffix:!0,shorten:!0})," • ",D(e.service),d&&l(x,{children:[" • ",o("{{ count }} document imported",{count:e.documentCount})]})]}),actions:p(G,{children:p(ce,{importModel:e,onCancel:f,onDelete:g})})})}));function ImportMarkdownDialog(){const{dialogs:e}=a(),t=w.APP_NAME;return l(x,{children:[p(HelpDisclosure,{title:p(k,{children:"How does this work?"}),children:p(k,{defaults:"You can import a zip file that was previously exported from an Outline installation – collections, documents, and images will be imported. In Outline, open <em>Export</em> in the Settings sidebar and click on <em>Export Data</em>.",components:{em:p("strong",{})}})}),p(ae,{onSubmit:e.closeAllModals,format:S.MarkdownZip,children:l(k,{children:["Drag and drop the zip file from the Markdown export option in"," ",{appName:t},", or click to upload"]})})]})}const de=r((function Import(){const{t:e}=i(),{fileOperations:o,imports:r}=a(),s=function useImportsConfig(){const{t:e}=i(),{dialogs:t}=a(),o=w.APP_NAME;return n.useMemo((()=>{const r=[{title:e("Markdown"),subtitle:e("Import a zip file of Markdown documents (exported from version 0.67.0 or earlier)"),icon:p(J,{size:28}),action:l(f,{type:"submit",onClick:()=>{t.openModal({title:e("Import data"),content:p(ImportMarkdownDialog,{})})},neutral:!0,children:[e("Import"),"…"]})},{title:"JSON",subtitle:e("Import a JSON data file exported from another {{ appName }} instance",{appName:o}),icon:p(F,{size:28,cover:!0}),action:l(f,{type:"submit",onClick:()=>{t.openModal({title:e("Import data"),content:p(ImportJSONDialog,{})})},neutral:!0,children:[e("Import"),"…"]})}];return T.getHooks(E.Imports).forEach((e=>{r.push({...e.value})})),r.push({title:"Confluence",subtitle:e("Import pages from a Confluence instance"),icon:p("img",{src:L("/images/confluence.png"),width:28}),action:p(f,{type:"submit",disabled:!0,neutral:!0,children:e("Enterprise")})}),r}),[e,t,o])}(),c=w.APP_NAME,[,d]=n.useState(0),u=n.useMemo((()=>({imports:0,fileOperations:0})),[]),h=n.useCallback((async()=>{const[e,t]=await Promise.all([r.fetchPage({offset:u.imports,limit:P.defaultLimit}),o.fetchPage({type:A.Import,offset:u.fileOperations,limit:P.defaultLimit})]),i=N([...e,...t],"createdAt","desc").slice(0,P.defaultLimit),a=i.filter((e=>e instanceof O)).length;return u.imports+=a,u.fileOperations+=i.length-a,d((e=>++e)),i}),[r,o,u]),g=N([...r.orderedData,...o.filter({type:A.Import})],"createdAt","desc").slice(0,u.imports+u.fileOperations);return l(q,{title:e("Import"),icon:p(t.NewDocumentIcon,{}),children:[p(z,{children:e("Import")}),p(m,{as:"p",type:"secondary",children:l(k,{children:["Quickly transfer your existing documents, pages, and files from other tools and services into ",{appName:c},". You can also drag and drop any HTML, Markdown, and text documents directly into Collections in the app."]})}),p("div",{children:s.map((e=>p(R,{title:e.title,subtitle:e.subtitle,image:e.icon,actions:e.action,border:!1},e.title)))}),p("br",{}),p(_,{items:g,fetch:h,heading:p("h2",{children:p(k,{children:"Recent imports"})}),renderItem:e=>e instanceof O?p(le,{importModel:e},e.id):p(Z,{fileOperation:e},e.id)})]})}));export{de as default};
