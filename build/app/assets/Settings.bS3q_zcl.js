import{b6 as e,a as t,j as a,B as n,n as c,C as s,o,d as i,F as r,z as l,am as d,A as m,bp as u,Z as p,u as h,w as k,r as g,au as f,at as S,e as b,H as y}from"./index.mlCxaiYE.js";import{C as v,L as U}from"./List.EsUl4VzT.js";import{S as w}from"./SettingRow.96ERny3f.js";import{C,P as j,S as N}from"./Switch.3DOmHSIs.js";import{L as $}from"./Item.dGEOVRdT.js";import{N as L}from"./Notice.4wB6_cwE.js";import{S as P}from"./Scene.tZk0YIWv.js";import{u as x}from"./useCurrentTeam.fRZpnoZU.js";import{u as A}from"./usePolicy.wYF8wJNp.js";import{i as B}from"./routeHelpers.MPg4vHxP.js";import{I}from"./index.nmRuCLHI.js";import{B as _}from"./ButtonLink.tgoiIjKJ.js";import{u as D,P as T}from"./PopoverDisclosure.OO70kItq.js";import"./useCurrentUser.zlImhYTS.js";const M=class _SlackUtils{static createState(e,t,a){return JSON.stringify({type:t,teamId:e,...a})}static parseState(e){return JSON.parse(e)}static callbackUrl({baseUrl:t,params:a}={baseUrl:`${e.URL}`,params:void 0}){return a?`${t}/auth/slack.callback?${a}`:`${t}/auth/slack.callback`}static connectUrl({baseUrl:t,params:a}={baseUrl:`${e.URL}`,params:void 0}){return a?`${t}/auth/slack.post?${a}`:`${t}/auth/slack.post`}static errorUrl(e){return B(`slack?error=${e}`)}static get url(){return B("slack")}static authUrl(t,a=["identity.email","identity.basic","identity.avatar","identity.team"],n=_SlackUtils.callbackUrl()){const c=_SlackUtils.authBaseUrl,s={client_id:e.SLACK_CLIENT_ID,scope:a?a.join(" "):"",redirect_uri:n,state:t};return`${c}?${Object.keys(s).map((e=>`${e}=${encodeURIComponent(s[e])}`)).join("&")}`}};M.authBaseUrl="https://slack.com/oauth/authorize";let z=M;function SlackButton({state:e="",scopes:c,redirectUri:s,label:o,icon:i}){const{t:r}=t();return a(n,{onClick:()=>{window.location.href=z.authUrl(e,c,s)},icon:i,neutral:!0,children:o||r("Add to Slack")})}const O=c.div.withConfig({componentId:"sc-1oybsg8-0"})(["color:",";margin-top:-12px;"],s("text")),R=o((function SlackListItem({integration:e,collection:n}){const{t:c}=t(),handleChange=async t=>{t.target.checked?e.events=u([...e.events,t.target.name]):e.events=e.events.filter((e=>e!==t.target.name)),await e.save(),p.success(c("Settings saved"))},s={"documents.publish":c("document published"),"documents.update":c("document updated")},o=D({gutter:0,placement:"bottom-start"});return a($,{title:i(r,{align:"center",gap:6,children:[a(C,{collection:n})," ",n.name]}),subtitle:i(l,{children:[a(d,{defaults:"Posting to the <em>{{ channelName }}</em> channel on",values:{channelName:e.settings.channel,events:e.events.map((e=>s[e])).join(", ")},components:{em:a("strong",{})}})," ",a(T,{...o,children:t=>a(_,{...t,children:e.events.map((e=>s[e])).join(", ")})}),a(j,{...o,"aria-label":c("Settings"),children:i(O,{children:[a("h3",{children:c("Notifications")}),a(m,{as:"p",type:"secondary",children:c("These events should be posted to Slack")}),a(N,{label:c("Document published"),name:"documents.publish",checked:e.events.includes("documents.publish"),onChange:handleChange}),a(N,{label:c("Document updated"),name:"documents.update",checked:e.events.includes("documents.update"),onChange:handleChange})]})})]}),actions:a(v,{onClick:e.delete,confirmationMessage:c("This will prevent any future updates from being posted to this Slack channel. Are you sure?")})},e.id)}));const E=c.code.withConfig({componentId:"sc-12pwed7-0"})(["padding:4px 6px;margin:0 2px;background:",";border-radius:4px;font-size:80%;"],(e=>e.theme.codeBackground)),q=o((function Slack(){const e=x(),{collections:n,integrations:c}=h(),{t:s}=t(),o=k(),u=A(e),p=o.get("error");g.useEffect((()=>{n.fetchPage({limit:100}),c.fetchPage({service:f.Slack,limit:100})}),[n,c]);const j=c.find({type:S.Command,service:f.Slack}),N=c.find({type:S.LinkedAccount,service:f.Slack}),B=n.orderedData.map((e=>[e,c.find({service:f.Slack,collectionId:e.id})])).sort((e=>e[1]?-1:1)),_=b.APP_NAME;return i(P,{title:"Slack",icon:a(I,{}),children:[a(y,{children:"Slack"}),"access_denied"===p&&a(L,{children:i(d,{children:["Whoops, you need to accept the permissions in Slack to connect"," ",{appName:_}," to your workspace. Try again?"]})}),"unauthenticated"===p&&a(L,{children:a(d,{children:"Something went wrong while authenticating your request. Please try logging in again."})}),a(w,{name:"link",label:s("Personal account"),description:i(d,{children:["Link your ",{appName:_}," account to Slack to enable searching and previewing the documents you have access to, directly within chat."]}),children:a(r,{align:"flex-end",column:!0,children:N?a(v,{onClick:N.delete,confirmationMessage:s("Disconnecting your personal account will prevent searching for documents from Slack. Are you sure?")}):a(SlackButton,{redirectUri:z.connectUrl(),state:z.createState(e.id,S.LinkedAccount),label:s("Connect")})})}),u.update&&i(l,{children:[a(w,{name:"slash",border:!1,label:s("Slash command"),description:a(d,{defaults:"Get rich previews of {{ appName }} links shared in Slack and use the <em>{{ command }}</em> slash command to search for documents without leaving your chat.",values:{command:"/outline",appName:_},components:{em:a(E,{})}}),children:a(r,{align:"flex-end",column:!0,children:j?a(v,{onClick:j.delete,confirmationMessage:s("This will remove the Outline slash command from your Slack workspace. Are you sure?")}):a(SlackButton,{scopes:["commands","links:read","links:write"],redirectUri:z.connectUrl(),state:z.createState(e.id,S.Command),icon:a(I,{})})})}),a(y,{as:"h2",children:s("Collections")}),a(m,{as:"p",type:"secondary",children:i(d,{children:["Connect ",{appName:_}," collections to Slack channels. Messages will be automatically posted to Slack when documents are published or updated."]})}),a(U,{children:B.map((([t,n])=>n?a(R,{collection:t,integration:n},n.id):a($,{title:t.name,image:a(C,{collection:t}),actions:a(SlackButton,{scopes:["incoming-webhook"],redirectUri:z.connectUrl(),state:z.createState(e.id,S.Post,{collectionId:t.id}),label:s("Connect")})},t.id)))})]})]})}));export{q as default};
