import{o as e,u as t,a as s,r as a,j as i,Z as r,d as o,z as n,aS as l,aX as c,n as d,F as u,a5 as m,e as p,k as h,i as v,w as b,h as f,B as y,H as g,A as C,am as A,b4 as k,b5 as j,bV as S}from"./index.mlCxaiYE.js";import{A as w}from"./Actions.u9jjnQ1W.js";import{H as M,S as x}from"./Scene.tZk0YIWv.js";import{a as I,U as T,b as q,c as D,d as P,e as E}from"./authenticated.03alztlO.js";import{b as F,u as U,O as L,T as B}from"./DocumentContext.hhTeDqBR.js";import{u as N}from"./useCurrentTeam.fRZpnoZU.js";import{u as $}from"./usePolicy.wYF8wJNp.js";import{S as K,F as V,u as H,a as z}from"./StickyFilters.abAWg0uL.js";import{A as O,a as R}from"./TeamLogo.qV1feKYB.js";import{B as G}from"./Badge.sHfYRIgC.js";import{T as Q}from"./Time.rp9cc_zo.js";import{u as X}from"./useCurrentUser.zlImhYTS.js";import{C as Y}from"./InputSelectPermission.lb2lIKIy.js";import{F as Z}from"./FilterOptions.-kirZheg.js";import"./Item.dGEOVRdT.js";import"./index.esm.XsAbwjVB.js";import"./urls.doI9odX4.js";import"./Notice.4wB6_cwE.js";import"./Switch.3DOmHSIs.js";import"./PopoverDisclosure.OO70kItq.js";import"./useBoolean.4JQO1FDN.js";import"./LoadingIndicatorBar.mGaD64ZX.js";import"./PlaceholderText.UNfhMHoO.js";import"./ButtonLink.tgoiIjKJ.js";import"./routeHelpers.MPg4vHxP.js";import"./SharedLayoutContext.2BBc39h7.js";const _=e((function UserMenu({user:e}){const{users:d,dialogs:u}=t(),{t:m}=s(),p=F({modal:!0}),h=$(e),v=U({isContextMenu:!0}),b=a.useCallback((t=>{t.preventDefault(),u.openModal({title:m("Change name"),content:i(I,{user:e,onSubmit:u.closeAllModals})})}),[u,m,e]),f=a.useCallback((t=>{t.preventDefault(),u.openModal({title:m("Change email"),content:i(T,{user:e,onSubmit:u.closeAllModals})})}),[u,m,e]),y=a.useCallback((t=>{t.preventDefault(),u.openModal({title:m("Suspend user"),content:i(q,{user:e,onSubmit:u.closeAllModals})})}),[u,m,e]),g=a.useCallback((async t=>{t.preventDefault(),await d.delete(e)}),[d,e]),C=a.useCallback((async t=>{t.preventDefault();try{await d.resendInvite(e),r.success(m(`Invite was resent to ${e.name}`))}catch(s){r.error(s.message??m("An error occurred while sending the invite"))}}),[d,e,m]),A=a.useCallback((async t=>{t.preventDefault(),await d.activate(e)}),[d,e]);return o(n,{children:[i(L,{"aria-label":m("Show menu"),...p}),i(Y,{...p,"aria-label":m("User options"),children:i(B,{...p,items:[{type:"submenu",title:m("Change role"),visible:h.demote||h.promote,items:[l.Admin,l.Member,l.Viewer].map((t=>c(D(e,t),v)))},{type:"button",title:`${m("Change name")}…`,onClick:b,visible:h.update},{type:"button",title:`${m("Change email")}…`,onClick:f,visible:h.update},{type:"button",title:m("Resend invite"),onClick:C,visible:h.resendInvite},{type:"separator"},{type:"button",title:`${m("Revoke invite")}…`,dangerous:!0,onClick:g,visible:e.isInvited},{type:"button",title:m("Activate user"),onClick:A,visible:!e.isInvited&&e.isSuspended},{type:"button",title:`${m("Suspend user")}…`,dangerous:!0,onClick:y,visible:!e.isInvited&&!e.isSuspended},{type:"separator"},c(P(e.id),v)]})})]})})),J=M+V;function MembersTable({canManage:e,...t}){const{t:r}=s(),l=X(),c=a.useMemo((()=>m([{type:"data",id:"name",header:r("Name"),accessor:e=>e.name,component:e=>o(u,{align:"center",gap:8,children:[i(O,{model:e,size:R.Large})," ",e.name," ",l.id===e.id&&`(${r("You")})`]}),width:"4fr"},e?{type:"data",id:"email",header:r("Email"),accessor:e=>e.email,component:e=>i(n,{children:e.email}),width:"4fr"}:void 0,{type:"data",id:"lastActiveAt",header:r("Last active"),accessor:e=>e.lastActiveAt,component:e=>e.lastActiveAt?i(Q,{dateTime:e.lastActiveAt,addSuffix:!0}):null,width:"2fr"},{type:"data",id:"role",header:r("Role"),accessor:e=>e.role,component:e=>o(W,{wrap:!0,children:[!e.lastActiveAt&&i(G,{children:r("Invited")}),e.isAdmin?i(G,{primary:!0,children:r("Admin")}):e.isViewer?i(G,{children:r("Viewer")}):e.isGuest?i(G,{children:r("Guest")}):i(G,{children:r("Editor")}),e.isSuspended&&i(G,{children:r("Suspended")})]}),width:"2fr"},e?{type:"action",id:"action",component:e=>l.id!==e.id?i(_,{user:e}):null,width:"50px"}:void 0])),[r,l,e]);return i(K,{columns:c,rowHeight:60,stickyOffset:J,...t})}const W=d(u).withConfig({componentId:"sc-1shqod0-0"})(["margin-left:-10px;row-gap:4px;"]),ee=e((({activeKey:e,onSelect:t,...r})=>{const{t:o}=s(),n=a.useMemo((()=>m([{key:"",label:o("All roles")},{key:l.Admin,label:o("Admins")},{key:l.Member,label:o("Editors")},{key:l.Viewer,label:o("Viewers")}])),[o]);return i(Z,{options:n,selectedKeys:[e],onSelect:t,defaultLabel:o("All roles"),...r})}));function getFilteredUsers({users:e,query:t,filter:s,role:a}){let i;switch(s){case"all":i=e.all;break;case"suspended":i=e.suspended;break;case"invited":i=e.invited;break;default:i=e.active}return a&&(i=i.filter((e=>e.role===a))),t&&(i=S(i,t)),i}const te=d(e((({activeKey:e,onSelect:t,...r})=>{const{t:o}=s(),n=X(),l=a.useMemo((()=>m([{key:"all",label:o("All status")},{key:"",label:o("Active")},...n.isAdmin?[{key:"suspended",label:o("Suspended")}]:[],{key:"invited",label:o("Invited")}])),[o,n.isAdmin]);return i(Z,{options:l,selectedKeys:[e],onSelect:t,defaultLabel:o("Active"),...r})}))).withConfig({componentId:"sc-voloej-0"})(["height:32px;"]),se=d(ee).withConfig({componentId:"sc-voloej-1"})(["height:32px;"]),ae=e((function Members(){const e=p.APP_NAME,l=h(),c=v(),d=N(),u=U(),{users:m}=t(),{t:S}=s(),M=b(),I=$(d),[T,q]=a.useState(""),D=a.useMemo((()=>({query:M.get("query")||void 0,filter:M.get("filter")||"active",role:M.get("role")||void 0,sort:M.get("sort")||"name",direction:(M.get("direction")||"asc").toUpperCase()})),[M]),P=a.useMemo((()=>({id:D.sort,desc:"DESC"===D.direction})),[D.sort,D.direction]),{data:F,error:L,loading:B,next:K}=H({data:getFilteredUsers({users:m,query:D.query,filter:D.filter,role:D.role}),sort:P,reqFn:m.fetchPage,reqParams:D}),V=a.useCallback(((e,t)=>{t?M.set(e,t):M.delete(e),c.replace({pathname:l.pathname,search:M.toString()})}),[M,c,l.pathname]),O=a.useCallback((e=>V("filter",e)),[V]),R=a.useCallback((e=>V("role",e)),[V]),G=a.useCallback((e=>{const{value:t}=e.target;q(t)}),[]);return a.useEffect((()=>{L&&r.error(S("Could not load members"))}),[S,L]),a.useEffect((()=>{const e=setTimeout((()=>V("query",T)),250);return()=>clearTimeout(e)}),[T,V]),o(x,{title:S("Members"),icon:i(f.UserIcon,{}),actions:i(n,{children:I.inviteUser&&i(w,{children:o(y,{type:"button","data-on":"click","data-event-category":"invite","data-event-action":"peoplePage",action:E,context:u,icon:i(f.PlusIcon,{}),children:[S("Invite people"),"…"]})})}),wide:!0,children:[i(g,{children:S("Members")}),i(C,{as:"p",type:"secondary",children:o(A,{children:["Everyone that has signed into ",{appName:e}," is listed here. It’s possible that there are other users who have access through"," ",{signinMethods:d.signinMethods}," but haven’t signed in yet."]})}),o(z,{gap:8,children:[i(k,{short:!0,value:T,placeholder:`${S("Filter")}…`,onChange:G}),i(te,{activeKey:D.filter??"",onSelect:O}),i(se,{activeKey:D.role??"",onSelect:R})]}),i(j,{animate:!F,children:i(MembersTable,{data:F??[],sort:P,canManage:I.update,loading:B,page:{hasNext:!!K,fetchNext:K}})})]})}));export{ae as default};
