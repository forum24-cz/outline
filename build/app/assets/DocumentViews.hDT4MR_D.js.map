{"version":3,"file":"DocumentViews.hDT4MR_D.js","sources":["../../../app/components/DocumentViews.tsx"],"sourcesContent":["import compact from \"lodash/compact\";\nimport sortBy from \"lodash/sortBy\";\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { dateLocale, dateToRelative } from \"@shared/utils/date\";\nimport Document from \"~/models/Document\";\nimport User from \"~/models/User\";\nimport { Avatar, AvatarSize } from \"~/components/Avatar\";\nimport ListItem from \"~/components/List/Item\";\nimport PaginatedList from \"~/components/PaginatedList\";\nimport useCurrentUser from \"~/hooks/useCurrentUser\";\nimport useStores from \"~/hooks/useStores\";\n\ntype Props = {\n  document: Document;\n  isOpen?: boolean;\n};\n\nfunction DocumentViews({ document, isOpen }: Props) {\n  const { t } = useTranslation();\n  const { views, presence } = useStores();\n  const user = useCurrentUser();\n  const locale = dateLocale(user.language);\n\n  const documentPresence = presence.get(document.id);\n  const documentPresenceArray = documentPresence\n    ? Array.from(documentPresence.values())\n    : [];\n  const presentIds = documentPresenceArray.map((p) => p.userId);\n  const editingIds = documentPresenceArray\n    .filter((p) => p.isEditing)\n    .map((p) => p.userId);\n\n  // ensure currently present via websocket are always ordered first\n  const documentViews = views.inDocument(document.id);\n  const sortedViews = sortBy(\n    documentViews,\n    (view) => !presentIds.includes(view.userId)\n  );\n  const users = React.useMemo(\n    () => compact(sortedViews.map((v) => v.user)),\n    [sortedViews]\n  );\n\n  return (\n    <>\n      {isOpen && (\n        <PaginatedList\n          aria-label={t(\"Viewers\")}\n          items={users}\n          renderItem={(model: User) => {\n            const view = documentViews.find((v) => v.userId === model.id);\n            const isPresent = presentIds.includes(model.id);\n            const isEditing = editingIds.includes(model.id);\n            const subtitle = isPresent\n              ? isEditing\n                ? t(\"Currently editing\")\n                : t(\"Currently viewing\")\n              : t(\"Viewed {{ timeAgo }}\", {\n                  timeAgo: dateToRelative(\n                    view ? Date.parse(view.lastViewedAt) : new Date(),\n                    {\n                      addSuffix: true,\n                      locale,\n                    }\n                  ),\n                });\n            return (\n              <ListItem\n                key={model.id}\n                title={model.name}\n                subtitle={subtitle}\n                image={\n                  <Avatar\n                    key={model.id}\n                    model={model}\n                    size={AvatarSize.Large}\n                  />\n                }\n                border={false}\n                small\n              />\n            );\n          }}\n        />\n      )}\n    </>\n  );\n}\n\nexport default observer(DocumentViews);\n"],"names":["observer","DocumentViews","document","isOpen","t","useTranslation","views","presence","useStores","user","useCurrentUser","locale","dateLocale","language","documentPresence","get","id","documentPresenceArray","Array","from","values","presentIds","map","p","userId","editingIds","filter","isEditing","documentViews","inDocument","sortedViews","sortBy","view","includes","users","React","useMemo","compact","v","PaginatedList","items","renderItem","model","find","isPresent","subtitle","timeAgo","dateToRelative","Date","parse","lastViewedAt","addSuffix","jsx","ListItem","title","name","image","Avatar","size","AvatarSize","Large","border","small"],"mappings":"4RA2FA,MAAeA,EAAAA,GAxEf,SAASC,eAAcC,SAAEA,EAAAA,OAAUC,IAC3B,MAAAC,EAAEA,GAAMC,KACRC,MAAEA,EAAAA,SAAOC,GAAaC,IACtBC,EAAOC,IACPC,EAASC,EAAWH,EAAKI,UAEzBC,EAAmBP,EAASQ,IAAIb,EAASc,IACzCC,EAAwBH,EAC1BI,MAAMC,KAAKL,EAAiBM,UAC5B,GACEC,EAAaJ,EAAsBK,KAAKC,GAAMA,EAAEC,SAChDC,EAAaR,EAChBS,QAAcH,GAAAA,EAAEI,YAChBL,KAAWC,GAAAA,EAAEC,SAGVI,EAAgBtB,EAAMuB,WAAW3B,EAASc,IAC1Cc,EAAcC,EAClBH,GACCI,IAAUX,EAAWY,SAASD,EAAKR,UAEhCU,EAAQC,EACZC,SAAA,IAAMC,EAAQP,EAAYR,KAAWgB,GAAAA,EAAE7B,SACvC,CAACqB,IAGH,SAEK3B,EAAAA,CAAAA,SAAAA,KACEoC,EAAA,CACC,aAAYnC,EAAE,WACdoC,MAAON,EACPO,WAAaC,IACLV,MAAAA,EAAOJ,EAAce,SAAYL,EAAEd,SAAWkB,EAAM1B,KACpD4B,EAAYvB,EAAWY,SAASS,EAAM1B,IACtCW,EAAYF,EAAWQ,SAASS,EAAM1B,IACtC6B,EAAWD,EAEXxC,EADFuB,EACI,oBACA,qBACJvB,EAAE,uBAAwB,CACxB0C,QAASC,EACPf,EAAOgB,KAAKC,MAAMjB,EAAKkB,cAAoBF,IAAAA,KAC3C,CACEG,WAAW,EACXxC,aAKR,OAAAyC,EAACC,GAECC,MAAOZ,EAAMa,KACbV,WACAW,MACGJ,EAAAK,EAEC,CAAAf,QACAgB,KAAMC,EAAWC,OAFZlB,EAAM1B,IAKf6C,QAAQ,EACRC,OAAK,GAXApB,EAAM1B,GAYX,KAOhB"}