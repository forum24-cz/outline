import{n as e,d7 as t,j as n,h as r,bt as o,c$ as a,c as i,d8 as s,d9 as c,da as l,db as d,F as u,I as h,a0 as p,C as m,r as g,a as f,X as x,D as v,ah as b,d as w,z as y,T as k,dc as I,B as C,t as R,dd as S,bZ as E,de as M,aN as L,af as A,a2 as B,A as T,L as P,df as D,an as z,cA as $,cy as j,am as N,ak as F,aD as Z,dg as O,e as H,bv as _}from"./index.mlCxaiYE.js";import{af as U,ag as q,ah as V,ai as K,aj as W,P as X,e as Y,V as Q,m as G,aa as J,ak as ee,al as te,am as ne,an as re,ao as oe,ap as ae,aq as ie,ar as se}from"./DocumentContext.hhTeDqBR.js";import{e as ce}from"./Item.dGEOVRdT.js";import{P as le,u as de}from"./Switch.3DOmHSIs.js";import{a as ue}from"./InputSelectPermission.lb2lIKIy.js";import{u as he}from"./PopoverDisclosure.OO70kItq.js";import{L as pe}from"./LoadingIndicatorBar.mGaD64ZX.js";import{A as me,a as ge}from"./TeamLogo.qV1feKYB.js";import{T as fe}from"./Time.rp9cc_zo.js";const xe=e(t).withConfig({componentId:"sc-chkbk0-0"})(["border-radius:2px;background:#fff;box-shadow:0 0 0 1px #fff;margin:4px;width:18px;height:18px;"]);function blockMenuItems(e,t){const a=t.current?.clientWidth??0;return[{name:"heading",title:e.h1,keywords:"h1 heading1 title",icon:n(r.Heading1Icon,{}),shortcut:"^ ⇧ 1",attrs:{level:1}},{name:"heading",title:e.h2,keywords:"h2 heading2",icon:n(r.Heading2Icon,{}),shortcut:"^ ⇧ 2",attrs:{level:2}},{name:"heading",title:e.h3,keywords:"h3 heading3",icon:n(r.Heading3Icon,{}),shortcut:"^ ⇧ 3",attrs:{level:3}},{name:"heading",title:e.h4,keywords:"h4 heading4",icon:n(r.Heading4Icon,{}),shortcut:"^ ⇧ 4",attrs:{level:4}},{name:"separator"},{name:"checkbox_list",title:e.checkboxList,icon:n(r.TodoListIcon,{}),keywords:"checklist checkbox task",shortcut:"^ ⇧ 7"},{name:"bullet_list",title:e.bulletList,icon:n(r.BulletedListIcon,{}),shortcut:"^ ⇧ 8"},{name:"ordered_list",title:e.orderedList,icon:n(r.OrderedListIcon,{}),shortcut:"^ ⇧ 9"},{name:"separator"},{name:"image",title:e.image,icon:n(r.ImageIcon,{}),keywords:"picture photo"},{name:"video",title:e.video,icon:n(r.EmbedIcon,{}),keywords:"mov avi upload player"},{name:"attachment",title:e.file,icon:n(r.AttachmentIcon,{}),keywords:"file upload attach"},{name:"table",title:e.table,icon:n(r.TableIcon,{}),attrs:{rowsCount:3,colsCount:3,colWidth:a/3}},{name:"blockquote",title:e.quote,icon:n(r.BlockQuoteIcon,{}),keywords:"blockquote pullquote",shortcut:`${o} ]`},{name:"code_block",title:e.codeBlock,icon:n(r.CodeIcon,{}),shortcut:"^ ⇧ c",keywords:"script"},{name:"math_block",title:e.mathBlock,icon:n(r.MathIcon,{}),keywords:"math katex latex"},{name:"hr",title:e.hr,icon:n(r.HorizontalRuleIcon,{}),shortcut:`${o} _`,keywords:"horizontal rule break line"},{name:"hr",title:e.pageBreak,icon:n(r.PageBreakIcon,{}),keywords:"page print break line",attrs:{markup:"***"}},{name:"date",title:e.insertDate,keywords:"clock today",icon:n(r.CalendarIcon,{})},{name:"time",title:e.insertTime,keywords:"clock now",icon:n(r.ClockIcon,{})},{name:"datetime",title:e.insertDateTime,keywords:"clock today date",icon:n(r.CalendarIcon,{})},{name:"separator"},{name:"container_notice",title:e.infoNotice,icon:n(r.InfoIcon,{}),keywords:"notice card information",attrs:{style:"info"}},{name:"container_notice",title:e.successNotice,icon:n(r.DoneIcon,{}),keywords:"notice card success",attrs:{style:"success"}},{name:"container_notice",title:e.warningNotice,icon:n(r.WarningIcon,{}),keywords:"notice card error",attrs:{style:"warning"}},{name:"container_notice",title:e.tipNotice,icon:n(r.StarredIcon,{}),keywords:"notice card suggestion",attrs:{style:"tip"}},{name:"separator"},{name:"code_block",title:"Mermaid Diagram",icon:n(xe,{src:"/images/mermaidjs.png",alt:"Mermaid Diagram"}),keywords:"diagram flowchart",attrs:{language:"mermaidjs"}}]}function BlockMenu(e){const t=U(),{elementRef:r}=q();return n(V,{...e,filterable:!0,trigger:"/",renderMenuItem:(e,t,r)=>n(K,{onClick:r.onClick,selected:r.selected,icon:e.icon,title:e.title,shortcut:e.shortcut}),items:blockMenuItems(t,r)})}class BlockMenuExtension extends W{constructor(){super(...arguments),this.handleClose=a((e=>{const{view:t}=this.editor;if(e){const e=t.state.tr.split(t.state.selection.to);t.dispatch(e),t.focus()}this.state.open=!1})),this.widget=({rtl:e})=>{const{props:t}=this.editor;return n(BlockMenu,{rtl:e,trigger:this.options.trigger,isActive:this.state.open,search:this.state.query,onClose:this.handleClose,uploadFile:t.uploadFile,onFileUploadStart:t.onFileUploadStart,onFileUploadStop:t.onFileUploadStop,embeds:t.embeds})}}get defaultOptions(){return{trigger:"/",allowSpaces:!1,requireSearchTerm:!1,enabledInCode:!1}}get name(){return"block-menu"}get plugins(){const e=document.createElement("button");return e.className="block-menu-trigger",e.type="button",i.render(n(r.PlusIcon,{}),e),[...super.plugins,new s({props:{decorations:t=>{const n=c((e=>"paragraph"===e.type.name))(t.selection);if(!n)return;if(!(1===t.selection.$from.depth))return;const r=[],o=n&&0===n.node.content.size,i=n&&"/"===n.node.textContent;if(o){r.push(l.widget(n.pos,(()=>(e.addEventListener("click",a((()=>{this.state.open=!0}))),e)),{key:"block-trigger"}));""===t.doc.textContent||r.push(l.node(n.pos,n.pos+n.node.nodeSize,{class:"placeholder","data-empty-text":this.options.dictionary.newLineEmpty}))}else i&&r.push(l.node(n.pos,n.pos+n.node.nodeSize,{class:"placeholder","data-empty-text":`  ${this.options.dictionary.newLineWithSlash}`}));return d.create(t.doc,r)}}})]}}function FindAndReplace({readOnly:e,open:t,onOpen:a,onClose:i,currentIndex:s,totalResults:c}){const l=q(),d=g.useRef(l.view.dom.parentElement),h=g.useRef(),p=g.useRef(null),m=g.useRef(null),{t:S}=f(),E=x(),[M,L]=g.useState(!1),[A,B]=g.useState(!1),[T,P]=g.useState(!1),[D,z]=g.useState(""),[$,j]=g.useState(""),N=he(),{show:F}=N;g.useEffect((()=>{t&&F()}),[t]),g.useEffect((()=>{v.bridge&&("onFindInPage"in v.bridge&&v.bridge.onFindInPage((()=>{h.current=window.getSelection()?.toString(),F()})),"onReplaceInPage"in v.bridge&&v.bridge.onReplaceInPage((()=>{L(!0),F()})))}),[F]);const Z=g.useCallback((()=>{p.current?.focus(),p.current?.setSelectionRange(0,p.current?.value.length)}),[]),O=g.useCallback((()=>{setTimeout((()=>{m.current?.focus(),m.current?.setSelectionRange(0,m.current?.value.length)}),100)}),[]),H=g.useCallback((({withReplace:t})=>{const n=!e&&t;N.visible?n?(L(!0),O()):Z():(h.current=window.getSelection()?.toString(),N.show(),n&&L(!0))}),[N,e,Z,O]),_=g.useCallback((()=>{L((e=>!e)),setTimeout((()=>m.current?.focus()),100)}),[]),U=g.useCallback((()=>{B((e=>{const t=!e;return l.commands.find({text:D,caseSensitive:t,regexEnabled:T}),t}))}),[T,l.commands,D]),V=g.useCallback((()=>{P((e=>{const t=!e;return l.commands.find({text:D,caseSensitive:A,regexEnabled:t}),t}))}),[A,l.commands,D]),K=g.useCallback((e=>{function nextPrevious(){e.shiftKey?l.commands.prevSearchMatch():l.commands.nextSearchMatch()}switch(e.key){case"Enter":return e.preventDefault(),void nextPrevious();case"g":return void(e.metaKey&&(e.preventDefault(),nextPrevious(),Z()));case"F3":return e.preventDefault(),nextPrevious(),void Z()}}),[l.commands,Z]),W=g.useCallback((t=>{e||(t.preventDefault(),l.commands.replace({text:$}))}),[l.commands,e,$]),Q=g.useCallback((t=>{e||(t.preventDefault(),l.commands.replaceAll({text:$}))}),[l.commands,e,$]),G=g.useCallback((e=>{e.preventDefault(),e.stopPropagation(),z(e.currentTarget.value),l.commands.find({text:e.currentTarget.value,caseSensitive:A,regexEnabled:T})}),[A,l.commands,T]),J=g.useCallback((e=>{"Enter"===e.key&&(e.preventDefault(),W(e))}),[W]);ue(N.unstable_referenceRef,N.hide),function useKeyboardShortcuts({popover:e,handleOpen:t,handleCaseSensitive:n,handleRegex:r}){de((e=>R(e)&&"KeyF"===e.code&&!(v.bridge&&"onFindInPage"in v.bridge)),(e=>{e.preventDefault(),t({withReplace:e.altKey})}),{allowInInput:!0}),de((t=>R(t)&&t.altKey&&"KeyC"===t.code&&e.visible),(e=>{e.preventDefault(),n()}),{allowInInput:!0}),de((t=>R(t)&&t.altKey&&"KeyR"===t.code&&e.visible),(e=>{e.preventDefault(),r()}),{allowInInput:!0})}({popover:N,handleOpen:H,handleCaseSensitive:U,handleRegex:V});const ee=g.useMemo((()=>({position:"fixed",left:"initial",top:60,right:16,zIndex:b.popover})),[]);g.useEffect((()=>{if(N.visible){a();const e=h.current||D;l.commands.find({text:e,caseSensitive:A,regexEnabled:T}),requestAnimationFrame((()=>{p.current?.setSelectionRange(0,e.length)})),h.current&&z(h.current)}else i(),L(!1),l.commands.clearSearch()}),[N.visible]);const te=0===c,ne=w(y,{children:[n(k,{content:S("Previous match"),shortcut:"Shift+Enter",placement:"bottom",children:n(ye,{disabled:te,onClick:()=>l.commands.prevSearchMatch(),children:n(r.CaretUpIcon,{})})}),n(k,{content:S("Next match"),shortcut:"Enter",placement:"bottom",children:n(ye,{disabled:te,onClick:()=>l.commands.nextSearchMatch(),children:n(r.CaretDownIcon,{})})})]});return n(X,{children:n(le,{...N,unstable_finalFocusRef:d,style:ee,"aria-label":S("Find and replace"),scrollable:!1,minWidth:420,width:0,children:w(ke,{column:!0,children:[w(u,{gap:4,children:[n(be,{ref:p,maxLength:255,value:D,placeholder:`${S("Find")}…`,onChange:G,onKeyDown:K,children:w(ve,{gap:8,children:[n(k,{content:S("Match case"),shortcut:`${I}+${o}+c`,placement:"bottom",children:n(we,{onClick:U,children:n(r.CaseSensitiveIcon,{color:A?E.accent:E.textSecondary})})}),n(k,{content:S("Enable regex"),shortcut:`${I}+${o}+r`,placement:"bottom",children:n(we,{onClick:V,children:n(r.RegexIcon,{color:T?E.accent:E.textSecondary})})})]})}),ne,!e&&n(k,{content:S("Replace options"),shortcut:`${I}+${o}+f`,placement:"bottom",children:n(ye,{onClick:_,children:n(r.ReplaceIcon,{color:E.textSecondary})})}),w(Ie,{children:[c>0?s+1:0," / ",c]})]}),n(Y,{children:M&&!e&&w(u,{gap:8,children:[n(be,{maxLength:255,value:$,ref:m,placeholder:S("Replacement"),onKeyDown:J,onRequestSubmit:Q,onChange:e=>j(e.currentTarget.value)}),n(k,{content:S("Replace"),shortcut:"Enter",placement:"bottom",children:n(C,{onClick:W,disabled:te,neutral:!0,children:S("Replace")})}),n(k,{content:S("Replace all"),shortcut:`${o}+Enter`,placement:"bottom",children:n(C,{onClick:Q,disabled:te,neutral:!0,children:S("Replace all")})})]})})]})})})}const ve=e(u).withConfig({componentId:"sc-nb5ffj-0"})(["margin-right:4px;"]),be=e(h).withConfig({componentId:"sc-nb5ffj-1"})(["width:196px;flex:1;"]),we=e(p).withConfig({componentId:"sc-nb5ffj-2"})(['&:hover,&[aria-expanded="true"]{background:',";}&:disabled{color:",";background:none;cursor:default;}"],m("sidebarControlHoverBackground"),m("textTertiary")),ye=e(we).withConfig({componentId:"sc-nb5ffj-3"})(["width:32px;height:32px;"]),ke=e(u).withConfig({componentId:"sc-nb5ffj-4"})(["padding:8px 0;margin-bottom:-16px;position:static;"]),Ie=e.span.withConfig({componentId:"sc-nb5ffj-5"})(["color:",";font-size:12px;font-weight:500;font-variant-numeric:tabular-nums;line-height:32px;min-width:32px;letter-spacing:-0.5px;text-align:right;user-select:none;"],m("textSecondary"));var Ce=Object.defineProperty,Re=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,n,r)=>{for(var o,a=r>1?void 0:r?Re(t,n):t,i=e.length-1;i>=0;i--)(o=e[i])&&(a=(r?o(t,n,a):o(a))||a);return r&&a&&Ce(t,n,a),a};const Se=new S("find-and-replace");class FindAndReplaceExtension extends M{constructor(){super(...arguments),this.widget=({readOnly:e})=>n(FindAndReplace,{currentIndex:this.currentResultIndex,totalResults:this.results.length,readOnly:e,open:this.open,onOpen:()=>{this.open=!0},onClose:()=>{this.open=!1}}),this.open=!1,this.results=[],this.currentResultIndex=0,this.searchTerm=""}get name(){return"find-and-replace"}get defaultOptions(){return{resultClassName:"find-result",resultCurrentClassName:"current-result",caseSensitive:!1,regexEnabled:!1}}commands(){return{find:e=>this.find(e.text,e.caseSensitive,e.regexEnabled),nextSearchMatch:()=>this.goToMatch(1),prevSearchMatch:()=>this.goToMatch(-1),replace:e=>this.replace(e.text),replaceAll:e=>this.replaceAll(e.text),clearSearch:()=>this.clear(),openFindAndReplace:()=>this.openFindAndReplace()}}get decorations(){return this.results.map(((e,t)=>("node"===e.type?l.node:l.inline)(e.from,e.to,{class:this.options.resultClassName+(this.currentResultIndex===t?` ${this.options.resultCurrentClassName}`:"")})))}replace(e){return(t,n)=>{this.search(t.doc);const r=this.results[this.currentResultIndex];if(!r)return!1;const{from:o,to:a}=r;return n?.(t.tr.insertText(e,o,a).setMeta(Se,{})),!0}}replaceAll(e){return(t,n)=>{this.search(t.doc);const r=t.tr;let o;return!!this.results.length&&(this.results.forEach((({from:t,to:n},a)=>{r.insertText(e,t,n),o=this.rebaseNextResult(e,a,o)})),n?.(r),!0)}}find(e,t=this.options.caseSensitive,n=this.options.regexEnabled){return(r,o)=>(this.options.caseSensitive=t,this.options.regexEnabled=n,this.searchTerm=n?e:L(e),this.currentResultIndex=0,o?.(r.tr.setMeta(Se,{})),!0)}clear(){return(e,t)=>(this.searchTerm="",this.currentResultIndex=0,t?.(e.tr.setMeta(Se,{})),!0)}openFindAndReplace(){return(e,t)=>(t?.(e.tr.setMeta(Se,{open:!0})),!0)}get findRegExp(){return RegExp(this.searchTerm.replace(/\\+$/,""),this.options.caseSensitive?"gu":"gui")}goToMatch(e){return(t,n)=>{e>0?this.currentResultIndex>=this.results.length-1?this.currentResultIndex=0:this.currentResultIndex+=1:0===this.currentResultIndex?this.currentResultIndex=this.results.length-1:this.currentResultIndex-=1,n?.(t.tr.setMeta(Se,{}));const r=window.document.querySelector(`.${this.options.resultCurrentClassName}`);return r&&ce(r,{scrollMode:"if-needed",block:"center"}),!0}}rebaseNextResult(e,t,n=0){const r=t+1;if(!this.results[r])return;const{from:o,to:a}=this.results[t],i=a-o-e.length+n,{from:s,to:c,type:l}=this.results[r];return this.results[r]={to:c-i,from:s-i,type:l},i}search(e){this.results=[];const t=[];let n=0;this.searchTerm&&(e.descendants(((e,r)=>{e.isText?t[n]?t[n]={type:"inline",text:t[n].text+(e.text??""),pos:t[n].pos}:t[n]={type:"inline",text:e.text,pos:r}:"mention"===e.type.name?(t[++n]={type:"node",nodeSize:e.nodeSize,text:e.attrs.label,pos:r},++n):++n})),t.forEach((e=>{const{text:t="",pos:n,type:r}=e;try{let o;const a=this.findRegExp;for(;(o=a.exec(A(t)+t))&&""!==o[0];){const a=o.index>=t.length?o.index-t.length:o.index,i="inline"===r?n+a:n,s=i+("inline"===r?o[0].length:e.nodeSize);this.results.some((e=>e.from===i&&e.to===s))||this.results.push({from:i,to:s,type:r})}}catch(o){}})))}createDeco(e){return this.search(e),this.decorations?d.create(e,this.decorations):d.empty}get allowInReadOnly(){return!0}get focusAfterExecution(){return!1}get plugins(){return[new s({key:Se,state:{init:()=>d.empty,apply:(e,t)=>{const n=e.getMeta(Se);return n?(n.open&&(this.open=!0),this.createDeco(e.doc)):e.docChanged?t.map(e.mapping,e.doc):t}},props:{decorations(e){return this.getState(e)}}})]}}__decorateClass([E],FindAndReplaceExtension.prototype,"open",2),__decorateClass([E],FindAndReplaceExtension.prototype,"results",2),__decorateClass([E],FindAndReplaceExtension.prototype,"currentResultIndex",2);const Ee=10,Me=B(["--line-height:1.6em;"]),Le=e(T).withConfig({componentId:"sc-a7xaov-0"})(["margin-bottom:0;"]),Ae=e(P).withConfig({componentId:"sc-a7xaov-1"})(["cursor:",";border-radius:4px;box-shadow:0 30px 90px -20px rgba(0,0,0,0.3),0 0 1px 1px rgba(0,0,0,0.05);overflow:hidden;position:absolute;width:375px;"],(e=>"div"===e.as?"default":"var(--pointer)")),Be=e(T).attrs({as:"h2",size:"large"}).withConfig({componentId:"sc-a7xaov-2"})(["margin-bottom:4px;display:flex;align-items:flex-start;justify-content:flex-start;gap:4px;"]),Te=e(Le).attrs((()=>({type:"tertiary",size:"xsmall"}))).withConfig({componentId:"sc-a7xaov-3"})(["white-space:nowrap;"]),Pe=e(Le).withConfig({componentId:"sc-a7xaov-4"})([""," margin-top:0.5em;line-height:var(--line-height);max-height:calc(var(--line-height) * ",");overflow:hidden;"],Me,10),De=e.img.withConfig({componentId:"sc-a7xaov-5"})(["object-fit:cover;height:200px;background:",";"],m("menuBackground")),ze=e(T).attrs({size:"xsmall",weight:"bold"}).withConfig({componentId:"sc-a7xaov-6"})(["background-color:",";color:",";width:fit-content;border-radius:2em;padding:0 8px;margin-right:0.5em;margin-top:0.5em;"],(e=>e.color??e.theme.backgroundSecondary),(e=>e.color?D(e.color):e.theme.text)),$e=e.div.withConfig({componentId:"sc-a7xaov-7"})(["overflow:hidden;user-select:none;"]),je=e.div.withConfig({componentId:"sc-a7xaov-8"})(["backdrop-filter:blur(10px);background:",';padding:16px;font-size:0.9em;position:relative;.placeholder,.heading-anchor{display:none;}&::before{content:"";position:absolute;top:-10px;left:0;right:0;height:10px;}',""],m("menuBackground"),(e=>!1!==e.fadeOut?`&:after {\n          ${Me}\n          content: "";\n          display: block;\n          position: absolute;\n          pointer-events: none;\n          background: linear-gradient(\n            90deg,\n            ${z(1,e.theme.menuBackground)} 0%,\n            ${z(1,e.theme.menuBackground)} 75%,\n            ${e.theme.menuBackground} 90%\n          );\n          bottom: 0;\n          left: 0;\n          right: 0;\n          height: var(--line-height);\n          border-bottom: 16px solid ${e.theme.menuBackground};\n          border-bottom-left-radius: 4px;\n          border-bottom-right-radius: 4px;\n        }`:"")),Ne=g.forwardRef((function _HoverPreviewDocument({url:e,id:t,title:r,summary:o,lastActivityByViewer:a},i){return n(Ae,{to:e,children:n(je,{ref:i,children:n($e,{children:n($,{showTitle:!1,reloadOnChunkMissing:!1,children:w(u,{column:!0,gap:2,children:[n(Be,{children:r}),n(Te,{children:a}),n(Pe,{as:"div",children:n(g.Suspense,{fallback:n("div",{}),children:n(Q,{extensions:j,defaultValue:o,embedsDisabled:!0,readOnly:!0},t)})})]})})})})})}));function IssueStatusIcon({size:e,...t}){return n(Fe,{size:e,children:n(BaseIcon$1,{...t})})}const Fe=e.span.withConfig({componentId:"sc-1kzjz2j-0"})(["display:inline-flex;flex-shrink:0;width:","px;height:","px;align-items:center;justify-content:center;"],(e=>e.size??24),(e=>e.size??24));function BaseIcon$1(e){switch(e.status){case"open":return w("svg",{viewBox:"0 0 16 16",width:"16",height:"16",fill:e.color,className:e.className,children:[n("path",{d:"M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"}),n("path",{d:"M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"})]});case"closed":return w("svg",{viewBox:"0 0 16 16",width:"16",height:"16",fill:e.color,className:e.className,children:[n("path",{d:"M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z"}),n("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z"})]});case"canceled":return n("svg",{viewBox:"0 0 16 16",width:"16",height:"16",fill:e.color,className:e.className,children:n("path",{d:"M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm9.78-2.22-5.5 5.5a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l5.5-5.5a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Z"})});default:return null}}const Ze=g.forwardRef((function _HoverPreviewIssue({url:e,id:t,title:r,description:o,author:a,labels:i,state:s,createdAt:c},l){const d=a.name;return n(Ae,{as:"a",href:e,target:"_blank",rel:"noopener noreferrer",children:n(u,{column:!0,ref:l,children:n(je,{fadeOut:!1,children:n($e,{children:w(u,{gap:2,column:!0,children:[w(Be,{children:[n(IssueStatusIcon,{status:s.name,color:s.color}),w("span",{children:[r," ",n(T,{type:"tertiary",children:t})]})]}),w(u,{align:"center",gap:4,children:[n(me,{src:a.avatarUrl}),n(Te,{children:w(N,{children:[{authorName:d}," created"," ",n(fe,{dateTime:c,addSuffix:!0})]})})]}),n(Pe,{children:o}),n(u,{wrap:!0,children:i.map(((e,t)=>n(ze,{color:e.color,children:e.name},t)))})]})})})})})})),Oe=g.forwardRef((function _HoverPreviewLink({url:e,thumbnailUrl:t,title:r,description:o},a){return n(Ae,{as:"a",href:e,target:"_blank",rel:"noopener noreferrer",children:w(u,{column:!0,ref:a,children:[t?n(De,{src:t,alt:""}):null,n(je,{children:n($e,{children:w(u,{column:!0,children:[n(Be,{children:r}),n(Pe,{children:o})]})})})]})})})),He=g.forwardRef((function _HoverPreviewMention({avatarUrl:e,name:t,lastActive:r,color:o,email:a},i){return n(Ae,{as:"div",children:n(je,{fadeOut:!1,ref:i,children:n($e,{children:w(u,{gap:12,children:[n(me,{model:{avatarUrl:e,initial:t?t[0]:"?",color:o},size:ge.XLarge}),w(u,{column:!0,gap:2,justify:"center",children:[n(Be,{children:t}),a&&n(Te,{children:a}),n(Te,{children:r})]})]})})})})}));function PullRequestIcon({size:e,...t}){return n(_e,{size:e,children:n(BaseIcon,{...t})})}const _e=e.span.withConfig({componentId:"sc-1v1c3hq-0"})(["display:inline-flex;flex-shrink:0;width:","px;height:","px;align-items:center;justify-content:center;"],(e=>e.size??24),(e=>e.size??24));function BaseIcon(e){switch(e.status){case"open":return n("svg",{viewBox:"0 0 16 16",width:"16",height:"16",fill:e.color,className:e.className,children:n("path",{d:"M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z"})});case"merged":return n("svg",{viewBox:"0 0 16 16",width:"16",height:"16",fill:e.color,className:e.className,children:n("path",{d:"M5.45 5.154A4.25 4.25 0 0 0 9.25 7.5h1.378a2.251 2.251 0 1 1 0 1.5H9.25A5.734 5.734 0 0 1 5 7.123v3.505a2.25 2.25 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.95-.218ZM4.25 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm8.5-4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM5 3.25a.75.75 0 1 0 0 .005V3.25Z"})});case"closed":return n("svg",{viewBox:"0 0 16 16",width:"16",height:"16",fill:e.color,className:e.className,children:n("path",{d:"M3.25 1A2.25 2.25 0 0 1 4 5.372v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.251 2.251 0 0 1 3.25 1Zm9.5 5.5a.75.75 0 0 1 .75.75v3.378a2.251 2.251 0 1 1-1.5 0V7.25a.75.75 0 0 1 .75-.75Zm-2.03-5.273a.75.75 0 0 1 1.06 0l.97.97.97-.97a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.97.97.97.97a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-.97-.97-.97.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l.97-.97-.97-.97a.75.75 0 0 1 0-1.06ZM2.5 3.25a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0ZM3.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm9.5 0a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z"})});default:return null}}const Ue=g.forwardRef((function _HoverPreviewPullRequest({url:e,title:t,id:r,description:o,author:a,state:i,createdAt:s},c){const l=a.name;return n(Ae,{as:"a",href:e,target:"_blank",rel:"noopener noreferrer",children:n(u,{column:!0,ref:c,children:n(je,{fadeOut:!1,children:n($e,{children:w(u,{gap:2,column:!0,children:[w(Be,{children:[n(PullRequestIcon,{status:i.name,color:i.color}),w("span",{children:[t," ",n(T,{type:"tertiary",children:r})]})]}),w(u,{align:"center",gap:4,children:[n(me,{src:a.avatarUrl}),n(Te,{children:w(N,{children:[{authorName:l}," opened"," ",n(fe,{dateTime:s,addSuffix:!0})]})})]}),n(Pe,{children:o})]})})})})})}));function HoverPreviewDesktop({element:e,data:t,dataLoading:r,onClose:o}){const[a,i]=g.useState(!1),s=g.useRef(),c=g.useRef(null),{cardLeft:l,cardTop:d,pointerLeft:u,pointerTop:h,pointerDir:p}=function useHoverPosition({cardRef:e,element:t,isVisible:n}){const[r,o]=g.useState(0),[a,i]=g.useState(0),[s,c]=g.useState(0),[l,d]=g.useState(0),[u,h]=g.useState(0);return g.useLayoutEffect((()=>{if(n&&t&&e.current){const n=t.getBoundingClientRect(),r=e.current.getBoundingClientRect();let a=n.bottom+window.scrollY+Ee,s=-22,l=0;if(a+r.height>window.innerHeight+window.scrollY){a=n.top+window.scrollY-r.height,a-=Ee,s=r.height,l=1}i(a),d(s),h(l);let u=n.left,p=n.width/2;if(u+r.width>window.innerWidth){let e=u+r.width-window.innerWidth;e+=Ee,u-=e,p+=e}o(u),c(p)}}),[n,e,t]),{cardLeft:r,cardTop:a,pointerLeft:s,pointerTop:l,pointerDir:u}}({cardRef:c,element:e,isVisible:a}),m=g.useCallback((()=>{i(!1),o()}),[o]),f=g.useCallback((()=>{s.current&&(clearTimeout(s.current),s.current=void 0)}),[]),x=g.useCallback((()=>{s.current=setTimeout(m,500)}),[m]);return g.useEffect((()=>{e&&t&&!r?i(!0):x()}),[x,e,t,r]),ue(c,m),de("Escape",m),Z("scroll",m,window,{capture:!0}),g.useEffect((()=>{const e=c.current;return a&&e&&(e.addEventListener("mouseenter",f),e.addEventListener("mouseleave",x)),()=>{e&&(e.removeEventListener("mouseenter",f),e.removeEventListener("mouseleave",x)),f()}}),[e,x,a,f]),r?n(pe,{}):t?n(J,{children:n(Ve,{top:d,left:l,"aria-hidden":!0,children:a?w(qe,{initial:{opacity:0,y:-20,pointerEvents:"none"},animate:{opacity:1,y:0,transitionEnd:{pointerEvents:"auto"}},children:[t.type===O.Mention?n(He,{ref:c,name:t.name,avatarUrl:t.avatarUrl,color:t.color,lastActive:t.lastActive,email:t.email}):t.type===O.Document?n(Ne,{ref:c,url:t.url,id:t.id,title:t.title,summary:t.summary,lastActivityByViewer:t.lastActivityByViewer}):t.type===O.Issue?n(Ze,{ref:c,url:t.url,id:t.id,title:t.title,description:t.description,author:t.author,labels:t.labels,state:t.state,createdAt:t.createdAt}):t.type===O.PR?n(Ue,{ref:c,url:t.url,id:t.id,title:t.title,description:t.description,author:t.author,createdAt:t.createdAt,state:t.state}):n(Oe,{ref:c,url:t.url,thumbnailUrl:t.thumbnailUrl,title:t.title,description:t.description}),n(Ke,{top:h,left:u,direction:p})]}):null})}):null}function HoverPreview({element:e,data:t,dataLoading:r,...o}){return F()?null:n(HoverPreviewDesktop,{...o,element:e,data:t,dataLoading:r})}const qe=e(G.div).withConfig({componentId:"sc-1ofxzr1-0"})(["@media print{display:none;}"]),Ve=e.div.withConfig({componentId:"sc-1ofxzr1-1"})(["position:",";z-index:",";display:flex;max-height:75%;",";",";"],(({fixed:e})=>e?"fixed":"absolute"),b.hoverPreview,(({top:e})=>void 0!==e?`top: ${e}px`:""),(({left:e})=>void 0!==e?`left: ${e}px`:"")),Ke=e.div.withConfig({componentId:"sc-1ofxzr1-2"})(["top:","px;left:","px;width:","px;height:",'px;position:absolute;transform:translateX(-50%);pointer-events:none;&:before,&:after{content:"";display:inline-block;position:absolute;',";",";}&:before{border:8px solid transparent;",";",";}&:after{border:7px solid transparent;",";}"],(e=>e.top),(e=>e.left),22,22,(({direction:e})=>0===e?"bottom: 0":"top: 0"),(({direction:e})=>0===e?"right: 0":"left: 0"),(({direction:e,theme:t})=>0===e?`border-bottom-color: ${t.menuBorder||"rgba(0, 0, 0, 0.1)"}`:`border-top-color: ${t.menuBorder||"rgba(0, 0, 0, 0.1)"}`),(({direction:e})=>0===e?"right: -1px":"left: -1px"),(({direction:e,theme:t})=>0===e?`border-bottom-color: ${t.menuBackground}`:`border-top-color: ${t.menuBackground}`));class HoverPreviews extends M{constructor(){super(...arguments),this.state=E({activeLinkElement:null,data:null,dataLoading:!1}),this.widget=()=>n(HoverPreview,{element:this.state.activeLinkElement,data:this.state.data,dataLoading:this.state.dataLoading,onClose:a((()=>{this.state.activeLinkElement=null}))})}get defaultOptions(){return{delay:600}}get name(){return"hover-previews"}get plugins(){const isHoverTarget=(e,t)=>e instanceof HTMLElement&&this.editor.elementRef.current?.contains(e)&&(!t.editable||t.editable&&!t.hasFocus());let e;return[new s({props:{handleDOMEvents:{mouseover:(t,n)=>{const r=n.target?.closest(".use-hover-preview");return isHoverTarget(r,t)&&(e=setTimeout(a((async()=>{const e=r,t=e?.getAttribute("href")||e?.dataset.url,n=ee(window.location.pathname);if(t){this.state.dataLoading=!0;try{const r=await _.post("/urls.unfurl",{url:t.startsWith("/")?H.URL+t:t,documentId:n});this.state.activeLinkElement=e,this.state.data=r}catch(o){this.state.activeLinkElement=null}finally{this.state.dataLoading=!1}}})),this.options.delay)),!1},mouseout:a(((t,n)=>{const r=n.target?.closest(".use-hover-preview");return isHoverTarget(r,t)&&(clearTimeout(e),this.state.activeLinkElement=null),!1}))}}})]}}const withUIExtensions=e=>[...e,te,ne,re,BlockMenuExtension,oe,ae,FindAndReplaceExtension,HoverPreviews,ie,se];export{withUIExtensions as w};
