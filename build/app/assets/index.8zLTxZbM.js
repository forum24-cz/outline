import{a as e,r as t,n,I as i,j as o,d as a,z as r,h as c,D as s,bv as l,aq as d,ax as u,e as h,w as m,am as g,o as p,k as f,u as w,aQ as y,bH as k,aU as v,bW as b,bX as C,R as x,bs as I,aJ as j,H as P,F as S,as as E,L,C as q,aI as B,aj as T,A}from"./index.mlCxaiYE.js";import{T as N,a as O}from"./TeamLogo.qV1feKYB.js";import{g as z,B as D,n as U}from"./urls.doI9odX4.js";import{c as R,d as X}from"./language.6NyDJHi_.js";import{O as F}from"./OutlineIcon.Lni4fHNe.js";import{L as W}from"./LoadingIndicatorBar.mGaD64ZX.js";import{u as G}from"./useCurrentUser.zlImhYTS.js";import{P as Y}from"./PluginIcon.pb6swma8.js";import{N as $}from"./Notice.4wB6_cwE.js";import"./useBoolean.4JQO1FDN.js";function ChangeLanguage({locale:n}){const{i18n:i}=e();return t.useEffect((()=>{R(n,i)}),[n,i]),null}const M=n(i).withConfig({componentId:"sc-3240uo-0"})(["height:38px;flex-grow:1;margin-right:8px;input{height:38px;}"]);function AuthenticationProvider(n){const{t:i}=e(),[d,u]=t.useState(!1),[h,m]=t.useState(!1),[g,p]=t.useState(""),{isCreate:f,id:w,name:y,authUrl:k,onEmailSuccess:v,...b}=n,handleChangeEmail=e=>{p(e.target.value)},handleSubmitEmail=async e=>{if(e.preventDefault(),d&&g){m(!0);try{const t=await l.post(e.currentTarget.action,{email:g,client:s.isElectron()?"desktop":void 0});t.redirect?window.location.href=t.redirect:v(g)}finally{m(!1)}}else u(!0)},C=z(k);return"email"===w?f?null:o(Q,{children:o(_,{method:"POST",action:"/auth/email",onSubmit:handleSubmitEmail,children:d?a(r,{children:[o(M,{type:"email",name:"email",placeholder:"me@domain.com",value:g,onChange:handleChangeEmail,disabled:h,autoFocus:!0,required:!0,short:!0}),a(D,{type:"submit",disabled:h,...b,children:[i("Sign In")," →"]})]}):o(D,{type:"submit",icon:o(c.EmailIcon,{}),fullwidth:!0,...b,children:i("Continue with Email")})})}):o(D,{onClick:()=>window.location.href=C,icon:o(Y,{id:w}),fullwidth:!0,...b,children:i("Continue with {{ authProviderName }}",{authProviderName:y})})}const Q=n.div.withConfig({componentId:"sc-18j8p9g-0"})(["width:100%;"]),_=n.form.withConfig({componentId:"sc-18j8p9g-1"})(["width:100%;display:flex;justify-content:space-between;"]);function BackButton({config:t}){const{t:n}=e(),i=!!t?.hostname;return!d||u(window.location.origin).custom||s.isElectron()&&!i?null:a(H,{href:i?h.URL:"https://www.getoutline.com",children:[o(c.BackIcon,{})," ",s.isElectron()?n("Back"):n("Back to home")]})}const H=n.a.withConfig({componentId:"sc-1njf7d1-0"})(["display:flex;align-items:center;color:inherit;padding:",";font-weight:500;position:absolute;svg{transition:transform 100ms ease-in-out;}&:hover{svg{transform:translateX(-4px);}}"],s.isElectron()?"48px 32px":"32px");function Message({notice:e}){switch(e){case"domain-not-allowed":return o(g,{children:"The domain associated with your email address has not been allowed for this workspace."});case"domain-required":return a(g,{children:["Unable to sign-in. Please navigate to your workspace's custom URL, then try to sign-in again.",o("hr",{}),"If you were invited to a workspace, you will find a link to it in the invite email."]});case"gmail-account-creation":return a(g,{children:["Sorry, a new account cannot be created with a personal Gmail address.",o("hr",{}),"Please use a Google Workspaces account instead."]});case"pending-deletion":return o(g,{children:"The workspace associated with your user is scheduled for deletion and cannot be accessed at this time."});case"maximum-reached":return o(g,{children:"The workspace you authenticated with is not authorized on this installation. Try another?"});case"malformed-user-info":return o(g,{children:"We could not read the user info supplied by your identity provider."});case"email-auth-required":return o(g,{children:"Your account uses email sign-in, please sign-in with email to continue."});case"email-auth-ratelimit":return o(g,{children:"An email sign-in link was recently sent, please check your inbox or try again in a few minutes."});case"auth-error":case"state-mismatch":return o(g,{children:"Authentication failed – we were unable to sign you in at this time. Please try again."});case"invalid-authentication":return o(g,{children:"Authentication failed – you do not have permission to access this workspace."});case"expired-token":return o(g,{children:"Sorry, it looks like that sign-in link is no longer valid, please try requesting another."});case"user-suspended":return o(g,{children:"Your account has been suspended. To re-activate your account, please contact a workspace admin."});case"team-suspended":return o(g,{children:"This workspace has been suspended. Please contact support to restore access."});case"authentication-provider-disabled":return o(g,{children:"Authentication failed – this login method was disabled by a workspace admin."});case"invite-required":return a(g,{children:["The workspace you are trying to join requires an invite before you can create an account.",o("hr",{}),"Please request an invite from your workspace admin and try again."]});default:return o(g,{children:"Sorry, an unknown error occurred."})}}function Notices(){const e=m().get("notice");return e?o($,{icon:o(c.WarningIcon,{color:"currentcolor"}),children:o(Message,{notice:e})}):null}const J=n(P).withConfig({componentId:"sc-kooqv7-0"})(["margin:0;"]),V=n.div.withConfig({componentId:"sc-kooqv7-1"})(["color:",";padding:0 8px 0 0;"],q("textSecondary")),K=n(c.EmailIcon).withConfig({componentId:"sc-kooqv7-2"})(["margin-bottom:-1.5em;"]),Z=n(B).withConfig({componentId:"sc-kooqv7-3"})(["width:100vw;height:100%;background:",";display:flex;",""],q("background"),T()),ee=n.div.withConfig({componentId:"sc-kooqv7-4"})(["margin-bottom:-4px;"]),te=n(A).withConfig({componentId:"sc-kooqv7-5"})(["color:",";text-align:center;margin-top:-8px;"],q("textSecondary")),ne=n(A).withConfig({componentId:"sc-kooqv7-6"})(["color:",";text-align:center;font-size:14px;margin-top:8px;em{font-style:normal;font-weight:500;}"],q("textTertiary")),ie=n.hr.withConfig({componentId:"sc-kooqv7-7"})(["margin:1em 0;position:relative;width:100%;border:0;border-top:1px solid ",";&:after{content:attr(data-text);display:block;position:absolute;left:50%;transform:translate3d(-50%,-50%,0);text-transform:uppercase;font-size:11px;font-weight:500;color:",";background:",";border-radius:2px;padding:0 4px;}"],q("divider"),q("textTertiary"),q("background")),oe=n(S).withConfig({componentId:"sc-kooqv7-8"})(["user-select:none;width:90vw;height:100%;max-width:320px;margin:0 auto;"]),ae=p((function Login({children:n}){const c=f(),l=m(),p=l.get("notice"),{t:q}=e(),B=G({rejectOnEmpty:!1}),{auth:T}=w(),{config:A}=T,[R,Y]=t.useState(null),[$,M]=t.useState(""),Q="/create"===c.pathname,_=!!B?.getPreference(y.RememberLastPath),[H]=k(),[ae]=v(),re=t.useCallback((()=>{M("")}),[]),ce=t.useCallback((e=>{M(e)}),[]),se=t.useCallback((async e=>{e.preventDefault();const t=Object.fromEntries(new FormData(e.target));await U(t.subdomain.toString())}),[]);if(t.useEffect((()=>{T.fetchConfig().catch(Y)}),[T]),t.useEffect((()=>{const e=Object.fromEntries(l.entries()),t=b("signupQueryParams");!Object.keys(e).length||l.get("notice")||t||C("signupQueryParams",JSON.stringify(e))}),[l]),T.authenticated){const e=ae();return e?o(x,{to:e}):_&&H!==c.pathname?o(x,{to:H}):T.team?.defaultCollectionId?o(x,{to:`/collection/${T.team?.defaultCollectionId}`}):o(x,{to:I()})}if(R)return a(Z,{children:[o(BackButton,{}),o(ChangeLanguage,{locale:X()}),a(oe,{align:"center",justify:"center",column:!0,auto:!0,children:[o(j,{title:q("Login")}),o(P,{centered:!0,children:q("Error")}),a(ne,{children:[q("Failed to load configuration."),!d&&o("p",{children:q("Check the network requests and server logs for full details of the error.")})]})]})]});if(!A)return o(W,{});const le=u(window.location.origin).custom;if(d&&le&&!A.name)return a(Z,{children:[o(BackButton,{config:A}),o(ChangeLanguage,{locale:X()}),a(oe,{align:"center",justify:"center",column:!0,auto:!0,children:[o(j,{title:q("Custom domain setup")}),a(P,{centered:!0,children:[q("Almost there"),"…"]}),o(ne,{children:q("Your custom domain is successfully pointing at Outline. To complete the setup process please contact support.")})]})]});if(s.isElectron()&&"domain-required"===p)return a(Z,{children:[o(BackButton,{config:A}),o(ChangeLanguage,{locale:X()}),a(oe,{as:"form",onSubmit:se,align:"center",justify:"center",column:!0,auto:!0,children:[o(P,{centered:!0,children:q("Choose workspace")}),a(ne,{children:[q("This login method requires choosing your workspace to continue"),"…"]}),o(S,{children:o(i,{name:"subdomain",style:{textAlign:"right"},placeholder:q("subdomain"),pattern:"^[a-z\\d-]+$",required:!0,children:o(V,{children:".getoutline.com"})})}),o(D,{type:"submit",fullwidth:!0,children:q("Continue")})]})]});const de=A.providers.length>1,ue=E(A.providers,(e=>e.id===T.lastSignedIn&&!Q));return $?a(Z,{children:[o(BackButton,{config:A}),a(oe,{align:"center",justify:"center",column:!0,auto:!0,children:[o(j,{title:q("Check your email")}),o(K,{size:38}),o(P,{centered:!0,children:q("Check your email")}),o(ne,{children:o(g,{defaults:"A magic sign-in link has been sent to the email <em>{{ emailLinkSentTo }}</em> if an account exists.",values:{emailLinkSentTo:$},components:{em:o("em",{})}})}),o("br",{}),o(D,{onClick:re,fullwidth:!0,neutral:!0,children:q("Back to login")})]})]}):1!==A.providers.length||"oidc"!==A.providers[0].id||h.OIDC_DISABLE_REDIRECT||l.get("notice")||l.get("logout")?a(Z,{children:[o(BackButton,{config:A}),o(ChangeLanguage,{locale:X()}),a(oe,{align:"center",justify:"center",gap:12,column:!0,auto:!0,children:[o(j,{title:A.name?`${A.name} – ${q("Login")}`:q("Login")}),o(ee,{children:A.logo&&!Q?o(N,{size:O.XXLarge,src:A.logo}):o(F,{size:O.XXLarge})}),a(r,Q?{children:[o(J,{as:"h2",centered:!0,children:q("Create a workspace")}),o(te,{children:q("Get started by choosing a sign-in method for your new workspace below…")})]}:{children:[o(J,{as:"h2",centered:!0,children:q("Login to {{ authProviderName }}",{authProviderName:A.name||h.APP_NAME})}),n?.(A)]}),o(Notices,{}),ue&&a(t.Fragment,{children:[o(AuthenticationProvider,{isCreate:Q,onEmailSuccess:ce,...ue}),de&&a(r,{children:[o(ne,{children:q("You signed in with {{ authProviderName }} last time.",{authProviderName:ue.name})}),o(ie,{"data-text":q("Or")})]})]},ue.id),A.providers.map((e=>ue&&e.id===ue.id?null:o(AuthenticationProvider,{isCreate:Q,onEmailSuccess:ce,neutral:ue&&de,...e},e.id))),Q&&o(ne,{children:a(g,{children:["Already have an account? Go to ",o(L,{to:"/",children:"login"}),"."]})})]})]}):(window.location.href=z(A.providers[0].authUrl),null)}));export{ae as default};
