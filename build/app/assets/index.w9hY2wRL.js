import{d8 as e,dT as t,c3 as o,j as i,cc as n,bZ as s,dU as r,c$ as a,dV as c,aM as l,dW as d,cm as h,dX as m,dD as p,dY as u,h as f,dZ as g,d_ as v,d$ as b,n as w,e0 as y,e1 as x,e2 as C,bt as I,e3 as k,e4 as T,e5 as S,e6 as R,r as P,aD as E,ak as M,bl as L,C as O,ah as A,M as B,d9 as D,e7 as V,e8 as N,e9 as z,ea as $,a2 as W,eb as j,ec as _,T as H,F,al as U,cs as q,o as K,u as X,bv as Y,ed as Z,ee as J,d as Q,z as G,a8 as ee,ef as te,Z as oe,N as ie,aG as ne,bn as se,eg as re,eh as ae,ei as ce,ej as le,X as de,bE as he,ek as me,el as pe,em as ue,en as fe,eo as ge,ep as ve,eq as be,er as we,es as ye,et as xe,eu as Ce,ev as Ie,ew as ke,an as Te,c_ as Se,ex as Re,ey as Pe,ez as Ee,eA as Me,eB as Le}from"./index.mlCxaiYE.js";import{aa as Oe,P as Ae,ag as Be,c as De,au as Ve,e as Ne,ai as ze,b as $e,M as We,T as je,af as _e,av as He,aw as Fe,ax as Ue,ay as qe}from"./DocumentContext.hhTeDqBR.js";import{u as Ke}from"./useBoolean.4JQO1FDN.js";import{H as Xe}from"./Scene.tZk0YIWv.js";import{C as Ye}from"./InputSelectPermission.lb2lIKIy.js";import"./PlaceholderText.UNfhMHoO.js";import"./LoadingIndicatorBar.mGaD64ZX.js";import"./Switch.3DOmHSIs.js";import"./PopoverDisclosure.OO70kItq.js";import"./TeamLogo.qV1feKYB.js";import"./useCurrentUser.zlImhYTS.js";import"./Badge.sHfYRIgC.js";import"./Item.dGEOVRdT.js";import"./Time.rp9cc_zo.js";import"./index.esm.XsAbwjVB.js";import"./useCurrentTeam.fRZpnoZU.js";import"./usePolicy.wYF8wJNp.js";import"./SharedLayoutContext.2BBc39h7.js";function dropCursor(t={}){return new e({view:e=>new DropCursorView(e,t)})}class DropCursorView{constructor(e,t){var o;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(o=t.width)&&void 0!==o?o:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let handler=e=>{this[t](e)};return e.dom.addEventListener(t,handler),{name:t,handler:handler}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),o=!t.parent.inlineContent;if(o){let o=t.nodeBefore,i=t.nodeAfter;if(o||i){let t=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0));if(t){let n=t.getBoundingClientRect(),s=o?n.bottom:n.top;o&&i&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:n.left,right:n.right,top:s-this.width/2,bottom:s+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let i,n,s=this.editorView.dom.offsetParent;if(this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",o),this.element.classList.toggle("prosemirror-dropcursor-inline",!o),!s||s==document.body&&"static"==getComputedStyle(s).position)i=-pageXOffset,n=-pageYOffset;else{let e=s.getBoundingClientRect();i=e.left-s.scrollLeft,n=e.top-s.scrollTop}this.element.style.left=e.left-i+"px",this.element.style.top=e.top-n+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let o=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),i=o&&o.inside>=0&&this.editorView.state.doc.nodeAt(o.inside),n=i&&i.type.spec.disableDropCursor,s="function"==typeof n?n(this.editorView,o,e):n;if(o&&!s){let e=o.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let o=t(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=o&&(e=o)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class EventEmitter{constructor(){this.listeners={},this.on=this.addListener,this.off=this.removeListener}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeListener(e,t){this.listeners[e]=this.listeners[e]?.filter((e=>e!==t))}emit(e,t){this.listeners[e]?.forEach((e=>{e(t)}))}}var Ze=Object.defineProperty,Je=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,o,i)=>{for(var n,s=i>1?void 0:i?Je(t,o):t,r=e.length-1;r>=0;r--)(n=e[r])&&(s=(i?n(t,o,s):n(s))||s);return i&&s&&Ze(t,o,s),s};class NodeViewRenderer{constructor(e,t,o){this.element=e,this.Component=t,this.props=o}get content(){return o.createPortal(i(this.Component,{...this.props}),this.element)}updateProps(e){n(e,this.props)||(this.props=e)}setProp(e,t){this.props[e]=t}}__decorateClass([s],NodeViewRenderer.prototype,"props",2),__decorateClass([r],NodeViewRenderer.prototype,"content",1),__decorateClass([a],NodeViewRenderer.prototype,"updateProps",1),__decorateClass([a],NodeViewRenderer.prototype,"setProp",1);class ComponentView{constructor(e,{editor:t,extension:o,node:i,view:n,getPos:s,decorations:r}){this.isSelected=!1,this.component=e,this.editor=t,this.extension=o,this.getPos=s,this.decorations=r,this.node=i,this.view=n,this.dom=i.type.spec.inline?document.createElement("span"):document.createElement("div"),this.dom.classList.add(`component-${i.type.name}`),this.renderer=new NodeViewRenderer(this.dom,this.component,this.props),this.editor.renderers.add(this.renderer)}update(e){return e.type===this.node.type&&(this.node=e,this.renderer.updateProps(this.props),!0)}selectNode(){this.view.editable&&(this.isSelected=!0,this.renderer.updateProps(this.props))}deselectNode(){this.view.editable&&(this.isSelected=!1,this.renderer.updateProps(this.props))}stopEvent(e){return"mousedown"!==e.type&&!e.type.startsWith("drag")}destroy(){this.editor.renderers.delete(this.renderer),this.dom=null}ignoreMutation(){return!0}get props(){return{node:this.node,view:this.view,isSelected:this.isSelected,isEditable:this.view.editable,getPos:this.getPos}}}var Qe=c;var Ge=m,et=d,tt=function baseSome$1(e,t){var o;return Qe(e,(function(e,i,n){return!(o=t(e,i,n))})),!!o},ot=p,it=h;const nt=l((function some(e,t,o){var i=ot(e)?Ge:tt;return o&&it(e,t,o)&&(t=void 0),i(e,et(t))}));function isInNotice(e){const{nodes:t}=e.schema;return t.container_notice&&u(t.container_notice)(e)}const langToMenuItem=({node:e,value:t,label:o})=>({name:"code_block",label:o,active:()=>e.attrs.language===t,attrs:{language:t}});function CircleIcon({size:e=24,color:t="currentColor",retainColor:o,...n}){return i("svg",{fill:t,width:e,height:e,viewBox:"0 0 24 24",version:"1.1",style:o?{fill:t}:void 0,...n,children:i("circle",{xmlns:"http://www.w3.org/2000/svg",cx:"12",cy:"12",r:"8"})})}const st=w(CircleIcon).withConfig({componentId:"sc-199mz9h-0"})(["circle{stroke:",";stroke-dasharray:2,2;}"],(e=>e.theme.textSecondary));const rt=w(f.ArrowIcon).withConfig({componentId:"sc-g3z5oo-0"})(["transform:rotate(-90deg);"]),at=w(f.ArrowIcon).withConfig({componentId:"sc-g3z5oo-1"})(["transform:rotate(90deg);"]);const ct={left:-1e4,top:0,offset:0,maxWidth:1e3,blockSelection:!1,visible:!1};const lt=P.forwardRef((function FloatingToolbar_(e,t){const o=t||P.createRef(),[n,s]=P.useState(!1);let r=function usePosition({menuRef:e,active:t}){const{view:o}=Be(),{selection:i}=o.state,n=e.current?.offsetWidth,s=e.current?.offsetHeight;if(!(t&&n&&s&&e.current))return ct;let r,a;try{r=o.coordsAtPos(i.from),a=o.coordsAtPos(i.to,-1)}catch(y){return B.warn("Unable to calculate selection position",y),ct}const c={top:Math.min(r.top,a.top),bottom:Math.max(r.bottom,a.bottom),left:Math.min(r.left,a.left),right:Math.max(r.right,a.right)},l=e.current.offsetParent?e.current.offsetParent.getBoundingClientRect():{width:window.innerWidth,height:window.innerHeight,top:0,left:0},d=D(j)(o.state.selection),h=D((e=>"container_notice"===e.type.name))(o.state.selection);if((d||h)&&o.state.selection.empty){const e=d?d.pos:h?h.pos:null;if(null!==e){const t=o.nodeDOM(e).getBoundingClientRect();c.top=t.top,c.left=t.right-n,c.right=t.right}}const m=i instanceof V&&i.isColSelection(),p=i instanceof V&&i.isRowSelection();if(m&&p){const e=N(o.state),t=o.domAtPos(e.tableStart).node.getBoundingClientRect();c.top=t.top-16,c.left=t.left-10,c.right=t.left-10}else if(m){const e=N(o.state),t=o.domAtPos(e.tableStart).node.querySelector(`tr > *:nth-child(${e.left+1})`);if(t instanceof HTMLElement){const e=t.getBoundingClientRect();c.top=e.top-16,c.left=e.left,c.right=e.right}}else if(p){const e=N(o.state),t=o.domAtPos(e.tableStart).node.querySelector(`tr:nth-child(${e.top+1}) > *`);if(t instanceof HTMLElement){const e=t.getBoundingClientRect();c.top=e.top,c.left=e.left-10,c.right=e.left-10}}if(i instanceof z&&"image"===i.node?.type.name){const e=o.nodeDOM(i.from),t=e?e.getElementsByClassName($.imageHandle)[0]:void 0;if(t){const{left:e,top:o,width:i}=t.getBoundingClientRect();return{left:Math.round(e+i/2-n/2-l.left),top:Math.round(o-s-l.top),offset:0,visible:!0}}}const u=Math.abs(c.right-c.left)/2,f=c.left+u,g=12,v=Math.min(Math.min(l.x+l.width-n-g,window.innerWidth-g),Math.max(Math.max(l.x,g),f-n/2)),b=Math.max(Xe,Math.min(window.innerHeight-s-g,Math.max(g,c.top-s))),w=v-(f-n/2);return{left:Math.max(g,Math.round(v-l.left)),top:Math.round(b-l.top),offset:Math.round(w),maxWidth:Math.min(window.innerWidth,l.width)-24,blockSelection:d||m||p||h,visible:!0}}({menuRef:o,active:e.active});n&&(r=ct),E("mouseup",(()=>{s(!1)})),E("mousedown",(()=>{e.active||s(!0)}));const a=M(),{height:c}=L();if(a){if(!e.children)return null;if(e.active){const t=document.body.getBoundingClientRect();return i(Oe,{children:i(dt,{ref:o,style:{bottom:`calc(100% - ${c-t.y}px)`},children:e.children})})}return null}return i(Ae,{children:i(ht,{active:e.active&&r.visible,arrow:!r.blockSelection,ref:o,$offset:r.offset,style:{width:e.width,maxWidth:`${r.maxWidth}px`,top:`${r.top}px`,left:`${r.left}px`},children:e.children})})})),dt=w.div.withConfig({componentId:"sc-6j7khp-0"})(["position:absolute;left:0;right:0;width:100vw;padding:10px 6px;background-color:",";border-top:1px solid ",";box-sizing:border-box;z-index:",';&:after{content:"";position:absolute;left:0;right:0;height:100px;background-color:',";}@media print{display:none;}"],O("menuBackground"),O("divider"),A.editorToolbar,O("menuBackground")),ht=w.div.withConfig({componentId:"sc-6j7khp-1"})(["will-change:opacity,transform;padding:6px;position:absolute;z-index:",";opacity:0;background-color:",";box-shadow:",";border-radius:4px;transform:scale(0.95);transition:opacity 150ms cubic-bezier(0.175,0.885,0.32,1.275),transform 150ms cubic-bezier(0.175,0.885,0.32,1.275);transition-delay:150ms;line-height:0;height:36px;box-sizing:border-box;pointer-events:none;white-space:nowrap;"," *{box-sizing:border-box;}",";@media print{display:none;}"],A.editorToolbar,O("menuBackground"),O("menuShadow"),(e=>e.arrow?W(['&::before{content:"";display:block;width:24px;height:24px;transform:translateX(-50%) rotate(45deg);background:',";border-radius:3px;z-index:-1;position:absolute;bottom:-2px;left:calc(50% - ","px);pointer-events:none;}"],O("menuBackground"),e.$offset||0):""),(({active:e})=>e&&"\n    transform: translateY(-6px) scale(1);\n    opacity: 1;\n  ")),mt=w.button.attrs((e=>({type:e.type||"button"}))).withConfig({componentId:"sc-1sxydup-0"})(["display:inline-flex;align-items:center;gap:4px;flex:0;min-width:24px;height:24px;cursor:var(--pointer);border:none;border-radius:4px;background:none;transition:opacity 100ms ease-in-out;padding:0;opacity:0.8;outline:none;pointer-events:all;position:relative;transition:background 100ms ease-in-out;color:",";&:hover{opacity:1;}",";&:disabled{opacity:0.3;cursor:default;}"," ",";"],O("text"),(e=>e.hovering&&W(["opacity:1;"])),_(4),(e=>e.active&&W(["opacity:1;color:",";background:",";"],O("accentText"),O("accent")))),WrappedTooltip=({children:e,content:t,...o})=>i(H,{offset:[0,16],delay:150,content:t,placement:"top",shortcutOnNewline:!0,...o,children:i(pt,{children:e})}),pt=w.span.withConfig({componentId:"sc-3366qt-0"})(["outline:none;"]),ut=w(F).withConfig({componentId:"sc-1n3bz78-0"})(["pointer-events:all;gap:8px;"]),ft=w(U).withConfig({componentId:"sc-1n3bz78-1"})(["background:",";box-shadow:",";clip-path:inset(0px -100px -100px -100px);position:absolute;top:100%;width:100%;height:auto;left:0;margin-top:-6px;border-radius:0 0 4px 4px;padding:",";max-height:240px;pointer-events:all;"," @media (hover:none) and (pointer:coarse){position:fixed;top:auto;bottom:40px;border-radius:0;max-height:50vh;padding:8px 8px 4px;}"],O("menuBackground"),(e=>e.$hasResults?O("menuShadow"):"none"),(e=>e.$hasResults?"6px":"0"),q()),gt=K((({mark:e,from:t,to:o,dictionary:n,onRemoveLink:s,onSelectLink:r,onClickLink:a,view:c})=>{const getHref=()=>Z(e?.attrs.href)??"",l=getHref(),d=o-t,h=P.useRef(null),m=P.useRef(!1),[p,u]=P.useState(l),[g,v]=P.useState(-1),{documents:b}=X(),w=p.trim(),y=w?b.findByQuery(w,{maxResults:25}):[],{request:x}=De(P.useCallback((async()=>{(await Y.post("/suggestions.mention",{query:p})).data.documents.map(b.add)}),[p]));P.useEffect((()=>{w&&x()}),[w,x]),P.useEffect((()=>{const handleGlobalKeyDown=e=>{"k"===e.key&&e.metaKey&&h.current?.select()};return window.addEventListener("keydown",handleGlobalKeyDown),()=>{if(window.removeEventListener("keydown",handleGlobalKeyDown),!m.current&&w!==l)return w?void save(w,w):handleRemoveLink()}}),[w,l]);const save=(e,i)=>{0!==(e=e.trim()).length&&(m.current=!0,e=Z(e)??"",r({href:e,title:i,from:t,to:o}))},moveSelectionToEnd=()=>{const{state:e,dispatch:t}=c,i=te.findFrom(e.tr.doc.resolve(o),1,!0);i&&t(e.tr.setSelection(i)),c.focus()},handleSearch=async e=>{const t=e.target.value;u(t),v(-1)},handleRemoveLink=()=>{m.current=!0;const{state:i,dispatch:n}=c;e&&n(i.tr.removeMark(t,o,e)),s?.(),c.focus()},C=J(p),I=!!y.length;return Q(G,{children:[Q(ut,{children:[i(Ve,{ref:h,value:p,placeholder:n.searchOrPasteLink,onKeyDown:e=>{switch(e.key){case"ArrowDown":{e.preventDefault();const t=y.length-1;return void v((e=>e>=t?0:e+1))}case"ArrowUp":{e.preventDefault();const t=y.length-1;return void v((e=>e<=0?t:e-1))}case"Enter":if(e.preventDefault(),g>=0&&y[g]){const e=y[g],t=e.url;save(t,e.title)}else save(w,w);return void(d&&moveSelectionToEnd());case"Escape":return e.preventDefault(),void(l?(u(l),moveSelectionToEnd()):handleRemoveLink())}},onPaste:()=>{setTimeout((()=>save(p,p)),0)},onChange:handleSearch,onFocus:handleSearch,autoFocus:""===getHref(),readOnly:!c.editable}),i(WrappedTooltip,{content:C?n.goToLink:n.openLink,children:i(mt,{onClick:e=>{e.preventDefault();try{a(getHref(),e)}catch(t){oe.error(n.openLinkError)}},disabled:!p,children:i(C?f.ArrowIcon:f.OpenIcon,{})})}),c.editable&&i(WrappedTooltip,{content:n.removeLink,children:i(mt,{onClick:handleRemoveLink,children:i(f.CloseIcon,{})})})]}),i(ft,{$hasResults:I,children:i(Ne,{children:I&&i(G,{children:y.map(((e,t)=>i(ze,{onClick:()=>{save(e.url,e.title),d&&moveSelectionToEnd()},onPointerMove:()=>v(t),selected:t===g,subtitle:e.collection?.name,title:e.title,icon:e.icon?i(ee,{value:e.icon,color:e.color??void 0}):i(f.DocumentIcon,{})},e.id)))})})})]})})),vt=w.div.withConfig({componentId:"sc-t08gd9-0"})(["height:36px;width:1px;background:",";opacity:0.25;display:inline-block;margin:-6px 2px;"],O("textTertiary"));function ToolbarDropdown(e){const t=$e(),{commands:o,view:n}=Be(),{item:s}=e,{state:r}=n,a=P.useMemo((()=>s.children?s.children.map((e=>{return"separator"===e.name?{type:"separator",visible:e.visible}:{type:"button",title:e.label,icon:e.icon,dangerous:e.dangerous,visible:e.visible,selected:void 0!==e.active?e.active(r):void 0,onClick:(t=e,()=>{t.name&&o[t.name]("function"==typeof t.attrs?t.attrs(r):t.attrs)})};var t})):[]),[s.children,o,r]);return Q(G,{children:[i(We,{...t,children:e=>Q(mt,{...e,hovering:t.visible,children:[s.label&&i(yt,{children:s.label}),s.icon]})}),i(Ye,{"aria-label":s.label,...t,children:i(je,{...t,items:a})})]})}const bt={placement:"top"};function ToolbarMenu(e){const{commands:t,view:o}=Be(),{items:n}=e,{state:s}=o,handleClick=e=>()=>{e.name&&t[e.name]("function"==typeof e.attrs?e.attrs(s):e.attrs)};return i(ne,{tippyProps:bt,children:i(wt,{children:n.map(((e,t)=>{if("separator"===e.name&&!1!==e.visible)return i(vt,{},t);if(!1===e.visible||!e.icon)return null;const o=!!e.active&&e.active(s);return i(WrappedTooltip,{shortcut:e.shortcut,content:e.label===e.tooltip?void 0:e.tooltip,children:e.children?i(ToolbarDropdown,{active:o&&!e.label,item:e}):Q(mt,{onClick:handleClick(e),active:o&&!e.label,children:[e.label&&i(yt,{children:e.label}),e.icon]})},t)}))})})}const wt=w.div.withConfig({componentId:"sc-1wvd6gb-0"})(["color:",";overflow:hidden;display:flex;gap:6px;",""],O("textSecondary"),ie("mobile","tablet")`
    justify-content: space-evenly;
    align-items: baseline;
  `),yt=w.span.withConfig({componentId:"sc-1wvd6gb-1"})(["font-size:15px;font-weight:500;color:",";"],O("text"));function SelectionToolbar(e){const{onClose:t,readOnly:o,onOpen:n}=e,{view:s,commands:r}=Be(),a=_e(),c=P.useRef(null),l=M(),d=function useIsActive(e){const{selection:t,doc:o}=e;if(C(e.schema.marks.link)(e))return!0;if((u(e.schema.nodes.code_block)(e)||u(e.schema.nodes.code_fence)(e))&&t.from>0)return!0;if(isInNotice(e)&&t.from>0)return!0;if(!t||t.empty)return!1;if(t instanceof z&&"hr"===t.node.type.name)return!0;if(t instanceof z&&["image","attachment"].includes(t.node.type.name))return!0;if(t instanceof z)return!1;const i=o.cut(t.from,t.to).textContent;if(t instanceof le&&!i)return!1;const n=t.content().content.content;return nt(n,(e=>e.content.size))}(s.state)||l,h=function useIsDragging(){const[e,t,o]=Ke();return E("dragstart",t),E("dragend",o),E("drop",o),e}(),m=se(d);P.useEffect((()=>{m&&!d&&t(),!m&&d&&n()}),[d,t,n,m]),P.useEffect((()=>{const handleClickOutside=e=>{if(e.target instanceof HTMLElement&&c.current&&c.current.contains(e.target))return;if(s.dom.contains(e.target))return;if(!d||"INPUT"===document.activeElement?.tagName)return;if(!window.getSelection()?.isCollapsed)return;const{dispatch:t}=s;t(s.state.tr.setSelection(new le(s.state.doc.resolve(0))))};return window.addEventListener("mouseup",handleClickOutside),()=>{window.removeEventListener("mouseup",handleClickOutside)}}),[d,m,o,s]);const{isTemplate:p,rtl:w,canComment:L,canUpdate:O,...A}=e,{state:B}=s,{selection:D}=B,V=u(B.schema.nodes.hr)(B);if(o&&!L||h)return null;const N=re(B),$=ae(B),W=void 0!==N&&void 0!==$,j=ce(D.$from,B.schema.marks.link),_=D instanceof z&&"image"===D.node.type.name,H=D instanceof z&&"attachment"===D.node.type.name,F=y(B,{onlyBlock:!0}),U=isInNotice(B);let q=[];if(q=F&&D.empty?function codeMenuItems(e,t,o){const n=e.selection.$from.node(),s=g(),r=s.map((e=>{const t=v[e]?.label;return langToMenuItem({node:n,value:e,label:t})})),a=Object.entries(v).filter((([e])=>!s.includes(e))).map((([e,t])=>langToMenuItem({node:n,value:e,label:t.label}))),c=r.length?[...r,{name:"separator"},...a]:a;return[{name:"copyToClipboard",icon:i(f.CopyIcon,{}),label:t?o.copy:void 0,tooltip:o.copy},{name:"separator",visible:!t},{visible:!t,name:"code_block",icon:i(f.ExpandedIcon,{}),label:b(n.attrs.language??"none"),children:c}]}(B,o,a):W?function tableMenuItems(e,t){const{schema:o}=e,n=u(o.nodes.table,{layout:R.fullWidth})(e);return[{name:"setTableAttr",tooltip:n?t.alignDefaultWidth:t.alignFullWidth,icon:i(f.AlignFullWidthIcon,{}),attrs:n?{layout:null}:{layout:R.fullWidth},active:()=>n},{name:"separator"},{name:"deleteTable",tooltip:t.deleteTable,icon:i(f.TrashIcon,{})},{name:"separator"},{name:"exportTable",tooltip:t.exportAsCSV,label:"CSV",attrs:{format:"csv",fileName:`${window.document.title}.csv`},icon:i(f.DownloadIcon,{})}]}(B,a):void 0!==N?function tableColMenuItems(e,t,o,n){const{schema:s}=e;return[{name:"setColumnAttr",tooltip:n.alignLeft,icon:i(f.AlignLeftIcon,{}),attrs:{index:t,alignment:"left"},active:u(s.nodes.th,{colspan:1,rowspan:1,alignment:"left"})},{name:"setColumnAttr",tooltip:n.alignCenter,icon:i(f.AlignCenterIcon,{}),attrs:{index:t,alignment:"center"},active:u(s.nodes.th,{colspan:1,rowspan:1,alignment:"center"})},{name:"setColumnAttr",tooltip:n.alignRight,icon:i(f.AlignRightIcon,{}),attrs:{index:t,alignment:"right"},active:u(s.nodes.th,{colspan:1,rowspan:1,alignment:"right"})},{name:"separator"},{name:"sortTable",tooltip:n.sortAsc,attrs:{index:t,direction:"asc"},icon:i(rt,{})},{name:"sortTable",tooltip:n.sortDesc,attrs:{index:t,direction:"desc"},icon:i(at,{})},{name:"separator"},{icon:i(f.MoreIcon,{}),children:[{name:"toggleHeaderColumn",label:n.toggleHeader,icon:i(f.TableHeaderColumnIcon,{}),visible:0===t},{name:o?"addColumnAfter":"addColumnBefore",label:o?n.addColumnAfter:n.addColumnBefore,icon:i(f.InsertLeftIcon,{}),attrs:{index:t}},{name:o?"addColumnBefore":"addColumnAfter",label:o?n.addColumnBefore:n.addColumnAfter,icon:i(f.InsertRightIcon,{}),attrs:{index:t}},{name:"deleteColumn",dangerous:!0,label:n.deleteColumn,icon:i(f.TrashIcon,{})}]}]}(B,N,w,a):void 0!==$?function tableRowMenuItems(e,t,o){return[{icon:i(f.MoreIcon,{}),children:[{name:"toggleHeaderRow",label:o.toggleHeader,icon:i(f.TableHeaderRowIcon,{}),visible:0===t},{name:"addRowBefore",label:o.addRowBefore,icon:i(f.InsertAboveIcon,{}),attrs:{index:t}},{name:"addRowAfter",label:o.addRowAfter,icon:i(f.InsertBelowIcon,{}),attrs:{index:t}},{name:"deleteRow",label:o.deleteRow,dangerous:!0,icon:i(f.TrashIcon,{})}]}]}(0,$,a):_?o?[]:function imageMenuItems(e,t){const{schema:o}=e,n=u(o.nodes.image,{layoutClass:"left-50"}),s=u(o.nodes.image,{layoutClass:"right-50"}),r=u(o.nodes.image,{layoutClass:"full-width"});return[{name:"alignLeft",tooltip:t.alignLeft,icon:i(f.AlignImageLeftIcon,{}),active:n},{name:"alignCenter",tooltip:t.alignCenter,icon:i(f.AlignImageCenterIcon,{}),active:e=>u(o.nodes.image)(e)&&!n(e)&&!s(e)&&!r(e)},{name:"alignRight",tooltip:t.alignRight,icon:i(f.AlignImageRightIcon,{}),active:s},{name:"alignFullWidth",tooltip:t.alignFullWidth,icon:i(f.AlignFullWidthIcon,{}),active:r},{name:"separator"},{name:"downloadImage",tooltip:t.downloadImage,icon:i(f.DownloadIcon,{}),visible:!!fetch},{name:"replaceImage",tooltip:t.replaceImage,icon:i(f.ReplaceIcon,{})},{name:"deleteImage",tooltip:t.deleteImage,icon:i(f.TrashIcon,{})}]}(B,a):H?o?[]:function attachmentMenuItems(e,t){return[{name:"replaceAttachment",tooltip:t.replaceAttachment,icon:i(f.ReplaceIcon,{})},{name:"deleteAttachment",tooltip:t.deleteAttachment,icon:i(f.TrashIcon,{})},{name:"separator"},{name:"downloadAttachment",label:t.download,icon:i(f.DownloadIcon,{}),visible:!!fetch}]}(0,a):V?function dividerMenuItems(e,t){const{schema:o}=e;return[{name:"hr",tooltip:t.hr,attrs:{markup:"---"},active:u(o.nodes.hr,{markup:"---"}),icon:i(f.HorizontalRuleIcon,{})},{name:"hr",tooltip:t.pageBreak,attrs:{markup:"***"},active:u(o.nodes.hr,{markup:"***"}),icon:i(f.PageBreakIcon,{})}]}(B,a):o?function readOnlyMenuItems(e,t,o){const{schema:n}=e,s=e.selection.empty;return[{visible:t&&!s,name:"comment",tooltip:o.comment,label:o.comment,icon:i(f.CommentIcon,{}),active:C(n.marks.comment)}]}(B,!!O,a):U&&D.empty?function noticeMenuItems(e,t,o){const n=e.selection.$from.node(-1),s=n?.attrs.style;return[{name:"container_notice",visible:!t,label:{[S.Info]:o.infoNotice,[S.Warning]:o.warningNotice,[S.Success]:o.successNotice,[S.Tip]:o.tipNotice}[s],icon:i(f.ExpandedIcon,{}),children:[{name:S.Info,icon:i(f.InfoIcon,{}),label:o.infoNotice,active:()=>s===S.Info},{name:S.Success,icon:i(f.DoneIcon,{}),label:o.successNotice,active:()=>s===S.Success},{name:S.Warning,icon:i(f.WarningIcon,{}),label:o.warningNotice,active:()=>s===S.Warning},{name:S.Tip,icon:i(f.StarredIcon,{}),label:o.tipNotice,active:()=>s===S.Tip}]}]}(B,o,a):function formattingMenuItems(e,t,o,n){const{schema:s}=e,r=y(e),a=y(e,{onlyBlock:!0}),c=e.selection.empty,l=x(e.selection.from,e.selection.to,e).find((({mark:e})=>"highlight"===e.type.name));return[{name:"placeholder",tooltip:n.placeholder,icon:i(f.InputIcon,{}),active:C(s.marks.placeholder),visible:t&&(!o||!c)},{name:"separator",visible:t&&(!o||!c)},{name:"strong",tooltip:n.strong,shortcut:`${I}+B`,icon:i(f.BoldIcon,{}),active:C(s.marks.strong),visible:!(r||o&&c)},{name:"em",tooltip:n.em,shortcut:`${I}+I`,icon:i(f.ItalicIcon,{}),active:C(s.marks.em),visible:!(r||o&&c)},{name:"strikethrough",tooltip:n.strikethrough,shortcut:`${I}+D`,icon:i(f.StrikethroughIcon,{}),active:C(s.marks.strikethrough),visible:!(r||o&&c)},{tooltip:n.mark,shortcut:`${I}+Ctrl+H`,icon:l?i(CircleIcon,{color:l.mark.attrs.color||k.colors[0]}):i(f.HighlightIcon,{}),active:()=>!!l,visible:!(r||o&&c),children:[...l?[{name:"highlight",label:n.none,icon:i(st,{retainColor:!0,color:"transparent"}),active:()=>!1,attrs:{color:l.mark.attrs.color}}]:[],...k.colors.map(((e,t)=>({name:"highlight",label:k.colorNames[t],icon:i(CircleIcon,{retainColor:!0,color:e}),active:C(s.marks.highlight,{color:e}),attrs:{color:e}})))]},{name:"code_inline",tooltip:n.codeInline,shortcut:`${I}+E`,icon:i(f.CodeIcon,{}),active:C(s.marks.code_inline),visible:!(a||o&&c)},{name:"separator",visible:!a},{name:"heading",tooltip:n.heading,shortcut:"⇧+Ctrl+1",icon:i(f.Heading1Icon,{}),active:u(s.nodes.heading,{level:1}),attrs:{level:1},visible:!a&&(!o||c)},{name:"heading",tooltip:n.subheading,shortcut:"⇧+Ctrl+2",icon:i(f.Heading2Icon,{}),active:u(s.nodes.heading,{level:2}),attrs:{level:2},visible:!a&&(!o||c)},{name:"heading",tooltip:n.subheading,shortcut:"⇧+Ctrl+3",icon:i(f.Heading3Icon,{}),active:u(s.nodes.heading,{level:3}),attrs:{level:3},visible:!a&&(!o||c)},{name:"blockquote",tooltip:n.quote,shortcut:`${I}+]`,icon:i(f.BlockQuoteIcon,{}),active:u(s.nodes.blockquote),attrs:{level:2},visible:!a&&(!o||c)},{name:"separator",visible:!a},{name:"checkbox_list",tooltip:n.checkboxList,shortcut:"⇧+Ctrl+7",icon:i(f.TodoListIcon,{}),keywords:"checklist checkbox task",active:u(s.nodes.checkbox_list),visible:!a&&(!o||c)},{name:"bullet_list",tooltip:n.bulletList,shortcut:"⇧+Ctrl+8",icon:i(f.BulletedListIcon,{}),active:u(s.nodes.bullet_list),visible:!a&&(!o||c)},{name:"ordered_list",tooltip:n.orderedList,shortcut:"⇧+Ctrl+9",icon:i(f.OrderedListIcon,{}),active:u(s.nodes.ordered_list),visible:!a&&(!o||c)},{name:"outdentList",tooltip:n.outdent,shortcut:"⇧+Tab",icon:i(f.OutdentIcon,{}),visible:o&&T(e,{types:["ordered_list","bullet_list"]})},{name:"indentList",tooltip:n.indent,shortcut:"Tab",icon:i(f.IndentIcon,{}),visible:o&&T(e,{types:["ordered_list","bullet_list"]})},{name:"outdentCheckboxList",tooltip:n.outdent,shortcut:"⇧+Tab",icon:i(f.OutdentIcon,{}),visible:o&&T(e,{types:["checkbox_list"]})},{name:"indentCheckboxList",tooltip:n.indent,shortcut:"Tab",icon:i(f.IndentIcon,{}),visible:o&&T(e,{types:["checkbox_list"]})},{name:"separator",visible:!a},{name:"link",tooltip:n.createLink,shortcut:`${I}+K`,icon:i(f.LinkIcon,{}),attrs:{href:""},visible:!(a||o&&c)},{name:"comment",tooltip:n.comment,shortcut:`${I}+⌥+M`,icon:i(f.CommentIcon,{}),label:a?n.comment:void 0,active:C(s.marks.comment,{resolved:!1},{exact:!0}),visible:!o||!c},{name:"separator",visible:r&&!a&&(!o||!c)},{name:"copyToClipboard",icon:i(f.CopyIcon,{}),tooltip:n.copy,shortcut:`${I}+C`,visible:r&&!a&&(!o||!c)}]}(B,p,l,a),q=q.filter((e=>"separator"===e.name||!(e.name&&!r[e.name])&&!1!==e.visible)),q=He(q),!q.length)return null;const K=j&&j.from===D.from&&j.to===D.to;return i(lt,{active:d,ref:c,width:K?336:void 0,children:K?i(gt,{dictionary:a,view:s,mark:j.mark,from:j.from,to:j.to,onClickLink:e.onClickLink,onSelectLink:({href:e,from:t,to:o})=>{const{state:i,dispatch:n}=s,r=i.schema.marks.link;n(i.tr.removeMark(t,o,r).addMark(t,o,r.create({href:e})))}},`${j.from}-${j.to}`):i(ToolbarMenu,{items:q,...A})})}function WithTheme({children:e}){return e(de())}const xt=class _Editor extends P.PureComponent{constructor(){super(...arguments),this.state={isRTL:!1,isEditorFocused:!1,selectionToolbarOpen:!1},this.isInitialized=!1,this.isBlurred=!0,this.elementRef=P.createRef(),this.wrapperRef=P.createRef(),this.renderers=s.set(),this.events=new EventEmitter,this.value=(e=!0,t)=>{if(e){const e=this.serializer.serialize(this.view.state.doc);return t?e.trim():e}return(t?he.trim(this.view.state.doc):this.view.state.doc).toJSON()},this.calculateDir=()=>{if(!this.elementRef.current)return;const e="rtl"===this.props.dir||"rtl"===getComputedStyle(this.elementRef.current).direction;this.state.isRTL!==e&&this.setState({isRTL:e})},this.focusAtStart=()=>{const e=te.atStart(this.view.state.doc),t=this.view.state.tr.setSelection(e);this.view.dispatch(t),this.view.focus()},this.focusAtEnd=()=>{const e=te.atEnd(this.view.state.doc),t=this.view.state.tr.setSelection(e);this.view.dispatch(t),this.view.focus()},this.focus=()=>{this.view.focus(),this.view.dispatch(this.view.state.tr.scrollIntoView())},this.blur=()=>{this.view.dom.blur(),window?.getSelection()?.removeAllRanges()},this.insertFiles=(e,t)=>me(this.view,e,this.view.state.selection.to,t,this.props),this.isEmpty=()=>he.isEmpty(this.view.state.doc),this.getHeadings=()=>he.getHeadings(this.view.state.doc,this.schema),this.getImages=()=>he.getImages(this.view.state.doc),this.getTasks=()=>he.getTasks(this.view.state.doc),this.getComments=()=>he.getComments(this.view.state.doc),this.removeComment=e=>{const{state:t,dispatch:o}=this.view,i=t.tr;t.doc.descendants(((o,n)=>{if(!o.isInline)return;const s=o.marks.find((o=>o.type===t.schema.marks.comment&&o.attrs.id===e));s&&i.removeMark(n,n+o.nodeSize,s)})),o(i)},this.updateComment=(e,t)=>{const{state:o,dispatch:i}=this.view,n=o.tr;o.doc.descendants(((i,s)=>{if(!i.isInline)return;const r=i.marks.find((t=>t.type===o.schema.marks.comment&&t.attrs.id===e));if(r){const e=s,a=s+i.nodeSize,c=o.schema.marks.comment.create({...r.attrs,...t});n.removeMark(e,a,r).addMark(e,a,c)}})),i(n)},this.getPlainText=()=>{const{doc:e}=this.view.state,t=pe(this.schema);return ue(e,0,e.content.size,t)},this.dispatchThemeChanged=e=>{this.view.dispatch(this.view.state.tr.setMeta("theme",e.detail))},this.handleChange=()=>{this.props.onChange&&this.props.onChange(((e=!0,t=!1)=>this.view?this.value(e,t):void 0))},this.handleEditorInit=()=>{this.props.onInit&&!this.isInitialized&&(this.props.onInit(),this.isInitialized=!0)},this.handleEditorDestroy=()=>{this.props.onDestroy&&this.props.onDestroy()},this.handleEditorBlur=()=>(this.setState({isEditorFocused:!1}),!1),this.handleEditorFocus=()=>(this.setState({isEditorFocused:!0}),!1),this.handleOpenSelectionToolbar=()=>{this.setState((e=>({...e,selectionToolbarOpen:!0})))},this.handleCloseSelectionToolbar=()=>{this.state.selectionToolbarOpen&&this.setState((e=>({...e,selectionToolbarOpen:!1})))}}componentDidMount(){this.init(),window.addEventListener("theme-changed",this.dispatchThemeChanged),this.props.scrollTo&&this.scrollToAnchor(this.props.scrollTo),this.calculateDir(),this.props.readOnly||this.props.autoFocus&&this.focusAtEnd()}componentDidUpdate(e){if(this.props.value&&e.value!==this.props.value){const e=this.createState(this.props.value);this.view.updateState(e)}e.readOnly!==this.props.readOnly&&(this.view.update({...this.view.props,editable:()=>!this.props.readOnly}),Array.from(this.renderers).forEach((e=>e.setProp("isEditable",!this.props.readOnly)))),this.props.scrollTo&&this.props.scrollTo!==e.scrollTo&&this.scrollToAnchor(this.props.scrollTo),e.readOnly&&!this.props.readOnly&&this.props.autoFocus&&this.focusAtEnd(),e.dir!==this.props.dir&&this.calculateDir(),this.isBlurred||this.state.isEditorFocused||this.state.selectionToolbarOpen||(this.isBlurred=!0,this.props.onBlur?.()),this.isBlurred&&(this.state.isEditorFocused||this.state.selectionToolbarOpen)&&(this.isBlurred=!1,this.props.onFocus?.())}componentWillUnmount(){window.removeEventListener("theme-changed",this.dispatchThemeChanged),this.view?.destroy(),this.mutationObserver?.disconnect(),this.handleEditorDestroy()}init(){this.extensions=this.createExtensions(),this.nodes=this.createNodes(),this.marks=this.createMarks(),this.schema=this.createSchema(),this.widgets=this.createWidgets(),this.plugins=this.createPlugins(),this.rulePlugins=this.createRulePlugins(),this.keymaps=this.createKeymaps(),this.serializer=this.createSerializer(),this.parser=this.createParser(),this.pasteParser=this.createPasteParser(),this.inputRules=this.createInputRules(),this.nodeViews=this.createNodeViews(),this.view=this.createView(),this.commands=this.createCommands()}createExtensions(){return new ge(this.props.extensions,this)}createPlugins(){return this.extensions.plugins}createRulePlugins(){return this.extensions.rulePlugins}createKeymaps(){return this.extensions.keymaps({schema:this.schema})}createInputRules(){return this.extensions.inputRules({schema:this.schema})}createNodeViews(){return this.extensions.extensions.filter((e=>e.component)).reduce(((e,t)=>({...e,[t.name]:(e,o,i,n)=>new ComponentView(t.component,{editor:this,extension:t,node:e,view:o,getPos:i,decorations:n})})),{})}createCommands(){return this.extensions.commands({schema:this.schema,view:this.view})}createWidgets(){return this.extensions.widgets}createNodes(){return this.extensions.nodes}createMarks(){return this.extensions.marks}createSchema(){return new ve({nodes:this.nodes,marks:this.marks})}createSerializer(){return this.extensions.serializer()}createParser(){return this.extensions.parser({schema:this.schema,plugins:this.rulePlugins})}createPasteParser(){return this.extensions.parser({schema:this.schema,rules:{linkify:!0},plugins:this.rulePlugins})}createState(e){const t=this.createDocument(e||this.props.defaultValue);return be.create({schema:this.schema,doc:t,plugins:[...this.keymaps,...this.plugins,dropCursor({color:this.props.theme.cursor}),we(),ye({rules:this.inputRules}),xe(Re)]})}createDocument(e){return"string"==typeof e?this.parser.parse(e)||void 0:Ce.fromJSON(this.schema,e)}createView(){if(!this.elementRef.current)throw new Error("createView called before ref available");const isEditingCheckbox=e=>e.steps.some((e=>(e instanceof Pe||e instanceof Ee)&&e.slice.content?.firstChild?.type.name===this.schema.nodes.checkbox_item.name)),isEditingComment=e=>e.steps.some((e=>(e instanceof Me||e instanceof Le)&&e.mark.type.name===this.schema.marks.comment.name)),e=this,t=new Ie(this.elementRef.current,{handleDOMEvents:{blur:this.handleEditorBlur,focus:this.handleEditorFocus},attributes:{translate:this.props.readOnly?"yes":"no"},state:this.createState(this.props.value),editable:()=>!this.props.readOnly,nodeViews:this.nodeViews,dispatchTransaction(t){if(this.isDestroyed)return;const{state:o,transactions:i}=this.state.applyTransaction(t);this.updateState(o),i.some((e=>e.docChanged))&&(!e.props.readOnly||e.props.canUpdate&&i.some(isEditingCheckbox)||e.props.canComment&&i.some(isEditingComment))&&e.handleChange(),e.handleEditorInit(),e.calculateDir(),e.forceUpdate()}});return t.dom.setAttribute("role","textbox"),t}async scrollToAnchor(e){if(e)try{this.mutationObserver?.disconnect(),this.mutationObserver=observe(e,(e=>{e.scrollIntoView()}),this.elementRef.current||void 0)}catch(t){B.debug("editor",`Attempted to scroll to invalid hash: ${e}`)}}render(){const{readOnly:e,canUpdate:t,grow:o,style:n,className:s,onKeyDown:r}=this.props,{isRTL:a}=this.state;return i(Fe.Provider,{value:this.wrapperRef.current,children:i(Ue.Provider,{value:this,children:Q(F,{ref:this.wrapperRef,onKeyDown:r,style:n,className:s,align:"flex-start",justify:"center",column:!0,children:[i(It,{rtl:a,grow:o,readOnly:e,readOnlyWriteCheckboxes:t,focusedCommentId:this.props.focusedCommentId,userId:this.props.userId,editorStyle:this.props.editorStyle,ref:this.elementRef,lang:""}),this.view&&i(SelectionToolbar,{rtl:a,readOnly:e,canUpdate:this.props.canUpdate,canComment:this.props.canComment,isTemplate:!0===this.props.template,onOpen:this.handleOpenSelectionToolbar,onClose:this.handleCloseSelectionToolbar,onClickLink:this.props.onClickLink}),this.widgets&&Object.values(this.widgets).map(((t,o)=>i(t,{rtl:a,readOnly:e},String(o)))),i(ke,{children:()=>i(G,{children:Array.from(this.renderers).map((e=>e.content))})})]})})})}};xt.defaultProps={defaultValue:"",dir:"auto",placeholder:"Write something nice…",onFileUploadStart:()=>{},onFileUploadStop:()=>{},embeds:[],extensions:fe};let Ct=xt;const It=w(qe).withConfig({componentId:"sc-1d1t8yk-0"})([""," ",""],(e=>e.focusedCommentId&&W(["#comment-","{background:",";border-bottom:2px solid ",";}"],e.focusedCommentId,Te(.5,e.theme.brand.marine),e.theme.commentMarkBackground)),(e=>e.userId&&W(['.mention[data-id="','"]{color:',";background:",";&.ProseMirror-selectednode{outline-color:",";}}"],e.userId,e.theme.textHighlightForeground,e.theme.textHighlight,e.readOnly?"transparent":Se(.2,e.theme.textHighlight)))),kt=P.forwardRef((function _LazyLoadedEditor(e,t){return i(WithTheme,{children:o=>i(Ct,{theme:o,...e,ref:t})})})),observe=(e,t,o=document.body)=>{const i=new MutationObserver((o=>{const i=[...o].flatMap((e=>[...e.addedNodes])).find((t=>t.matches?.(e)));i&&t(i)}));return o.querySelector(e)?t(o.querySelector(e)):i.observe(o,{childList:!0,subtree:!0}),i};export{Ct as Editor,kt as default};
