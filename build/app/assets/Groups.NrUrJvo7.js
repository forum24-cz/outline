import{o as e,a as t,d as o,z as a,j as r,u as n,b as s,Z as i,F as l,A as c,am as u,B as d,h as m,E as p,ar as h,bR as g,I as b,bS as f,bT as y,r as C,n as v,C as S,a1 as k,a5 as w,bU as j,i as A,k as G,w as I,H as x,b4 as N,b5 as D,af as M}from"./index.mlCxaiYE.js";import{A as T}from"./Actions.u9jjnQ1W.js";import{H as F,S as P}from"./Scene.tZk0YIWv.js";import{u as q}from"./useCurrentTeam.fRZpnoZU.js";import{u as E}from"./usePolicy.wYF8wJNp.js";import{S as L,F as $,u as z,a as B}from"./StickyFilters.abAWg0uL.js";import{I as H}from"./authenticated.03alztlO.js";import{A as R,a as U}from"./TeamLogo.qV1feKYB.js";import{P as O,a as Y,B as Z}from"./Badge.sHfYRIgC.js";import{B as _}from"./ButtonLink.tgoiIjKJ.js";import{C as J}from"./Item.dGEOVRdT.js";import{b as K,O as Q,T as V,c as W,r as X}from"./DocumentContext.hhTeDqBR.js";import{S as ee}from"./Subheading.reqgXMWW.js";import{T as te}from"./Time.rp9cc_zo.js";import{C as oe}from"./InputSelectPermission.lb2lIKIy.js";import{F as ae}from"./Facepile.0K3TyxgD.js";import"./useCurrentUser.zlImhYTS.js";import"./index.esm.XsAbwjVB.js";import"./urls.doI9odX4.js";import"./Notice.4wB6_cwE.js";import"./Switch.3DOmHSIs.js";import"./PopoverDisclosure.OO70kItq.js";import"./useBoolean.4JQO1FDN.js";import"./LoadingIndicatorBar.mGaD64ZX.js";import"./PlaceholderText.UNfhMHoO.js";import"./routeHelpers.MPg4vHxP.js";import"./SharedLayoutContext.2BBc39h7.js";const re=e((function GroupMemberMenu({onRemove:e}){const{t:n}=t(),s=K({modal:!0});return o(a,{children:[r(Q,{"aria-label":n("Show menu"),...s}),r(oe,{...s,"aria-label":n("Group member options"),children:r(V,{...s,items:[{type:"button",dangerous:!0,title:n("Remove"),onClick:e}]})})]})}));function CreateGroupDialog(){const{dialogs:e,groups:a}=n(),{t:m}=t(),[p,h]=s.useState(),[g,f]=s.useState(!1),C=s.useCallback((async t=>{t.preventDefault(),f(!0);const o=new y({name:p},a);try{await o.save(),e.openModal({title:m("Group members"),content:r(ne,{group:o}),fullscreen:!0})}catch(n){i.error(n.message)}finally{f(!1)}}),[m,e,a,p]);return o("form",{onSubmit:C,children:[r(c,{as:"p",type:"secondary",children:r(u,{children:"Groups are for organizing your team. They work best when centered around a function or a responsibility — Support or Engineering for example."})}),r(l,{children:r(b,{type:"text",label:"Name",onChange:e=>h(e.target.value),value:p,required:!0,autoFocus:!0,flex:!0})}),r(c,{as:"p",type:"secondary",children:r(u,{children:"You’ll be able to add people to the group next."})}),r(d,{type:"submit",disabled:g||!p,children:g?`${m("Creating")}…`:m("Continue")})]})}function EditGroupDialog({group:e,onSubmit:a}){const{t:n}=t(),[m,p]=s.useState(e.name),[h,g]=s.useState(!1),f=s.useCallback((async t=>{t.preventDefault(),g(!0);try{await e.save({name:m}),a()}catch(o){i.error(o.message)}finally{g(!1)}}),[e,a,m]),y=s.useCallback((e=>{p(e.target.value)}),[]);return o("form",{onSubmit:f,children:[r(c,{as:"p",type:"secondary",children:r(u,{children:"You can edit the name of this group at any time, however doing so too often might confuse your team mates."})}),r(l,{children:r(b,{type:"text",label:n("Name"),onChange:y,value:m,required:!0,autoFocus:!0,flex:!0})}),r(d,{type:"submit",disabled:h||!m,children:h?`${n("Saving")}…`:n("Save")})]})}function DeleteGroupDialog({group:e,onSubmit:o}){const{t:a}=t();return r(J,{onSubmit:async()=>{await e.delete(),o()},submitText:a("I’m sure – Delete"),savingText:`${a("Deleting")}…`,danger:!0,children:r(u,{defaults:"Are you sure about that? Deleting the <em>{{groupName}}</em> group will cause its members to lose access to collections and documents that it is associated with.",values:{groupName:e.name},components:{em:r("strong",{})}})})}const ne=e((function({group:e}){const{dialogs:h,users:g,groupUsers:b}=n(),{t:f}=t(),y=E(e),C=s.useCallback((()=>{h.openModal({title:f("Add people to {{groupName}}",{groupName:e.name}),content:r(se,{group:e}),fullscreen:!0})}),[f,e,h]),v=s.useCallback((async t=>{try{await b.delete({groupId:e.id,userId:t.id}),i.success(f("{{userName}} was removed from the group",{userName:t.name}),{icon:r(R,{model:t,size:U.Toast})})}catch(o){i.error(f("Could not remove user"))}}),[f,b,e.id]);return o(l,{column:!0,children:[y.update?o(a,{children:[r(c,{as:"p",type:"secondary",children:r(u,{defaults:"Add and remove members to the <em>{{groupName}}</em> group. Members of the group will have access to any collections this group has been added to.",values:{groupName:e.name},components:{em:r("strong",{})}})}),y.update&&r("span",{children:o(d,{type:"button",onClick:C,icon:r(m.PlusIcon,{}),neutral:!0,children:[f("Add people"),"…"]})})]}):r(c,{as:"p",type:"secondary",children:r(u,{defaults:"Listing members of the <em>{{groupName}}</em> group.",values:{groupName:e.name},components:{em:r("strong",{})}})}),r(ee,{children:r(u,{children:"Members"})}),r(O,{items:g.inGroup(e.id),fetch:b.fetchPage,options:{id:e.id},empty:r(p,{children:f("This group has no members.")}),renderItem:e=>r(ie,{user:e,onRemove:y.update?()=>v(e):void 0},e.id)})]})})),se=e((function({group:e}){const{dialogs:a,users:u,groupUsers:d}=n(),{t:m}=t(),y=q(),C=E(y),[v,S]=s.useState(""),k=s.useMemo((()=>h((e=>u.fetchPage({query:e})),250)),[u]),w=s.useCallback((e=>{const t=e.target.value;S(t),k(t)}),[k]),j=s.useCallback((async t=>{try{await d.create({groupId:e.id,userId:t.id}),i.success(m("{{userName}} was added to the group",{userName:t.name}),{icon:r(R,{model:t,size:U.Toast})})}catch(o){i.error(m("Could not add user"))}}),[m,d,e.id]),A=s.useCallback((()=>{const e=g();a.openModal({id:e,title:m("Invite people"),content:r(H,{onSubmit:()=>a.closeModal(e)})})}),[m,a]),{loading:G}=W(s.useCallback((()=>d.fetchAll({id:e.id})),[d,e]),!0);return o(l,{column:!0,children:[o(c,{as:"p",type:"secondary",children:[m("Add members below to give them access to the group. Need to add someone who’s not yet a member?")," ",C.inviteUser?r(_,{onClick:A,children:m("Invite them to {{teamName}}",{teamName:y.name})}):m("Ask an admin to invite them first"),"."]}),r(b,{type:"search",placeholder:`${m("Search by name")}…`,value:v,onChange:w,label:m("Search people"),labelHidden:!0,autoFocus:!0,flex:!0}),G?r(f,{children:r(Y,{count:5})}):r(O,{empty:r(p,v?{children:m("No people matching your search")}:{children:m("No people left to add")}),items:u.notInGroup(e.id,v),fetch:v?void 0:u.fetchPage,renderItem:e=>r(ie,{user:e,onAdd:()=>j(e)},e.id)})]})})),ie=e((function({user:e,onRemove:n,onAdd:s}){const{t:i}=t();return r(X,{title:e.name,subtitle:o(a,{children:[e.lastActiveAt?o(u,{children:["Active ",r(te,{dateTime:e.lastActiveAt})," ago"]}):i("Never signed in"),e.isInvited&&r(Z,{children:i("Invited")}),e.isAdmin&&r(Z,{primary:e.isAdmin,children:i("Admin")})]}),image:r(R,{model:e,size:U.Large}),actions:o(l,{align:"center",children:[n&&r(re,{onRemove:n}),s&&r(d,{onClick:s,neutral:!0,children:i("Add")})]})})}));const le=e((function GroupMenu({group:e}){const{t:s}=t(),{dialogs:i}=n(),l=K({modal:!0}),c=E(e),u=C.useCallback((()=>{i.openModal({title:s("Group members"),content:r(ne,{group:e}),fullscreen:!0})}),[s,e,i]),d=C.useCallback((()=>{i.openModal({title:s("Edit group"),content:r(EditGroupDialog,{group:e,onSubmit:i.closeAllModals})})}),[s,e,i]),p=C.useCallback((()=>{i.openModal({title:s("Delete group"),content:r(DeleteGroupDialog,{group:e,onSubmit:i.closeAllModals})})}),[s,e,i]);return o(a,{children:[r(Q,{"aria-label":s("Show menu"),...l}),r(oe,{...l,"aria-label":s("Group options"),children:r(V,{...l,items:[{type:"button",title:`${s("Members")}…`,icon:r(m.GroupIcon,{}),onClick:u,visible:!(!e||!c.read)},{type:"separator"},{type:"button",title:`${s("Edit")}…`,icon:r(m.EditIcon,{}),onClick:d,visible:!(!e||!c.update)},{type:"button",title:`${s("Delete")}…`,icon:r(m.TrashIcon,{}),dangerous:!0,onClick:p,visible:!(!e||!c.delete)},{type:"separator"},{type:"link",href:"",title:e.externalId,disabled:!0,visible:!!e.externalId}]})})]})})),ce=F+$;function GroupsTable(e){const{t:a}=t(),{dialogs:i}=n(),d=s.useCallback((e=>{i.openModal({title:a("Group members"),content:r(ne,{group:e}),fullscreen:!0})}),[a,i]),p=s.useMemo((()=>w([{type:"data",id:"name",header:a("Name"),accessor:e=>e.name,component:e=>o(l,{align:"center",gap:8,children:[r(ue,{children:r(m.GroupIcon,{size:24})}),o(l,{column:!0,children:[r(de,{onClick:()=>d(e),children:e.name}),r(c,{type:"tertiary",size:"small",children:r(u,{defaults:"{{ count }} member",values:{count:e.memberCount}})})]})]}),width:"2fr"},{type:"data",id:"members",header:a("Members"),accessor:e=>`${e.memberCount} members`,component:e=>{const t=e.users.slice(0,j),o=e.memberCount-t.length;return r(l,{children:r(ae,{users:t,overflow:o})})},width:"1fr",sortable:!1},{type:"data",id:"createdAt",header:a("Date created"),accessor:e=>e.createdAt,component:e=>e.createdAt?r(te,{dateTime:e.createdAt,addSuffix:!0}):null,width:"1fr"},{type:"action",id:"action",component:e=>r(le,{group:e}),width:"50px"}])),[a,d]);return r(L,{columns:p,rowHeight:60,stickyOffset:ce,...e})}const ue=v(l).withConfig({componentId:"sc-34i7j-0"})(["align-items:center;justify-content:center;width:32px;height:32px;background:",";border-radius:32px;"],S("backgroundSecondary")),de=v.span.withConfig({componentId:"sc-34i7j-1"})(["&:","{text-decoration:underline;cursor:var(--pointer);}"],k);function getFilteredGroups(e,t){if(!t?.length)return e;const o=M(t.toLocaleLowerCase());return e.filter((e=>M(e.name).toLocaleLowerCase().includes(o)))}const me=e((function Groups(){const{t:e}=t(),{dialogs:s,groups:l}=n(),h=q(),g=E(h),b=A(),f=G(),y=I(),[v,S]=C.useState(""),k=C.useMemo((()=>({query:y.get("query")||void 0,sort:y.get("sort")||"name",direction:(y.get("direction")||"asc").toUpperCase()})),[y]),w=C.useMemo((()=>({id:k.sort,desc:"DESC"===k.direction})),[k.sort,k.direction]),{data:j,error:M,loading:F,next:L}=z({data:getFilteredGroups(l.orderedData,k.query),sort:w,reqFn:l.fetchPage,reqParams:k}),$=!F&&!l.orderedData.length,H=C.useCallback((e=>{e?y.set("query",e):y.delete("query"),b.replace({pathname:f.pathname,search:y.toString()})}),[y,b,f.pathname]),R=C.useCallback((e=>{const{value:t}=e.target;S(t)}),[]),U=C.useCallback((()=>{s.openModal({title:e("Create a group"),content:r(CreateGroupDialog,{})})}),[e,s]);return C.useEffect((()=>{M&&i.error(e("Could not load groups"))}),[e,M]),C.useEffect((()=>{const e=setTimeout((()=>H(v)),250);return()=>clearTimeout(e)}),[v,H]),o(P,{title:e("Groups"),icon:r(m.GroupIcon,{}),actions:r(a,{children:g.createGroup&&r(T,{children:r(d,{type:"button",onClick:U,icon:r(m.PlusIcon,{}),children:`${e("New group")}…`})})}),wide:!0,children:[r(x,{children:e("Groups")}),r(c,{as:"p",type:"secondary",children:r(u,{children:"Groups can be used to organize and manage the people on your team."})}),$?r(p,{children:e("No groups have been created yet")}):o(a,{children:[r(B,{children:r(N,{value:v,placeholder:`${e("Filter")}…`,onChange:R})}),r(D,{animate:!j,children:r(GroupsTable,{data:j??[],sort:w,loading:F,page:{hasNext:!!L,fetchNext:L}})})]})]})}));export{me as default};
