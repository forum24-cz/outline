{"version":3,"file":"DocumentListItem.b25IHz8z.js","sources":["../../../app/components/DocumentListItem.tsx"],"sourcesContent":["import {\n  useFocusEffect,\n  useRovingTabIndex,\n} from \"@getoutline/react-roving-tabindex\";\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link } from \"react-router-dom\";\nimport styled, { css } from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport EventBoundary from \"@shared/components/EventBoundary\";\nimport Icon from \"@shared/components/Icon\";\nimport { s, hover } from \"@shared/styles\";\nimport Document from \"~/models/Document\";\nimport Badge from \"~/components/Badge\";\nimport DocumentMeta from \"~/components/DocumentMeta\";\nimport Flex from \"~/components/Flex\";\nimport Highlight from \"~/components/Highlight\";\nimport NudeButton from \"~/components/NudeButton\";\nimport StarButton, { AnimatedStar } from \"~/components/Star\";\nimport Tooltip from \"~/components/Tooltip\";\nimport useBoolean from \"~/hooks/useBoolean\";\nimport useCurrentUser from \"~/hooks/useCurrentUser\";\nimport { useLocationSidebarContext } from \"~/hooks/useLocationSidebarContext\";\nimport DocumentMenu from \"~/menus/DocumentMenu\";\nimport { documentPath } from \"~/utils/routeHelpers\";\nimport { determineSidebarContext } from \"./Sidebar/components/SidebarContext\";\n\ntype Props = {\n  document: Document;\n  highlight?: string | undefined;\n  context?: string | undefined;\n  showParentDocuments?: boolean;\n  showCollection?: boolean;\n  showPublished?: boolean;\n  showPin?: boolean;\n  showDraft?: boolean;\n  showTemplate?: boolean;\n};\n\nconst SEARCH_RESULT_REGEX = /<b\\b[^>]*>(.*?)<\\/b>/gi;\n\nfunction replaceResultMarks(tag: string) {\n  // don't use SEARCH_RESULT_REGEX directly here as it causes an infinite loop\n  return tag.replace(new RegExp(SEARCH_RESULT_REGEX.source), \"$1\");\n}\n\nfunction DocumentListItem(\n  props: Props,\n  ref: React.RefObject<HTMLAnchorElement>\n) {\n  const { t } = useTranslation();\n  const user = useCurrentUser();\n  const locationSidebarContext = useLocationSidebarContext();\n  const [menuOpen, handleMenuOpen, handleMenuClose] = useBoolean();\n\n  let itemRef: React.Ref<HTMLAnchorElement> =\n    React.useRef<HTMLAnchorElement>(null);\n  if (ref) {\n    itemRef = ref;\n  }\n\n  const { focused, ...rovingTabIndex } = useRovingTabIndex(itemRef, false);\n  useFocusEffect(focused, itemRef);\n\n  const {\n    document,\n    showParentDocuments,\n    showCollection,\n    showPublished,\n    showPin,\n    showDraft = true,\n    showTemplate,\n    highlight,\n    context,\n    ...rest\n  } = props;\n  const queryIsInTitle =\n    !!highlight &&\n    !!document.title.toLowerCase().includes(highlight.toLowerCase());\n  const canStar = !document.isArchived && !document.isTemplate;\n\n  const sidebarContext = determineSidebarContext({\n    document,\n    user,\n    currentContext: locationSidebarContext,\n  });\n\n  return (\n    <DocumentLink\n      ref={itemRef}\n      dir={document.dir}\n      role=\"menuitem\"\n      $isStarred={document.isStarred}\n      $menuOpen={menuOpen}\n      to={{\n        pathname: documentPath(document),\n        state: {\n          title: document.titleWithDefault,\n          sidebarContext,\n        },\n      }}\n      {...rest}\n      {...rovingTabIndex}\n    >\n      <Content>\n        <Heading dir={document.dir}>\n          {document.icon && (\n            <>\n              <Icon value={document.icon} color={document.color ?? undefined} />\n              &nbsp;\n            </>\n          )}\n          <Title\n            text={document.titleWithDefault}\n            highlight={highlight}\n            dir={document.dir}\n          />\n          {document.isBadgedNew && document.createdBy?.id !== user.id && (\n            <Badge yellow>{t(\"New\")}</Badge>\n          )}\n          {document.isDraft && showDraft && (\n            <Tooltip content={t(\"Only visible to you\")} placement=\"top\">\n              <Badge>{t(\"Draft\")}</Badge>\n            </Tooltip>\n          )}\n          {canStar && (\n            <StarPositioner>\n              <StarButton document={document} />\n            </StarPositioner>\n          )}\n          {document.isTemplate && showTemplate && (\n            <Badge primary>{t(\"Template\")}</Badge>\n          )}\n        </Heading>\n\n        {!queryIsInTitle && (\n          <ResultContext\n            text={context}\n            highlight={highlight ? SEARCH_RESULT_REGEX : undefined}\n            processResult={replaceResultMarks}\n          />\n        )}\n        <DocumentMeta\n          document={document}\n          showCollection={showCollection}\n          showPublished={showPublished}\n          showParentDocuments={showParentDocuments}\n          showLastViewed\n        />\n      </Content>\n      <Actions>\n        <DocumentMenu\n          document={document}\n          showPin={showPin}\n          onOpen={handleMenuOpen}\n          onClose={handleMenuClose}\n          modal={false}\n        />\n      </Actions>\n    </DocumentLink>\n  );\n}\n\nconst Content = styled.div`\n  flex-grow: 1;\n  flex-shrink: 1;\n  min-width: 0;\n`;\n\nconst Actions = styled(EventBoundary)`\n  display: none;\n  align-items: center;\n  margin: 8px;\n  flex-shrink: 0;\n  flex-grow: 0;\n  color: ${s(\"textSecondary\")};\n\n  ${NudeButton} {\n    &: ${hover}, &[aria-expanded= \"true\"] {\n      background: ${s(\"sidebarControlHoverBackground\")};\n    }\n  }\n\n  ${breakpoint(\"tablet\")`\n    display: flex;\n  `};\n`;\n\nconst DocumentLink = styled(Link)<{\n  $isStarred?: boolean;\n  $menuOpen?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  margin: 10px -8px;\n  padding: 6px 8px;\n  border-radius: 8px;\n  max-height: 50vh;\n  width: calc(100vw - 8px);\n  cursor: var(--pointer);\n\n  &:focus-visible {\n    outline: none;\n  }\n\n  ${breakpoint(\"tablet\")`\n    width: auto;\n  `};\n\n  ${Actions} {\n    opacity: 0;\n  }\n\n  ${AnimatedStar} {\n    opacity: ${(props) => (props.$isStarred ? \"1 !important\" : 0)};\n  }\n\n  &:${hover},\n  &:active,\n  &:focus,\n  &:focus-within {\n    background: ${s(\"listItemHoverBackground\")};\n\n    ${Actions} {\n      opacity: 1;\n    }\n\n    ${AnimatedStar} {\n      opacity: 0.5;\n\n      &:${hover} {\n        opacity: 1;\n      }\n    }\n  }\n\n  ${(props) =>\n    props.$menuOpen &&\n    css`\n      background: ${s(\"listItemHoverBackground\")};\n\n      ${Actions} {\n        opacity: 1;\n      }\n\n      ${AnimatedStar} {\n        opacity: 0.5;\n      }\n    `}\n`;\n\nconst Heading = styled.h3<{ rtl?: boolean }>`\n  display: flex;\n  justify-content: ${(props) => (props.rtl ? \"flex-end\" : \"flex-start\")};\n  align-items: center;\n  margin-top: 0;\n  margin-bottom: 0.25em;\n  white-space: nowrap;\n  color: ${s(\"text\")};\n  font-family: ${s(\"fontFamily\")};\n  font-weight: 500;\n`;\n\nconst StarPositioner = styled(Flex)`\n  margin-left: 4px;\n  align-items: center;\n`;\n\nconst Title = styled(Highlight)`\n  max-width: 90%;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst ResultContext = styled(Highlight)`\n  display: block;\n  color: ${s(\"textSecondary\")};\n  font-size: 15px;\n  margin-top: -0.25em;\n  margin-bottom: 0.25em;\n  max-height: 90px;\n  overflow: hidden;\n`;\n\nexport default observer(React.forwardRef(DocumentListItem));\n"],"names":["SEARCH_RESULT_REGEX","replaceResultMarks","tag","replace","RegExp","source","Content","styled","div","withConfig","componentId","Actions","EventBoundary","s","NudeButton","hover","breakpoint","DocumentLink","Link","AnimatedStar","props","$isStarred","$menuOpen","css","Heading","h3","rtl","StarPositioner","Flex","Title","Highlight","ResultContext","DocumentListItem$1","observer","React","DocumentListItem","ref","t","useTranslation","user","useCurrentUser","locationSidebarContext","useLocationSidebarContext","menuOpen","handleMenuOpen","handleMenuClose","useBoolean","itemRef","focused","rovingTabIndex","useRovingTabIndex","useFocusEffect","document","showParentDocuments","showCollection","showPublished","showPin","showDraft","showTemplate","highlight","context","rest","queryIsInTitle","title","toLowerCase","includes","canStar","isArchived","isTemplate","sidebarContext","determineSidebarContext","currentContext","jsxs","dir","role","isStarred","to","pathname","documentPath","state","titleWithDefault","children","icon","Fragment","jsx","Icon","value","color","undefined","text","isBadgedNew","createdBy","id","Badge","yellow","isDraft","Tooltip","content","placement","StarButton","primary","processResult","DocumentMeta","showLastViewed","DocumentMenu","onOpen","onClose","modal"],"mappings":"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"}