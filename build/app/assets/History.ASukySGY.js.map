{"version":3,"file":"History.ASukySGY.js","sources":["../../../app/menus/RevisionMenu.tsx","../../../app/components/EventListItem.tsx","../../../app/components/PaginatedEventList.tsx","../../../app/scenes/Document/components/History.tsx"],"sourcesContent":["import { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMenuState } from \"reakit/Menu\";\nimport Document from \"~/models/Document\";\nimport ContextMenu from \"~/components/ContextMenu\";\nimport OverflowMenuButton from \"~/components/ContextMenu/OverflowMenuButton\";\nimport Template from \"~/components/ContextMenu/Template\";\nimport { actionToMenuItem } from \"~/actions\";\nimport {\n  copyLinkToRevision,\n  restoreRevision,\n} from \"~/actions/definitions/revisions\";\nimport useActionContext from \"~/hooks/useActionContext\";\nimport separator from \"./separator\";\n\ntype Props = {\n  document: Document;\n  revisionId: string;\n  className?: string;\n};\n\nfunction RevisionMenu({ document, className }: Props) {\n  const menu = useMenuState({\n    modal: true,\n  });\n  const { t } = useTranslation();\n  const context = useActionContext({\n    activeDocumentId: document.id,\n  });\n\n  return (\n    <>\n      <OverflowMenuButton\n        className={className}\n        aria-label={t(\"Show menu\")}\n        {...menu}\n      />\n      <ContextMenu {...menu} aria-label={t(\"Revision options\")}>\n        <Template\n          {...menu}\n          items={[\n            actionToMenuItem(restoreRevision, context),\n            separator(),\n            actionToMenuItem(copyLinkToRevision, context),\n          ]}\n        />\n      </ContextMenu>\n    </>\n  );\n}\n\nexport default observer(RevisionMenu);\n","import { LocationDescriptor } from \"history\";\nimport { observer } from \"mobx-react\";\nimport {\n  TrashIcon,\n  ArchiveIcon,\n  EditIcon,\n  PublishIcon,\n  MoveIcon,\n  UnpublishIcon,\n  RestoreIcon,\n  UserIcon,\n  CrossIcon,\n} from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation } from \"react-router-dom\";\nimport styled, { css } from \"styled-components\";\nimport EventBoundary from \"@shared/components/EventBoundary\";\nimport { s, hover } from \"@shared/styles\";\nimport { RevisionHelper } from \"@shared/utils/RevisionHelper\";\nimport Document from \"~/models/Document\";\nimport { Avatar, AvatarSize } from \"~/components/Avatar\";\nimport Item, { Actions } from \"~/components/List/Item\";\nimport Time from \"~/components/Time\";\nimport { useLocationSidebarContext } from \"~/hooks/useLocationSidebarContext\";\nimport useStores from \"~/hooks/useStores\";\nimport RevisionMenu from \"~/menus/RevisionMenu\";\nimport Logger from \"~/utils/Logger\";\nimport { documentHistoryPath } from \"~/utils/routeHelpers\";\nimport Text from \"./Text\";\n\nexport type RevisionEvent = {\n  name: \"revisions.create\";\n  latest: boolean;\n};\n\nexport type DocumentEvent = {\n  name:\n    | \"documents.publish\"\n    | \"documents.unpublish\"\n    | \"documents.archive\"\n    | \"documents.unarchive\"\n    | \"documents.delete\"\n    | \"documents.restore\"\n    | \"documents.add_user\"\n    | \"documents.remove_user\"\n    | \"documents.move\";\n  userId: string;\n};\n\nexport type Event = { id: string; actorId: string; createdAt: string } & (\n  | RevisionEvent\n  | DocumentEvent\n);\n\ntype Props = {\n  document: Document;\n  event: Event;\n};\n\nconst EventListItem = ({ event, document, ...rest }: Props) => {\n  const { t } = useTranslation();\n  const { revisions, users } = useStores();\n  const actor = \"actorId\" in event ? users.get(event.actorId) : undefined;\n  const user = \"userId\" in event ? users.get(event.userId) : undefined;\n  const location = useLocation();\n  const sidebarContext = useLocationSidebarContext();\n  const revisionLoadedRef = React.useRef(false);\n  const opts = {\n    userName: actor?.name,\n  };\n  const isRevision = event.name === \"revisions.create\";\n  const isDerivedFromDocument =\n    event.id === RevisionHelper.latestId(document.id);\n  let meta, icon, to: LocationDescriptor | undefined;\n\n  const ref = React.useRef<HTMLAnchorElement>(null);\n  // the time component tends to steal focus when clicked\n  // ...so forward the focus back to the parent item\n  const handleTimeClick = () => {\n    ref.current?.focus();\n  };\n\n  const prefetchRevision = async () => {\n    if (\n      !document.isDeleted &&\n      event.name === \"revisions.create\" &&\n      !isDerivedFromDocument &&\n      !revisionLoadedRef.current\n    ) {\n      await revisions.fetch(event.id, { force: true });\n      revisionLoadedRef.current = true;\n    }\n  };\n\n  switch (event.name) {\n    case \"revisions.create\":\n      icon = <EditIcon size={16} />;\n      meta = event.latest ? (\n        <>\n          {t(\"Current version\")} &middot; {actor?.name}\n        </>\n      ) : (\n        t(\"{{userName}} edited\", opts)\n      );\n      to = {\n        pathname: documentHistoryPath(\n          document,\n          isDerivedFromDocument ? \"latest\" : event.id\n        ),\n        state: {\n          sidebarContext,\n          retainScrollPosition: true,\n        },\n      };\n      break;\n\n    case \"documents.archive\":\n      icon = <ArchiveIcon />;\n      meta = t(\"{{userName}} archived\", opts);\n      break;\n\n    case \"documents.unarchive\":\n      icon = <RestoreIcon />;\n      meta = t(\"{{userName}} restored\", opts);\n      break;\n\n    case \"documents.delete\":\n      icon = <TrashIcon />;\n      meta = t(\"{{userName}} deleted\", opts);\n      break;\n    case \"documents.add_user\":\n      icon = <UserIcon />;\n      meta = t(\"{{userName}} added {{addedUserName}}\", {\n        ...opts,\n        addedUserName: user?.name ?? t(\"a user\"),\n      });\n      break;\n    case \"documents.remove_user\":\n      icon = <CrossIcon />;\n      meta = t(\"{{userName}} removed {{removedUserName}}\", {\n        ...opts,\n        removedUserName: user?.name ?? t(\"a user\"),\n      });\n      break;\n\n    case \"documents.restore\":\n      icon = <RestoreIcon />;\n      meta = t(\"{{userName}} moved from trash\", opts);\n      break;\n\n    case \"documents.publish\":\n      icon = <PublishIcon />;\n      meta = t(\"{{userName}} published\", opts);\n      break;\n\n    case \"documents.unpublish\":\n      icon = <UnpublishIcon />;\n      meta = t(\"{{userName}} unpublished\", opts);\n      break;\n\n    case \"documents.move\":\n      icon = <MoveIcon />;\n      meta = t(\"{{userName}} moved\", opts);\n      break;\n\n    default:\n      Logger.warn(\"Unhandled event\", { event });\n  }\n\n  if (!meta) {\n    return null;\n  }\n\n  const isActive =\n    typeof to === \"string\"\n      ? location.pathname === to\n      : location.pathname === to?.pathname;\n\n  if (document.isDeleted) {\n    to = undefined;\n  }\n\n  return event.name === \"revisions.create\" ? (\n    <RevisionItem\n      small\n      exact\n      to={to}\n      title={\n        <Time\n          dateTime={event.createdAt}\n          format={{\n            en_US: \"MMM do, h:mm a\",\n            fr_FR: \"'Le 'd MMMM 'Ã ' H:mm\",\n          }}\n          relative={false}\n          addSuffix\n          onClick={handleTimeClick}\n        />\n      }\n      image={<Avatar model={actor} size={AvatarSize.Large} />}\n      subtitle={meta}\n      actions={\n        isRevision && isActive && !event.latest ? (\n          <StyledEventBoundary>\n            <RevisionMenu document={document} revisionId={event.id} />\n          </StyledEventBoundary>\n        ) : undefined\n      }\n      onMouseEnter={prefetchRevision}\n      ref={ref}\n      {...rest}\n    />\n  ) : (\n    <EventItem>\n      <IconWrapper size=\"xsmall\" type=\"secondary\">\n        {icon}\n      </IconWrapper>\n      <Text size=\"xsmall\" type=\"secondary\">\n        {meta} &middot;{\" \"}\n        <Time dateTime={event.createdAt} relative shorten addSuffix />\n      </Text>\n    </EventItem>\n  );\n};\n\nconst lineStyle = css`\n  &::before {\n    content: \"\";\n    display: block;\n    position: absolute;\n    top: -8px;\n    left: 22px;\n    width: 1px;\n    height: calc(50% - 14px + 8px);\n    background: ${s(\"divider\")};\n    mix-blend-mode: ${(props) => (props.theme.isDark ? \"lighten\" : \"multiply\")};\n    z-index: 1;\n  }\n\n  &:first-child::before {\n    display: none;\n  }\n\n  &:nth-child(2)::before {\n    display: none;\n  }\n\n  &::after {\n    content: \"\";\n    display: block;\n    position: absolute;\n    top: calc(50% + 14px);\n    left: 22px;\n    width: 1px;\n    height: calc(50% - 14px);\n    background: ${s(\"divider\")};\n    mix-blend-mode: ${(props) => (props.theme.isDark ? \"lighten\" : \"multiply\")};\n    z-index: 1;\n  }\n\n  &:last-child::after {\n    display: none;\n  }\n\n  h3 + &::before {\n    display: none;\n  }\n`;\n\nconst IconWrapper = styled(Text)`\n  height: 24px;\n`;\n\nconst EventItem = styled.li`\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  list-style: none;\n  margin: 8px 0;\n  padding: 4px 10px;\n  white-space: nowrap;\n  position: relative;\n\n  time {\n    white-space: nowrap;\n  }\n\n  svg {\n    flex-shrink: 0;\n  }\n\n  ${lineStyle}\n`;\n\nconst StyledEventBoundary = styled(EventBoundary)`\n  height: 24px;\n`;\n\nconst RevisionItem = styled(Item)`\n  border: 0;\n  position: relative;\n  margin: 8px 0;\n  padding: 8px;\n  border-radius: 8px;\n\n  ${lineStyle}\n\n  ${Actions} {\n    opacity: 0.5;\n\n    &: ${hover} {\n      opacity: 1;\n    }\n  }\n`;\n\nexport default observer(EventListItem);\n","import * as React from \"react\";\nimport styled from \"styled-components\";\nimport Document from \"~/models/Document\";\nimport PaginatedList from \"~/components/PaginatedList\";\nimport EventListItem, { type Event } from \"./EventListItem\";\n\ntype Props = {\n  events: Event[];\n  document: Document;\n  fetch: (options: Record<string, any> | undefined) => Promise<Event[]>;\n  options?: Record<string, any>;\n  heading?: React.ReactNode;\n  empty?: React.ReactNode;\n};\n\nconst PaginatedEventList = React.memo<Props>(function PaginatedEventList({\n  empty,\n  heading,\n  events,\n  fetch,\n  options,\n  document,\n  ...rest\n}: Props) {\n  return (\n    <StyledPaginatedList\n      items={events}\n      empty={empty}\n      heading={heading}\n      fetch={fetch}\n      options={options}\n      renderItem={(item: Event) => (\n        <EventListItem key={item.id} event={item} document={document} />\n      )}\n      renderHeading={(name) => <Heading>{name}</Heading>}\n      {...rest}\n    />\n  );\n});\n\nconst StyledPaginatedList = styled(PaginatedList)`\n  padding: 0 12px;\n`;\n\nconst Heading = styled(\"h3\")`\n  font-size: 15px;\n  padding: 0 4px;\n`;\n\nexport default PaginatedEventList;\n","import isEqual from \"fast-deep-equal\";\nimport orderBy from \"lodash/orderBy\";\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory, useRouteMatch } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { Pagination } from \"@shared/constants\";\nimport { RevisionHelper } from \"@shared/utils/RevisionHelper\";\nimport Document from \"~/models/Document\";\nimport EventModel from \"~/models/Event\";\nimport Revision from \"~/models/Revision\";\nimport Empty from \"~/components/Empty\";\nimport { DocumentEvent, type Event } from \"~/components/EventListItem\";\nimport PaginatedEventList from \"~/components/PaginatedEventList\";\nimport useKeyDown from \"~/hooks/useKeyDown\";\nimport { useLocationSidebarContext } from \"~/hooks/useLocationSidebarContext\";\nimport useStores from \"~/hooks/useStores\";\nimport { documentPath } from \"~/utils/routeHelpers\";\nimport Sidebar from \"./SidebarLayout\";\n\nconst DocumentEvents = [\n  \"documents.publish\",\n  \"documents.unpublish\",\n  \"documents.archive\",\n  \"documents.unarchive\",\n  \"documents.delete\",\n  \"documents.restore\",\n  \"documents.add_user\",\n  \"documents.remove_user\",\n  \"documents.move\",\n];\n\nfunction History() {\n  const { events, documents, revisions } = useStores();\n  const { t } = useTranslation();\n  const match = useRouteMatch<{ documentSlug: string }>();\n  const history = useHistory();\n  const sidebarContext = useLocationSidebarContext();\n  const document = documents.getByUrl(match.params.documentSlug);\n\n  const [, setForceRender] = React.useState(0);\n  const offset = React.useMemo(() => ({ revisions: 0, events: 0 }), []);\n\n  const toEvent = React.useCallback(\n    (data: Revision | EventModel<Document>): Event => {\n      if (data instanceof Revision) {\n        return {\n          id: data.id,\n          name: \"revisions.create\",\n          actorId: data.createdBy.id,\n          createdAt: data.createdAt,\n          latest: false,\n        } satisfies Event;\n      }\n\n      return {\n        id: data.id,\n        name: data.name as DocumentEvent[\"name\"],\n        actorId: data.actorId,\n        userId: data.userId,\n        createdAt: data.createdAt,\n      } satisfies Event;\n    },\n    []\n  );\n\n  const fetchHistory = React.useCallback(async () => {\n    if (!document) {\n      return [];\n    }\n\n    const [revisionsArr, eventsArr] = await Promise.all([\n      revisions.fetchPage({\n        documentId: document.id,\n        offset: offset.revisions,\n        limit: Pagination.defaultLimit,\n      }),\n      events.fetchPage({\n        events: DocumentEvents,\n        documentId: document.id,\n        offset: offset.events,\n        limit: Pagination.defaultLimit,\n      }),\n    ]);\n\n    const pageEvents = orderBy(\n      [...revisionsArr, ...eventsArr].map(toEvent),\n      \"createdAt\",\n      \"desc\"\n    ).slice(0, Pagination.defaultLimit);\n\n    const revisionsCount = pageEvents.filter(\n      (event) => event.name === \"revisions.create\"\n    ).length;\n\n    offset.revisions += revisionsCount;\n    offset.events += pageEvents.length - revisionsCount;\n\n    // needed to re-render after mobx store and offset is updated\n    setForceRender((s) => ++s);\n\n    return pageEvents;\n  }, [document, revisions, events, toEvent, offset]);\n\n  const revisionEvents = React.useMemo(() => {\n    if (!document) {\n      return [];\n    }\n\n    const latestRevisionId = RevisionHelper.latestId(document.id);\n    return revisions\n      .filter(\n        (revision: Revision) =>\n          revision.id !== latestRevisionId &&\n          revision.documentId === document.id\n      )\n      .slice(0, offset.revisions)\n      .map(toEvent);\n  }, [document, revisions, offset.revisions, toEvent]);\n\n  const nonRevisionEvents = React.useMemo(\n    () =>\n      document\n        ? events\n            .filter({ documentId: document.id })\n            .slice(0, offset.events)\n            .map(toEvent)\n        : [],\n    [document, events, offset.events, toEvent]\n  );\n\n  const mergedEvents = React.useMemo(() => {\n    const merged = orderBy(\n      [...revisionEvents, ...nonRevisionEvents],\n      \"createdAt\",\n      \"desc\"\n    );\n\n    const latestRevisionEvent = merged.find(\n      (event) => event.name === \"revisions.create\"\n    );\n\n    if (latestRevisionEvent && document) {\n      const latestRevision = revisions.get(latestRevisionEvent.id);\n\n      const isDocUpdated =\n        latestRevision?.title !== document.title ||\n        !isEqual(latestRevision.data, document.data);\n\n      if (isDocUpdated) {\n        revisions.remove(RevisionHelper.latestId(document.id));\n        merged.unshift({\n          id: RevisionHelper.latestId(document.id),\n          name: \"revisions.create\",\n          createdAt: document.updatedAt,\n          actorId: document.updatedBy?.id ?? \"\",\n          latest: true,\n        });\n      } else if (latestRevisionEvent) {\n        latestRevisionEvent.latest = true;\n      }\n    }\n\n    return merged;\n  }, [revisions, document, revisionEvents, nonRevisionEvents]);\n\n  const onCloseHistory = React.useCallback(() => {\n    if (document) {\n      history.push({\n        pathname: documentPath(document),\n        state: { sidebarContext },\n      });\n    } else {\n      history.goBack();\n    }\n  }, [history, document, sidebarContext]);\n\n  useKeyDown(\"Escape\", onCloseHistory);\n\n  return (\n    <Sidebar title={t(\"History\")} onClose={onCloseHistory}>\n      {document ? (\n        <PaginatedEventList\n          aria-label={t(\"History\")}\n          fetch={fetchHistory}\n          events={mergedEvents}\n          document={document}\n          empty={<EmptyHistory>{t(\"No history yet\")}</EmptyHistory>}\n        />\n      ) : null}\n    </Sidebar>\n  );\n}\n\nconst EmptyHistory = styled(Empty)`\n  padding: 0 12px;\n`;\n\nexport default observer(History);\n"],"names":["observer","RevisionMenu","document","className","menu","useMenuState","modal","t","useTranslation","context","useActionContext","activeDocumentId","id","jsxs","Fragment","children","jsx","OverflowMenuButton","ContextMenu","Template","items","actionToMenuItem","restoreRevision","separator","copyLinkToRevision","lineStyle","css","s","props","theme","isDark","IconWrapper","styled","Text","withConfig","componentId","EventItem","li","StyledEventBoundary","EventBoundary","RevisionItem","Item","Actions","hover","EventListItem","event","rest","revisions","users","useStores","actor","get","actorId","undefined","user","userId","location","useLocation","sidebarContext","useLocationSidebarContext","revisionLoadedRef","React","opts","userName","name","isRevision","isDerivedFromDocument","RevisionHelper","latestId","meta","icon","to","ref","EditIcon","size","latest","pathname","documentHistoryPath","state","retainScrollPosition","ArchiveIcon","RestoreIcon","TrashIcon","UserIcon","addedUserName","CrossIcon","removedUserName","PublishIcon","UnpublishIcon","MoveIcon","Logger","warn","isActive","isDeleted","small","exact","title","Time","dateTime","createdAt","format","en_US","fr_FR","relative","addSuffix","onClick","handleTimeClick","current","focus","image","Avatar","model","AvatarSize","Large","subtitle","actions","revisionId","onMouseEnter","async","fetch","force","type","shorten","PaginatedEventList","empty","heading","events","options","StyledPaginatedList","renderItem","item","renderHeading","Heading","PaginatedList","DocumentEvents","EmptyHistory","Empty","History","documents","match","useRouteMatch","history","useHistory","getByUrl","params","documentSlug","setForceRender","offset","toEvent","data","Revision","createdBy","fetchHistory","revisionsArr","eventsArr","Promise","all","fetchPage","documentId","limit","Pagination","defaultLimit","pageEvents","orderBy","map","slice","revisionsCount","filter","length","revisionEvents","latestRevisionId","revision","nonRevisionEvents","useMemo","mergedEvents","merged","latestRevisionEvent","find","latestRevision","isEqual","remove","unshift","updatedAt","updatedBy","onCloseHistory","push","documentPath","goBack","useKeyDown","Sidebar","onClose"],"mappings":"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"}