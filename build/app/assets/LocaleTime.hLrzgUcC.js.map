{"version":3,"file":"LocaleTime.hLrzgUcC.js","sources":["../../../app/hooks/useLocaleTime.ts","../../../app/components/LocaleTime.tsx"],"sourcesContent":["import { format as formatDate } from \"date-fns\";\nimport * as React from \"react\";\nimport { dateLocale, dateToRelative, locales } from \"@shared/utils/date\";\nimport useUserLocale from \"~/hooks/useUserLocale\";\n\nlet callbacks: (() => void)[] = [];\n\n// This is a shared timer that fires every minute, used for\n// updating all Time components across the page all at once.\nsetInterval(() => {\n  callbacks.forEach((cb) => cb());\n}, 1000 * 60);\n\nfunction eachMinute(fn: () => void) {\n  callbacks.push(fn);\n\n  return () => {\n    callbacks = callbacks.filter((cb) => cb !== fn);\n  };\n}\n\nexport type Props = {\n  dateTime: string;\n  addSuffix?: boolean;\n  shorten?: boolean;\n  relative?: boolean;\n  format?: Partial<Record<keyof typeof locales, string>>;\n};\n\nexport const useLocaleTime = ({\n  addSuffix,\n  dateTime,\n  shorten,\n  format,\n  relative,\n}: Props) => {\n  const userLocale = useUserLocale();\n  const dateFormatLong: Record<string, string> = {\n    en_US: \"MMMM do, yyyy h:mm a\",\n    fr_FR: \"'Le 'd MMMM yyyy 'Ã ' H:mm\",\n  };\n  const formatLocaleLong =\n    (userLocale ? dateFormatLong[userLocale] : undefined) ??\n    \"MMMM do, yyyy h:mm a\";\n  // @ts-expect-error fallback to formatLocaleLong\n  const formatLocale = format?.[userLocale] ?? formatLocaleLong;\n  const [_, setMinutesMounted] = React.useState(0); // eslint-disable-line @typescript-eslint/no-unused-vars\n  const callback = React.useRef<() => void>();\n\n  React.useEffect(() => {\n    callback.current = eachMinute(() => {\n      setMinutesMounted((state) => ++state);\n    });\n    return () => {\n      if (callback.current) {\n        callback.current?.();\n      }\n    };\n  }, []);\n\n  const date = new Date(Date.parse(dateTime));\n  const locale = dateLocale(userLocale);\n  const relativeContent = dateToRelative(date, {\n    addSuffix,\n    locale,\n    shorten,\n  });\n\n  const tooltipContent = formatDate(date, formatLocaleLong, {\n    locale,\n  });\n  const content =\n    relative !== false\n      ? relativeContent\n      : formatDate(date, formatLocale, {\n          locale,\n        });\n\n  return {\n    content,\n    tooltipContent,\n  };\n};\n","import * as React from \"react\";\nimport { locales } from \"@shared/utils/date\";\nimport Tooltip from \"~/components/Tooltip\";\nimport { useLocaleTime } from \"~/hooks/useLocaleTime\";\n\nexport type Props = {\n  children?: React.ReactNode;\n  dateTime: string;\n  addSuffix?: boolean;\n  shorten?: boolean;\n  relative?: boolean;\n  format?: Partial<Record<keyof typeof locales, string>>;\n};\n\nconst LocaleTime: React.FC<Props> = ({ children, ...rest }: Props) => {\n  const { tooltipContent, content } = useLocaleTime(rest);\n\n  return (\n    <Tooltip content={tooltipContent} placement=\"bottom\">\n      <time dateTime={rest.dateTime}>{children || content}</time>\n    </Tooltip>\n  );\n};\n\nexport default LocaleTime;\n"],"names":["callbacks","setInterval","forEach","cb","useLocaleTime","addSuffix","dateTime","shorten","format","relative","userLocale","useUserLocale","formatLocaleLong","en_US","fr_FR","undefined","formatLocale","_","setMinutesMounted","React","callback","current","eachMinute","fn","push","filter","state","date","Date","parse","locale","dateLocale","relativeContent","dateToRelative","tooltipContent","formatDate","content","LocaleTime","children","rest","Tooltip","placement","jsx"],"mappings":"mQAKA,IAAIA,EAA4B,GAIhCC,aAAY,KACAC,EAAAA,SAAgBC,GAAAA,KAAI,GAC7B,KAkBI,MAAMC,cAAgBA,EAC3BC,YACAC,WACAC,UAAAA,OACAC,EACAC,eAEA,MAAMC,EAAaC,IAKbC,GACHF,EAL4C,CAC7CG,MAAO,uBACPC,MAAO,6BAGsBJ,QAAcK,IAC3C,uBAEIC,EAAeR,IAASE,IAAeE,GACtCK,EAAGC,GAAqBC,WAAe,GACxCC,EAAWD,EAAAA,SAEjBA,EAAAA,WAAgB,KACLE,EAAAA,QArCb,SAASC,WAAWC,GAGlB,OAFAvB,EAAUwB,KAAKD,GAER,KACLvB,EAAYA,EAAUyB,QAAetB,GAAAA,IAAOoB,GAAE,CAElD,CA+BuBD,EAAW,KACTI,GAAAA,KAAYA,GAAK,IAE/B,KACDN,EAASC,SACXD,EAASC,WACX,IAED,IAEH,MAAMM,EAAO,IAAIC,KAAKA,KAAKC,MAAMvB,IAC3BwB,EAASC,EAAWrB,GACpBsB,EAAkBC,EAAeN,EAAM,CAC3CtB,YACAyB,SACAvB,YAGI2B,EAAiBC,EAAWR,EAAMf,EAAkB,CACxDkB,WASK,MAAA,CACLM,SAPa,IAAb3B,EACIuB,EACAG,EAAWR,EAAMX,EAAc,CAC7Bc,WAKNI,iBAAAA,EClEEG,WAA8BA,EAAGC,cAAaC,MAC5C,MAAAL,eAAEA,EAAAA,QAAgBE,GAAYhC,cAAcmC,GAElD,SACGC,EAAA,CAAQJ,QAASF,EAAgBO,UAAU,SAC1CH,SAACI,EAAA,OAAA,CAAKpC,SAAUiC,EAAKjC,SAAWgC,SAAAA,GAAYF,KAC9C"}